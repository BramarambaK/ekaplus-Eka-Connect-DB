{
    "_id" : "switcher_account_profile_processor",
    "name" : "switcher_account_profile_processor",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "12325a98-a959-4939-9005-4158d136afcd",
    "snippet" : "var finalData = {};\r\n\r\nfunction getOktaToken(platformUrl, headers) {\r\n  return new Promise((resolve, reject) => {\r\n    var options = {\r\n      method: \"GET\",\r\n      url: platformUrl + \"\/cac-security\/api\/external\/identity-provider\/token\",\r\n      headers: {\r\n        Authorization: headers.authorization,\r\n      },\r\n    };\r\n    request(options, function (error, response, body) {\r\n      if (response.statusCode !== 200) reject(body);\r\n      else {\r\n        resolve(JSON.parse(body));\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nvar headerMenu = {\r\n  method: \"GET\",\r\n  url: req.body.propertyList.cargill_menuList,\r\n  json: true,\r\n};\r\nfunction get_headermenu() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(headerMenu, function (err, response, body) {\r\n      if (response.statusCode !== 200) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\nvar profilePicture = {\r\n  method: \"GET\",\r\n  url: req.body.propertyList.cargill_profilePicture,\r\n  json: true,\r\n};\r\nfunction get_profilepicture() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(profilePicture, function (err, response, body) {\r\n      if (response.statusCode !== 200) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\ngetOktaToken(req.body.propertyList.platform_url, req.headers)\r\n  .then((token) => {\r\n    headerMenu.headers = {\r\n      Authorization: \"Bearer \" + token.access_token,\r\n    };\r\n    profilePicture.headers = {\r\n      Authorization: \"Bearer \" + token.access_token,\r\n    };\r\n    get_headermenu()\r\n      .then((data) => {\r\n        if (data.statusCode === \"200\") {\r\n          let switcherData = data.message.landingPage;\r\n          let userProfileData = data.message.userProfileLinks;\r\n          finalData.switcherData = switcherData;\r\n          finalData.userProfileData = userProfileData;\r\n          return finalData;\r\n        } else return finalData;\r\n      })\r\n      .then((headerData) => {\r\n        get_profilepicture().then((profile) => {\r\n          headerData.profilePicture = profile.message[0];\r\n          res.status(200).send(headerData);\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        res.status(500).send(err);\r\n      });\r\n  })\r\n  .catch((err) => {\r\n    res.status(500).send(err);\r\n  });\r\n",
    "sys__UUID" : "a6a76a72-78e3-4f4c-9ff9-45f81478c9d5"
}