{
    "_id" : "Pending_For_ME_Process_mobile_QTC_Ags",
    "name" : "Pending_For_ME_Process_mobile_QTC_Ags",
    "refType" : "app",
    "refTypeId" : "5d907cd2-7785-4d34-bcda-aa84b2158415",
    "snippet" : "\r\n  var defaultDataURL =\r\n req.body.propertyList.platform_url + '/mdmapi/listingData?gridId=LOPA';\r\n var defaultdata = {\r\n   method: 'POST',\r\n   url: defaultDataURL,\r\n   body:{},\r\n   headers: {\r\n     Authorization: req.headers.authorization\r\n   },\r\n   json: true\r\n };\r\n function get_defaultData() {\r\n   return new Promise(function(resolve, reject) {\r\n     request(defaultdata, function(err, response, body) {\r\n       if (err || body.error) reject(body);\r\n       else {\r\n         resolve(body);\r\n       }\r\n     });\r\n   });\r\n }  \r\n function get_logInUser(){\r\n  return new Promise(function(resolve, reject) {\r\n    request({\r\n      method: 'POST',\r\n      url: req.body.propertyList.eka_trm_physicals_api_host + '/contract/approval?viewType=New',\r\n      body:{},\r\n      headers: {\r\n      \"Connection\": \"keep-alive\",\r\n      \"Content-type\": \"application/json\",\r\n      Authorization: req.headers.authorization,\r\n      'X-TenantID': req.headers['x-tenantid'],\r\n      'Device-Id': req.headers['device-id']\r\n    },\r\n      json: true\r\n    }, function(err, response, body) {\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n }\r\n function get_data_from_mdm(){\r\n  return new Promise(function(resolve, reject) {\r\n    request({\r\n      method: 'POST',\r\n      url: req.body.propertyList.eka_mdm_host + '/mdm/5d907cd2-7785-4d34-bcda-aa84b2158415/data',\r\n      body:[{serviceKey: \"userListByRole\"}],\r\n      headers: {\r\n      \"Connection\": \"keep-alive\",\r\n      \"Content-type\": \"application/json\",\r\n      Authorization: req.headers.authorization,\r\n      'X-TenantID': req.headers['x-tenantid'],\r\n      'Device-Id': req.headers['device-id']\r\n    },\r\n      json: true\r\n    }, function(err, response, body) {\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n }\r\n\r\n\r\nif(req.headers.hasOwnProperty('device-id')){\r\n   defaultdata.headers['Device-Id'] = req.headers['device-id']\r\n }\r\n \r\n  get_defaultData().then(function (trmdata) {\r\n    get_logInUser().then(function (userId){\r\n      get_data_from_mdm().then(function (mdm){\r\n        let valueOfapprover =  ''\r\n        if(mdm.hasOwnProperty('userListByRole')){\r\n          valueOfapprover = mdm.userListByRole.find((item=> item.key == userId.currentUserId)).value\r\n        }\r\n    if(trmdata.data){\r\n     res.status(200).send(trmdata.data.filter((item)=>{\r\n      return item.suggestedApprover == valueOfapprover\r\n    }));\r\n }\r\n else{\r\n   res.status(500).send('Failed to get Platform Data');\r\n }\r\n}).catch(err => {\r\n  console.log(err);\r\n});\r\n     }).catch(err => {\r\n     console.log(err);\r\n   });\r\n  }).catch(err => {\r\n    console.log(err);\r\n  });\r\n",
    "sys__UUID" : "ff416ec4-522c-4bd0-a3c6-d21cff6744d2",
    "sys__createdBy" : "avinash.singh@ekaplus.com",
    "sys__createdOn" : ISODate("2019-05-22T09:51:04.600Z"),
    "type" : "processor"
}