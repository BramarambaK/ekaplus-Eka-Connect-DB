{
    "_id" : "Pending_Contract_list_mobile_QTC",
    "name" : "Pending_Contract_list_mobile_QTC",
    "refType" : "app",
    "refTypeId" : "5d907cd2-7785-4d34-bcda-aa84b2158415",
    "snippet" : " var defaultDataURL =\r\n    req.body.propertyList.platform_url + '\/mdmapi\/listingData?gridId=LOPA&page=1&start=0&limit=100';\r\n    var defaultDataURL2 =\r\n    req.body.propertyList.eka_connect_host + '\/workflow\/data';\r\n    var defaultdata = {\r\n      method: 'POST',\r\n      url: defaultDataURL,\r\n      body:{},\r\n      headers: {\r\n        Authorization: req.headers.authorization\r\n        \r\n        \r\n      },\r\n      json: true\r\n    };\r\n    \r\n    \r\n    function get_defaultData() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(defaultdata, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }  \r\n   \r\n    var defaultdata2 = {\r\n     method: 'POST',\r\n      url: defaultDataURL2,\r\n      body:{\r\n      \"appId\": \"5d907cd2-7785-4d34-bcda-aa84b2158415\",\r\n      \"workFlowTask\": \"contract_list\",\r\n      \"filterData\": {\r\n      \"filter\": [\r\n        {\r\n          \"fieldName\": \"internalContractRefNo\",\r\n          \"value\": [],\r\n          \"operator\": \"in\"\r\n        },\r\n      {\r\n      \"fieldName\": \"contractState\",\r\n          \"value\": ['trade'],\r\n          \"operator\": \"in\"\r\n      }\r\n      ]\r\n    }\r\n  },\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    function get_default2() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(defaultdata2, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    if(req.headers.hasOwnProperty('device-id')){\r\n        defaultdata.headers['Device-Id'] = req.headers['device-id']\r\n\t\tdefaultdata2.headers['Device-Id'] = req.headers['device-id']\r\n\t\t\r\n      }\r\n     get_defaultData().then(function (trmdata) {\r\n     var list_contract_pending = []\r\n          for(var i=0;i<trmdata.data.length;i++){\r\n      list_contract_pending.push(trmdata.data[i].internalContractRefNo)\r\n      }\r\n      defaultdata2.body.filterData.filter[0].value = list_contract_pending\r\n      get_default2().then(function (connectdata) {\r\n\t    for(let i=0;i<connectdata.data.length;i++){\r\n\t\tif(connectdata.data[i].sourceContractDetails)\r\n          connectdata.data[i]['contractStatus'] = 'Pending'\r\n\t\t  if ( connectdata.data[i] && connectdata.data[i]['generalDetailsDisplayValue']) {\r\n            connectdata.data[i]['generalDetailsDisplayValue'] = JSON.parse(connectdata.data[i]['generalDetailsDisplayValue']);\r\n            connectdata.data[i] = Object.assign(connectdata.data[i], connectdata.data[i]['generalDetailsDisplayValue']);\r\n            delete connectdata.data[i]['generalDetailsDisplayValue'];\r\n          }\r\n\t\t  delete connectdata.data[i].sourceContractDetails;\r\n\t\t  connectdata.data[i]['totalItems'] = connectdata.data[i].itemDetails.length;\r\n\t\t  delete connectdata.data[i].itemDetails\r\n        }\r\n        res.status(200).send(connectdata.data);\r\n        }).catch(err => {\r\n        console.log(err);\r\n      });\r\n     }).catch(err => {\r\n        console.log(err);\r\n      });\r\n    ",
    "sys__UUID" : "3328d7c9-1b59-4d61-a001-b31a5eda624c",
    "sys__createdBy" : "avinash.singh@ekaplus.com",
    "sys__createdOn" : ISODate("2019-05-22T09:51:04.600Z"),
    "type" : "processor"
}