{
    "_id" : "Contract_list_mobile_QTC_Ags",
    "name" : "Contract_list_mobile_QTC_ags",
    "refType" : "app",
    "refTypeId" : "5d907cd2-7785-4d34-bcda-aa84b2158415",
    "snippet" : "\r\n    \/\/ var dbody = {\r\n    \/\/   appId: '5d907cd2-7785-4d34-bcda-aa84b2158415',\r\n    \/\/   workFlowTask: 'contract_list'\r\n    \/\/ };\r\n    \/\/ var defaultdata = {\r\n    \/\/   method: 'POST',\r\n    \/\/   url: req.body.propertyList.eka_connect_host + '\/workflow\/data?contractState=trade',\r\n    \/\/   headers: {\r\n    \/\/     Authorization: req.headers.authorization,\r\n    \/\/     'X-TenantID': req.headers['x-tenantid']\r\n    \/\/   },\r\n    \/\/   json: true,\r\n    \/\/   body: dbody\r\n    \/\/ };\r\n    \/\/ function get_defaultData() {\r\n    \/\/   return new Promise(function(resolve, reject) {\r\n    \/\/     request(defaultdata, function(err, response, body) {\r\n    \/\/       if (err || body.error) reject(body);\r\n    \/\/       else {\r\n    \/\/         resolve(body);\r\n    \/\/       }\r\n    \/\/     });\r\n    \/\/   });\r\n    \/\/ }\r\n\r\n    var defaultDataURL1 = req.body.propertyList.platform_url + '\/mdmapi\/listingData?gridId=LOC';\r\n    var defaultdata1 = {\r\n      method: 'POST',\r\n      url: defaultDataURL1,\r\n      body:{},\r\n      headers: {\r\n        Authorization: req.headers.authorization\r\n      },\r\n      json: true\r\n    };\r\n    function get_defaultData1() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(defaultdata1, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\tif(req.headers.hasOwnProperty('device-id')){\r\n      defaultdata1.headers['Device-Id'] = req.headers['device-id']\r\n\t  defaultdata1.headers['Device-Id'] = req.headers['device-id']\r\n    }\r\n    \/\/ get_defaultData().then(function(connect) {\r\n    \/\/   var data = connect.data;\r\n      \/\/ var filter = [\r\n      \/\/   {\r\n      \/\/     \"operator\": \"like\",\r\n      \/\/     \"value\": \"848,310\",\r\n      \/\/     \"itemDefaults\": {\r\n      \/\/       \"xtype\": \"textfield\",\r\n      \/\/       \"enableKeyEvents\": true,\r\n      \/\/       \"hideEmptyLabel\": false,\r\n      \/\/       \"iconCls\": \"x-grid-filters-find\",\r\n      \/\/       \"labelSeparator\": \"\",\r\n      \/\/       \"labelWidth\": 29,\r\n      \/\/       \"margin\": 0,\r\n      \/\/       \"selectOnFocus\": true\r\n      \/\/     },\r\n      \/\/     \"menuDefaults\": {\r\n      \/\/       \"xtype\": \"menu\",\r\n      \/\/       \"bodyPadding\": 3,\r\n      \/\/       \"showSeparator\": false\r\n      \/\/     },\r\n      \/\/     \"updateBuffer\": 500,\r\n      \/\/     \"property\": \"contractRefNo\"\r\n      \/\/   }\r\n      \/\/ ]\r\n      \/\/ var list_contract_ctrm = []\r\n      \/\/ var forUrl = ''\r\n      \/\/ for (let i = 0; i < data.length; i++) {\r\n      \/\/   if(forUrl==='') forUrl = data[i].contractRefNo\r\n      \/\/   else forUrl =forUrl + ','+ data[i].contractRefNo\r\n      \/\/   list_contract_ctrm.push(data[i].internalContractRefNo)\r\n      \/\/ }\r\n      \/\/ filter[0].value = forUrl\r\n      \/\/ defaultdata1.url = defaultdata1.url + data.length\r\n      \/\/ var filters = '&filter='+JSON.stringify(filter)\r\n      \/\/ defaultdata1.url = defaultdata1.url + '&contractRefNo='+forUrl+filters\r\n      \/\/ defaultdata1.url = encodeURI(defaultdata1.url)\r\n      get_defaultData1().then(function(ctrmlist) {\r\n    if(ctrmlist.data){\r\n       ctrmlist.data.filter((item)=>{\r\n         return item.contractStatus =='In Position'\r\n       })\r\n  }\r\n  \/\/       for (let i = 0; i < data.length; i++) {\r\n  \/\/         if (connect.totalCount) {\r\n  \/\/           data[i]['totalNoOfRecords'] = connect.totalCount;\r\n  \/\/         }\r\n\t\t  \r\n          \r\n  \/\/         if (data && data[i] && data[i]['generalDetailsDisplayValue']) {\r\n  \/\/           data[i]['generalDetailsDisplayValue'] = JSON.parse(data[i]['generalDetailsDisplayValue']);\r\n  \/\/           data[i] = Object.assign(data[i], data[i]['generalDetailsDisplayValue']);\r\n  \/\/           delete data[i]['generalDetailsDisplayValue'];\r\n  \/\/         }\r\n  \/\/         if (status[data[i]['contractRefNo']]){\r\n  \/\/           data[i]['contractStatus'] = status[data[i]['contractRefNo']]\r\n  \/\/         if (data[i].hasOwnProperty('sourceContractDetails')) delete data[i].sourceContractDetails;\r\n  \/\/         if (data[i].hasOwnProperty('itemDetails')) \r\n\t\/\/ \t  {data[i]['totalItems'] = data[i].itemDetails.length;\r\n\t\/\/ \t  delete data[i].itemDetails;}\r\n  \/\/         finalData.push(data[i])\r\n  \/\/         }\r\n  \/\/       }\r\n        \/\/ finalData.sort((a,b)=>{\r\n        \/\/   return new Date(b.sys__createdOn) - new Date(a.sys__createdOn)\r\n        \/\/ })\r\n        if(ctrmlist.data){\r\n        res.status(200).send(ctrmlist.data);\r\n        }\r\n        else{\r\n          res.status(500).send('Failed to get Platform Data');\r\n        }\r\n      }).catch(err => {\r\n        console.log(err);\r\n      });\r\n    \/\/ })\r\n      \/\/ .catch(err => {\r\n      \/\/   console.log(err);\r\n      \/\/ });\r\n   ",
    "sys__UUID" : "97b40701-3bd5-4111-bb47-caeb1525df61",
    "sys__createdBy" : "avinash.singh@ekaplus.com",
    "sys__createdOn" : ISODate("2019-05-22T09:51:04.600Z"),
    "type" : "processor"
}