{
  "_id": "nonpaymentdoclisting_processor",
  "name": "nonpaymentdoclisting",
  "type": "processor",
  "refType": "app",
  "refTypeId": "4e20f754-574e-43e7-8d11-87c6fae060f5",
  "snippet": "var moment = require(\"moment\");\r\nvar data = [];\r\nvar plannedBulkShipmentNo = req.body.selectedData.plannedBulkShipmentNo;\r\nvar seller = req.body.selectedData.seller;\r\nvar shipper = req.body.selectedData.shipper;\r\nvar connectData = {\r\n    method: \"GET\",\r\n    url:\r\n        req.body.propertyList.eka_connect_host +\r\n        `/data/4e20f754-574e-43e7-8d11-87c6fae060f5/18521f4f-d2e8-47c8-9ac8-83b98ff4cf0e?plannedBulkShipmentNo=${plannedBulkShipmentNo}`,\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n        json: true,\r\n    },\r\n};\r\nfunction get_connectData() {\r\n    return new Promise(function (resolve, reject) {\r\n        request(connectData, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nif (seller) connectData.url = connectData.url + `&seller=${seller}`;\r\nelse if (shipper)\r\n    connectData.url =\r\n        req.body.propertyList.eka_connect_host +\r\n        `/data/4e20f754-574e-43e7-8d11-87c6fae060f5/7555b6ae-b3c7-4a56-b902-efc22fbdb919?plannedBulkShipmentNo=${plannedBulkShipmentNo}&shipper=${shipper}`;\r\nif (req.body.propertyList.documentName) {\r\n    req.body.propertyList.documentName.forEach((element) => {\r\n        if (seller)\r\n            data.push({\r\n                documentName: element.value,\r\n                plannedBulkShipmentNo: plannedBulkShipmentNo,\r\n                seller: seller,\r\n            });\r\n        if (shipper)\r\n            data.push({\r\n                documentName: element.value,\r\n                plannedBulkShipmentNo: plannedBulkShipmentNo,\r\n                shipper: shipper,\r\n            });\r\n    });\r\n}\r\nget_connectData().then((result) => {\r\n    result = JSON.parse(result);\r\n    var date;\r\n    for (var i = 0; i < data.length; i++) {\r\n        result.forEach((el) => {\r\n            if (data[i].documentName == el.documentName) {\r\n                date = moment\r\n                    .utc(el.documentDate)\r\n                    .utcOffset(\"+0530\")\r\n                    .format(\"DD-MMM-YYYY\");\r\n                el.documentDate = date;\r\n                data[i] = {\r\n                    ...el,\r\n                };\r\n            }\r\n        });\r\n    }\r\n    res.status(200).send(data);\r\n});\r\n",
  "sys__UUID": "a16a66b1-1047-4ac7-8b43-2ec23d855684"
}
