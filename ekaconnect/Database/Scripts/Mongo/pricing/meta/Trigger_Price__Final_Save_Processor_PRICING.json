{
    "_id" : "Final_Save_Processor_PRICING",
    "name" : "Final_Save",
    "refType" : "app",
    "refTypeId" : "84d7b167-1d9f-406d-b974-bea406a25f9a",
    "snippet" : "\r\n  \r\n    var defaultDataURL =\r\n    req.body.propertyList.eka_connect_host + '/workflow'\r\n  var defaultdata = {\r\n    method: 'POST',\r\n    body:{\r\n      appId: '84d7b167-1d9f-406d-b974-bea406a25f9a',\r\n      workflowTaskName: 'formula_edit',\r\n      task:'formula_edit',\r\n      output: {\r\n        'formula_edit': {}\r\n      },\r\n      id: req.body.triggerpriceview.formulaId\r\n    },\r\n    url: defaultDataURL,\r\n    headers: {\r\n      Authorization: req.headers.authorization,\r\n      'X-TenantID': req.headers['x-tenantid']\r\n    },\r\n    json: true\r\n  };\r\n  function get_defaultData() {\r\n    return new Promise(function (resolve, reject) {\r\n      request(defaultdata, function (err, response, body) {\r\n        if (err || body.error) reject(body);\r\n        else {\r\n          resolve(body);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  var defaultDataURL1 =\r\n  req.body.propertyList.eka_connect_host + '/workflow/data?_id='+req.body.triggerpriceview.formulaId\r\nvar defaultdata1 = {\r\n  method: 'POST',\r\n  body:{\r\n    appId: '84d7b167-1d9f-406d-b974-bea406a25f9a',\r\n    workFlowTask: 'formula_list',\r\n  },\r\n  url: defaultDataURL1,\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    'X-TenantID': req.headers['x-tenantid']\r\n  },\r\n  json: true\r\n};\r\nfunction get_defaultData1() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(defaultdata1, function (err, response, body) {\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\n  get_defaultData1().then(function (result) {\r\n  defaultdata.body.output.formula_edit=result.data[0]\r\n  \r\ndelete(defaultdata.body.output.formula_edit.sys__data__state)\r\n  var trigger = req.body.triggerpriceview.listingtriggerPrice\r\n  \r\n\r\nconsole.log(trigger )\r\nvar triggerdata = []\r\n var s = 0\r\n  for(var i = 0;i<trigger.length-1;i++){\r\ntrigger[i]['qty'] = trigger[i].quantity\r\ns = s + Number(trigger[i]['quantity'])\r\ntrigger[i]['priceU'] = trigger[i].priceUnitIdDisplayName\r\ntrigger[i]['triggerDate'] = trigger[i].fixationDate\r\ntrigger[i]['price'] = trigger[i].price\r\ntriggerdata.push(trigger[i])\r\ntriggerdata[i].internalContractItemRefNo = req.body.triggerpriceview.contractData.internalItemRefNo\r\n\r\n\r\n  }\r\n  if(s<=req.body.triggerpriceview.listingformula.unfixedQuantity){\r\n    res.status(200).send(triggerdata);\r\n    }\r\n    else{\r\n     res.status(500).send('Total Quantity Exceeded');\r\n    }\r\n})\r\n  \r\n   ",
    "sys__UUID" : "02f2e0ed-ef26-4209-b1af-a0efa992a047",
    "sys__createdBy" : "avinash.singh@ekaplus.com",
    "type" : "processor"
}