{
    "_id" : "Lifecycle_triggerPrice_PRICING",
    "name" : "Lifecycle_triggerPrice",
    "refType" : "app",
    "refTypeId" : "84d7b167-1d9f-406d-b974-bea406a25f9a",
    "snippet" : "\r\n    var defaultdata5 = {\r\n      method: 'POST',\r\n      url: req.body.propertyList.eka_connect_host + '\/workflow\/data',\r\n      body:{ \"appId\":\"84d7b167-1d9f-406d-b974-bea406a25f9a\",\r\n      \"workFlowTask\":\"trigger_data_list\",\r\n      \"filterData\": {\r\n      \"filter\": [\r\n        {\r\n          \"fieldName\": \"internalContractItemRefNo\",\r\n          \"value\": [req.body.queryParams.internalContractItemRefNo],\r\n          \"operator\": \"in\"\r\n        }\r\n      ]\r\n    }\r\n      },\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    function get_defaultData5() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(defaultdata5, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    get_defaultData5().then(function(triggerPrice){\r\n      var data = []\r\n      var moment = require('moment');\r\n      \r\n      \r\n     \r\n    var triggerData = triggerPrice.data\r\n    let group = triggerData.reduce((acc, item) => {\r\n  if (!acc[item.GroupId]) {\r\n    acc[item.GroupId] = [];\r\n  }\r\n  acc[item.GroupId].push(item);\r\n  return acc;\r\n}, {})\r\n\r\nfor(let key in group){\r\n  for(let i =0 ;i<group[key].length;i++){\r\n    if(group[key][i].hasOwnProperty('component')){\r\n      if(group[key + 'Component']){\r\n        group[key + 'Component'].push(group[key][i])\r\n      }\r\n      else{\r\n        group[key + 'Component'] = []\r\n        group[key + 'Component'].push(group[key][i])\r\n      }\r\n      delete group[key][i]\r\n    }\r\n  }\r\n}\r\nvar i=0\r\n  for(let key in group){\r\n    \r\n    data[i]={}\r\n   \/\/ data[i]['date'] = moment(group[key][0].activityDate).format('YYYY-MM-DD');\r\n    let qty = 0\r\n    var calculated = 0\r\n    for(let j=0;j<group[key].length;j++){\r\n      data[i]['date'] = moment(group[key][0].activityDate).format('YYYY-MM-DD');\r\n        qty  = Number(qty) + Number(group[key][j].quantity)\r\n\t\tgroup[key][j].triggerDate = moment(group[key][j].triggerDate).format('YYYY-MM-DD')\r\n        calculated  = calculated + group[key][j].calculatedPrice\r\n        for(let k1 in group[key][j]){\r\n          if(typeof group[key][j][k1]==='object'){\r\n            group[key][j][k1] = ''\r\n          }\r\n        }\r\n    }\r\n    data[i]['Quantity'] = 'Quantity to be \uFB01xed:('+req.body.selectedData.itemQtyUnit + ') '+qty\r\n    group[key].unshift({\"component\":\"Component\",\"quantity\":\"Quantity\",\"triggerDate\":\"Fixation Date\",\"fixationMethod\":\"Fixation Method\",indexName:\"Index Name\",\"price\":\"Price\",indexMultiplier:\"Index Multiplier\",\"fxindex\":\"Fx Instrument\",fxrate:\"Fx Value\",differential:\"Differential\",calculatedPrice:\"Calculated Price\"})\r\n    group[key].push({\"quantity\":qty + \" \" +req.body.selectedData.itemQtyUnit  ,calculatedPrice:calculated.toFixed(5)})\r\n    data[i]['data'] = group[key]\r\n    i++;\r\n    }\r\n    res.status(200).send(data);\r\n    }).catch(err => {\r\n      console.log(err);\r\n  res.status(500).send(err);\r\n    });\r\n   ",
    "sys__UUID" : "1be1efc9-7d60-455c-84b5-94cc3ddf4db2",
    "sys__createdBy" : "avinash.singh@ekaplus.com",
    "type" : "processor"
}