{
    "_id" : "processor_offerlifecycleprocessor",
    "name" : "offerlifecycleprocessor",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "d44a3b31-6758-4367-b8a2-3808532b0c4a",
    "snippet" : " \r\n    var moment = require('moment');\r\n    var appId = req.body.selectedData.refTypeId;\r\n    var versioning_data = {\r\n      method: 'GET',\r\n      url:\r\n        req.body.propertyList.eka_connect_host +\r\n        '\/workflow\/' +\r\n        appId +\r\n        '\/_UT_VIEW_VERSION_HISTORY\/data\/' +\r\n        req.body.selectedData.sys__UUID +\r\n        '\/versions',\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    function get_version_data() {\r\n      return new Promise(function(resolve, reject) {\r\n        console.log('Request - ' + versioning_data.url);\r\n        request(versioning_data, function(err, response, body) {\r\n          console.log('Response - success');\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            console.log('Success');\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    Promise.all([get_version_data()])\r\n      .then(function(result) {\r\n        let collection = result[0].versions;\r\n        let {\r\n          sys__createdBy,\r\n          offerType,\r\n          phone,\r\n          roles,\r\n          productDisplayName,\r\n          qualityDisplayName,\r\n          cropYearDisplayName,\r\n          locationDisplayName,\r\n          quantity,\r\n          packingTypeDisplayName,\r\n          paymentTermsDisplayName,\r\n          packingSizeDisplayName,\r\n          fromDate\r\n        } = collection[0];\r\n        let details = [\r\n          {\r\n            name: 'Name',\r\n            value: sys__createdBy ? sys__createdBy : ''\r\n          },\r\n          {\r\n            name: 'Email',\r\n            value: sys__createdBy ? sys__createdBy : ''\r\n          },\r\n\r\n          {\r\n            name: 'Offer Type',\r\n            value: offerType ? offerType : ''\r\n          },\r\n          {\r\n            name: 'Product',\r\n            value: productDisplayName ? productDisplayName : ''\r\n          },\r\n          {\r\n            name: 'Quality',\r\n            value: qualityDisplayName ? qualityDisplayName : ''\r\n          },\r\n          {\r\n            name: 'Crop Year',\r\n            value: cropYearDisplayName ? cropYearDisplayName : ''\r\n          },\r\n          {\r\n            name: 'Location',\r\n            value: locationDisplayName ? locationDisplayName : ''\r\n          },\r\n          {\r\n            name: 'Quantity',\r\n            value: quantity ? quantity : ''\r\n          },\r\n          {\r\n            name: 'Packing Type',\r\n            value: packingTypeDisplayName ? packingTypeDisplayName : ''\r\n          },\r\n          {\r\n            name: 'Payment Term',\r\n            value: paymentTermsDisplayName ? paymentTermsDisplayName : ''\r\n          },\r\n          {\r\n            name: 'Packing Size',\r\n            value: packingSizeDisplayName ? packingSizeDisplayName : ''\r\n          },\r\n          {\r\n            name: 'Delivery Period',\r\n            value: fromDate ? fromDate : ''\r\n          }\r\n        ];\r\n        let description = [];\r\n\r\n        description.push({\r\n          timestamp: 'Published Bid Price',\r\n          details: [\r\n            {\r\n              name: collection[0].publishedPrice + ' ' + collection[0].priceUnitDisplayName\r\n            }\r\n          ]\r\n        });\r\n        collection.forEach((data, i) => {\r\n          if (i == 0) {\r\n            var date = data['sys__createdOn'];\r\n            date = moment(date).format('DD\/MM\/YYYY hh:mm:ss');\r\n            var doneBy = data['sys__createdBy'];\r\n          } else {\r\n            var date = data['sys__updatedOn'];\r\n            date = moment(date).format('DD\/MM\/YYYY hh:mm:ss');\r\n            var doneBy = data['sys__updatedBy'];\r\n          }\r\n          if (i % 2 == 0) {\r\n            if (data.status == 'Counter') {\r\n              description.push({\r\n                timestamp: date,\r\n                details: [\r\n                  {\r\n                    name: data.bidderprice + ' ' + data.priceUnitDisplayName\r\n                  },\r\n                  {\r\n                    name: doneBy\r\n                  },\r\n                  {\r\n                    name: data.remark ? data.remark : 'No Remark'\r\n                  }\r\n                ]\r\n              });\r\n            } else {\r\n              description.push({\r\n                timestamp: date,\r\n                details: [\r\n                  {\r\n                    name: data.offererprice + ' ' + data.priceUnitDisplayName\r\n                  },\r\n                  {\r\n                    name: doneBy\r\n                  },\r\n                  {\r\n                    name: data.remark ? data.remark : 'No Remark'\r\n                  }\r\n                ]\r\n              });\r\n            }\r\n          } else {\r\n            if (data.status == 'Counter') {\r\n              description.push({\r\n                timestamp: date,\r\n                details: [\r\n                  {\r\n                    name: data.offererprice + ' ' + data.priceUnitDisplayName\r\n                  },\r\n                  {\r\n                    name: doneBy\r\n                  },\r\n                  {\r\n                    name: data.remark ? data.remark : 'No Remark'\r\n                  }\r\n                ]\r\n              });\r\n            } else {\r\n              description.push({\r\n                timestamp: date,\r\n                details: [\r\n                  {\r\n                    name: data.bidderprice + ' ' + data.priceUnitDisplayName\r\n                  },\r\n                  {\r\n                    name: doneBy\r\n                  },\r\n                  {\r\n                    name: data.remark ? data.remark : 'No Remark'\r\n                  }\r\n                ]\r\n              });\r\n            }\r\n          }\r\n        });\r\n\r\n        var reversedesc = description.reverse();\r\n        description = reversedesc;\r\n        data = { details, description };\r\n        res.status(200).send(data);\r\n      })\r\n      .catch(err => {\r\n        console.log('error:' + err.stack);\r\n        res.status(500).send(err);\r\n      });\r\n ",
    "sys__createdOn" : ISODate("2019-06-03T13:38:13.102Z"),
    "sys__UUID" : "4f03aa55-2166-4d69-8443-523c2bedc40d",
    "sys__createdBy" : "admin@ekaplus.com"
}