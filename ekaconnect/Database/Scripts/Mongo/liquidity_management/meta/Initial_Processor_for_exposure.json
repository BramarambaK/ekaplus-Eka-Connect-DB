{
    "_id" : "Initial_Processor_for_exposure",
    "name" : "Initial_Processor_for_exposure",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "d88e9a79-c0cc-4c28-bb01-ee56ff33048e",
    "snippet" : "var moment = require(\"moment\");\r\nlet selected = req.body.hasOwnProperty(\"selectedData\")\r\n  ? req.body.selectedData\r\n  : {};\r\nvar ekaEntity =req.body.propertyList.platform_url + \"/spring/liquidityManagement/exposure\";\r\nvar platformBody = { asOfDate: \"\", clientID: \"8\", entityIds: [] };\r\n\r\nvar platformEntityExposureData = {\r\n  method: \"GET\",\r\n  url: ekaEntity,\r\n  body: platformBody,\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    \"Content-Type\": \"application/json\",\r\n    \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n  },\r\n  json: true,\r\n};\r\nvar get_platformEntityExposureData =\r\n  function get_platformEntityExposureData(date, entity, toDate) {\r\n    if (date && toDate) {\r\n      date = moment(date).format(\"YYYY-MM-DD\");\r\n      platformBody.asOfDate = date;\r\n\t  platformBody.toDate = toDate;\r\n    } else {\r\n      platformBody.asOfDate = moment(new Date()).format(\"YYYY-MM-DD\");\r\n\t  platformBody.toDate = moment(new Date()).format('YYYY-MM-DD');\r\n    }\r\n    if (entity && entity.length > 0) {\r\n      platformBody.entityIds = entity;\r\n    }\r\n    platformEntityExposureData.body = platformBody;\r\n    return new Promise(function (resolve, reject) {\r\n      request(platformEntityExposureData, function (err, response, body) {\r\n        if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n          resolve(body);\r\n        } else {\r\n          reject(body);\r\n        }\r\n      });\r\n    });\r\n  };\r\nvar ekaEntity =\r\n  req.body.propertyList.platform_url + \"/spring/cashManagement/entity\";\r\n\r\nvar platformEntity = {\r\n  method: \"GET\",\r\n  url: ekaEntity,\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    \"Content-Type\": \"application/json\",\r\n    ttl: 300,\r\n    \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n    \"X-Remote-User\": \"ekaApp\",\r\n  },\r\n  json: true,\r\n};\r\nvar get_platformEntity = function get_platformEntity() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(platformEntity, function (err, response, body) {\r\n      if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n        resolve(body);\r\n      } else {\r\n        reject(body);\r\n      }\r\n    });\r\n  });\r\n};\r\nget_platformEntity()\r\n  .then(function (ent) {\r\n    var entity = ent.map(function (res) {\r\n      return res[\"c1\"];\r\n    });\r\n    if (selected.hasOwnProperty(\"filterDate\") && selected.hasOwnProperty('toDate')) {\r\n      var date = req.body.selectedData.filterDate;\r\n\t   var toDate = req.body.selectedData.toDate;\r\n      entity = req.body.selectedData.formcheckbox;\r\n    }\r\n    Promise.all([get_platformEntityExposureData(date, entity, toDate)])\r\n      .then((results) => {\r\n        let exposure = [];\r\n        for (let i = 0; i < results[0].length; i++) {\r\n          exposure[i] = results[0][i];\r\n          exposure[i][\"status\"] = exposure[i][\"c14\"];\r\n          exposure[i][\"exposureRefNo\"] = exposure[i][\"c30\"];\r\n          exposure[i][\"externalRefNo\"] = exposure[i][\"c3\"];\r\n\t\t  exposure[i][\"exposureType\"] = exposure[i][\"c34\"];\r\n\t\t  exposure[i][\"exposureDate\"] = moment(exposure[i][\"c5\"]).format(\"DD-MMM-YYYY\");\r\n\t\t  exposure[i][\"currency\"] = exposure[i][\"c7\"];\r\n\t\t  exposure[i][\"amount\"] = exposure[i][\"c9\"];\r\n\t\t  exposure[i][\"profitCenter\"] = exposure[i][\"c16\"];\r\n\t\t  exposure[i][\"strategy\"] = exposure[i][\"c17\"];\r\n\t\t  exposure[i][\"bankID\"] = exposure[i][\"c39\"];\r\n\t\t  exposure[i][\"entity\"] = exposure[i][\"c15\"];\r\n\t\t  exposure[i][\"remarks\"] = exposure[i][\"c11\"];\r\n\t\t  exposure[i][\"bankAccount\"] = exposure[i][\"c8\"];\r\n\t\t  exposure[i][\"bank\"] = exposure[i][\"c6\"];\r\n\t\t  exposure[i][\"referencePlanName\"] = exposure[i][\"c19\"];\r\n\t\t  exposure[i][\"classification\"] = exposure[i][\"c12\"];\r\n\t\t  exposure[i][\"direction\"] = exposure[i][\"c10\"];\r\n\t\t  exposure[i][\"attributes\"] = exposure[i][\"c41\"];\r\n  exposure[i][\"updatedDate\"] = exposure[i][\"c37\"] ? moment(exposure[i][\"c37\"]).format('DD-MMM-YYYY HH:MM:SS') : '';\r\n   exposure[i][\"updatedBy\"] = exposure[i][\"c42\"];\r\n      }\r\n        res.status(200).send([...exposure]);\r\n      })\r\n      .catch((err) => {\r\n        res.status(500).send(err);\r\n      });\r\n  })\r\n  .catch((err) => {\r\n    res.status(500).send(err);\r\n  });",
    "sys__UUID" : "ac047c40-9013-4478-9280-02841b0707a7",
    "sys__createdBy" : "Jay"
}