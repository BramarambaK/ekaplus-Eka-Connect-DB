{
    "_id" : "MDM_convertToExposure",
    "name" : "MDM_convertToExposure",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "d88e9a79-c0cc-4c28-bb01-ee56ff33048e",
    "snippet" : "\r\n    var findindex = function findindex(serviceKey) {\r\n      return req.body.mdmProcessorServiceKey.findIndex(function(x) {\r\n        return x.serviceKey == serviceKey;\r\n      });\r\n    };\r\n\r\n    var main = function main() {\r\n      var mdmdata = {};\r\n      var cashForecastData = req.body.selectedData.allData\r\n        ? req.body.selectedData.allData\r\n        : req.body.selectedData.cashforecasts;\r\n      if (findindex('ngrFilterKey') != -1) {\r\n        var Entity = cashForecastData.filter(function(item, index, self) {\r\n          return (\r\n            index ===\r\n            self.findIndex(function(t) {\r\n              return t.c5 === item.c5;\r\n            })\r\n          );\r\n        });\r\n        mdmdata['ngrFilterKey'] = Entity.map(function(res) {\r\n          return { key: res.c5, value: res.c5 };\r\n        });\r\n      }\r\n      if (findindex('classification') != -1) {\r\n        var Classification = cashForecastData.filter(function(item, index, self) {\r\n          return (\r\n            index ===\r\n            self.findIndex(function(t) {\r\n              return t.c17 === item.c17;\r\n            })\r\n          );\r\n        });\r\n        mdmdata['classification'] = Classification.map(function(res) {\r\n          return { key: res.c17, value: res.c17 };\r\n        });\r\n      }\r\n      if (findindex('bankAccount') != -1) {\r\n        var BankAccount = cashForecastData.filter(function(item, index, self) {\r\n          return (\r\n            index ===\r\n            self.findIndex(function(t) {\r\n              return t.bankAccount === item.bankAccount;\r\n            })\r\n          );\r\n        });\r\n        mdmdata['bankAccount'] = BankAccount.map(function(res) {\r\n          return { key: res.bankAccount, value: res.bankAccount };\r\n        });\r\n      }\r\n      if (findindex('currency') != -1) {\r\n        var Currency = cashForecastData.filter(function(item, index, self) {\r\n          return (\r\n            index ===\r\n            self.findIndex(function(t) {\r\n              return t.c15 === item.c15;\r\n            })\r\n          );\r\n        });\r\n        mdmdata['currency'] = Currency.map(function(res) {\r\n          return { key: res.c15, value: res.c15 };\r\n        });\r\n      }\r\n      if (findindex('bankName') != -1) {\r\n        var dependsOn = req.body.mdmProcessorServiceKey.find(function(f) {\r\n          return f.serviceKey == 'bankName';\r\n        }).dependsOn;\r\n        var BankName = cashForecastData.filter(function(item, index, self) {\r\n          return item.entity === dependsOn[0] && item.bankAccount === dependsOn[1];\r\n        });\r\n        mdmdata['bankName'] = BankName[0].bankName;\r\n      }\r\n      if (findindex('profitCenter') != -1) {\r\n        var ProfitCenter = cashForecastData.filter(function(item, index, self) {\r\n          return (\r\n            index ===\r\n            self.findIndex(function(t) {\r\n              return t.c20 === item.c20;\r\n            })\r\n          );\r\n        });\r\n        mdmdata['profitCenter'] = ProfitCenter.map(function(res) {\r\n          return { key: res.c20, value: res.c20 };\r\n        });\r\n      }\r\n      if (findindex('strategy') != -1) {\r\n        var Strategy = cashForecastData.filter(function(item, index, self) {\r\n          return (\r\n            index ===\r\n            self.findIndex(function(t) {\r\n              return t.c21 === item.c21;\r\n            })\r\n          );\r\n        });\r\n        mdmdata['strategy'] = Strategy.map(function(res) {\r\n          return { key: res.c21, value: res.c21 };\r\n        });\r\n      }\r\n      if (findindex('referencePlanName') != -1) {\r\n        var ReferencePlanName = cashForecastData.filter(function(item, index, self) {\r\n          return (\r\n            index ===\r\n            self.findIndex(function(t) {\r\n              return t.c10 === item.c10;\r\n            })\r\n          );\r\n        });\r\n        mdmdata['referencePlanName'] = ReferencePlanName.map(function(res) {\r\n          return { key: res.c10, value: res.c10 };\r\n        });\r\n      }\r\n\r\n      if (findindex('direction') != -1) {\r\n        var Direction = cashForecastData.reduce(function(acc, item) {\r\n          acc = item.c16 == 'Credit' ? acc + Number(item.c14) : acc - Number(item.c14);\r\n          return acc;\r\n        }, 0);\r\n\r\n        mdmdata['direction'] = Direction < 0 ? 'Debit' : 'Credit';\r\n      }\r\n\r\n      return mdmdata;\r\n    };\r\n\r\n    var moment = require('moment');\r\n    var mdmbody = JSON.parse(req.body.mdmProcessorServiceKey);\r\n    req.body.mdmProcessorServiceKey = JSON.parse(req.body.mdmProcessorServiceKey);\r\n\r\n    var Final = main();\r\n    res.status(200).send(Final);\r\n ",
    "sys__UUID" : "d6c8a249-011b-4405-aa11-fef8ac384376",
    "sys__createdBy" : "avinash"
}