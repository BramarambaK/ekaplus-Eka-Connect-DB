{
    "_id" : "Final_Processor_for_addsyndicate",
    "name" : "Final_Processor_for_addsyndicate",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "e5b9fc05-22a9-4755-9cbc-c8598ab61ec2",
    "snippet" : "var checkAllBlank = function checkAllBlank(data) {\r\n   for (var j in data) {\r\n      if (data[j] && data[j] != '__empty__') {\r\n        return false;\r\n      }\r\n    }\r\n  \r\n\r\n  return true;\r\n};\r\n\r\nvar checkAllTrue = function checkAllTrue(data) {\r\n  for (var i = 0; i < data.length; i++) {\r\n    for (var j in data[i]) {\r\n      if (data[i][j] == '__empty__' || !data[i][j]) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nvar checkAllValidPercentages = function checkAllValidPercentages(memberships) {\r\n  var percentageRegex = /^0*(100(\\.0{1,2})?|[1-9][0-9]?(\\.[0-9]{1,2})?|0\\.(0[1-9]|[1-9][0-9]?))$/;\r\n  for (var i = 0; i < memberships.length; i++) {\r\n    if (!percentageRegex.test(memberships[i].membership)) {\r\n      console.log(memberships[i].membership);\r\n      console.log(percentageRegex.test(memberships[i].membership));\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n};\r\n\r\nvar formatMembership = function formatMembership(data){\r\n  var memberShips = [];\r\n  for (var i = 0; i < data.length; i++) {\r\n       if(!checkAllBlank(data[i])){\r\n          memberShips.push(data[i]);\r\n       }\r\n  }\r\n  return memberShips;\r\n}\r\n\r\nvar syndicates = req.body.syndicate && req.body.syndicate.syndicate;\r\nvar membership = formatMembership(req.body.bankMemberships);\r\nvar syndicateObj = {};\r\nif (syndicates && syndicates.length > 0) {\r\n  syndicates[req.body.formIndex] = { 'syndicateName': req.body.syndicateName, 'remark': req.body.remark, 'bankMemberships': [...membership] };\r\n  syndicateObj.syndicate = syndicates;\r\n} else {\r\n  syndicates = [];\r\n  syndicates[req.body.formIndex] = { 'syndicateName': req.body.syndicateName, 'remark': req.body.remark, 'bankMemberships': [...membership] };\r\n  syndicateObj.syndicate = syndicates;\r\n}\r\nif (!req.body.syndicateName && !req.body.remark && membership.length == 0) {\r\n  syndicateObj.syndicate[req.body.formIndex] = null;\r\n  res.status(200).send(syndicateObj);\r\n} else if (!req.body.syndicateName && req.body.remark && membership.length == 0) {\r\n  syndicateObj.syndicate[req.body.formIndex] = null;\r\n  res.status(200).send(syndicateObj);\r\n} else if(req.body.syndicateName && membership.length == 0){\r\n  res.status(400).send('Bank Name and Membership percent are required');\r\n}\r\nelse if (req.body.syndicateName && checkAllTrue(membership)) {\r\n  if (checkAllValidPercentages(membership)) {\r\n    var sum = 0;\r\n    var memberships = membership;\r\n    for (var i = 0; i < memberships.length; i++) {\r\n      sum = sum + Number(memberships[i].membership);\r\n    }\r\n    if (sum == 100) {\r\n      res.status(200).send(syndicateObj);\r\n    } else {\r\n      res.status(400).send('Membership percent sum should be equal to 100');\r\n    }\r\n  } else {\r\n    res.status(400).send('Membership percent should be greater than 0 & equal to 100');\r\n  }\r\n} else {\r\n  if (!req.body.syndicateName) {\r\n    res.status(400).send('Syndicate name is required');\r\n  } else if (membership.length == 0) {\r\n    res.status(400).send('Bank Name and Membership percent are required');\r\n  } else {\r\n    for (let i = 0; i < membership.length; i++) {\r\n      if (membership[i].bankName || membership[i].membership) {\r\n        if (!membership[i].bankName || membership[i].bankName == '__empty__') {\r\n          res.status(400).send('Bank name is required');\r\n        } \r\n        if(!membership[i].membership) {\r\n          res.status(400).send('Membership percent is required');\r\n        }\r\n      }\r\n    }\r\n  }\r\n}",
    "sys__UUID" : "17f1471f-63e7-41fd-972e-8c478b92b5b4"
}