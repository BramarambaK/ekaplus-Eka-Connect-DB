{
  "_id": "volumelimits_add_summarize_processor",
  "name": "volumelimits_add_summarize_processor",
  "type": "processor",
  "refType": "app",
  "refTypeId": "12325a98-a959-4939-9005-4158d136afcd",
  "snippet": " const sendError = (message, context) =>\r\n      res.status(400).send({\r\n        errorCode: '004',\r\n        errorMessage: message,\r\n        errorContext: null,\r\n        errorLocalizedMessage: message,\r\n        errors: [\r\n          {\r\n            errorCode: '004',\r\n            errorMessage: message,\r\n            errorContext: context,\r\n            errorLocalizedMessage: message,\r\n            errors: null\r\n          }\r\n        ]\r\n      });\r\n    if (!req.body.bpRefNo) {\r\n      return sendError('Please choose an account', '{enterlimits:bpRefNo}');\r\n    }\r\n    if (!req.body.season) {\r\n      return sendError('Please choose a harvest season', '{enterlimits:season}');\r\n    }\r\n    const bpDetails = req.body.bpRefNo.split(' @#@ ');\r\n    const data = (req.body.tonnagelimits || []).reduce((ac1, cur1, ind1) => {\r\n      ac1.push(\r\n        ...(cur1.site && cur1.site.length > 0 ? cur1.site : [null]).reduce((ac2, cur2) => {\r\n          ac2.push(\r\n            ...(cur1.quality && cur1.quality.length > 0 ? cur1.quality : [null]).map(quality => ({\r\n              ...cur1,\r\n              quality,\r\n              site: cur2,\r\n              bpRefNo: bpDetails[0],\r\n              bpName: bpDetails[1],\r\n              bpExternalName: bpDetails[2],\r\n              bpExternalCode: bpDetails[3],\r\n              season: req.body.season,\r\n              oldDailylimit:\r\n                cur1.quality.length > 1 || cur1.site.length > 1\r\n                  ? req.body.tonnagelimits[ind1].oldDailylimit\r\n                  : cur1.oldDailylimit,\r\n              dailypurchased:\r\n                cur1.quality.length > 1 || cur1.site.length > 1\r\n                  ? req.body.tonnagelimits[ind1].dailypurchased\r\n                  : cur1.dailypurchased,\r\n              _groupNo: ind1\r\n            }))\r\n          );\r\n          return ac2;\r\n        }, [])\r\n      );\r\n      return ac1;\r\n    }, []);\r\n\r\n    data.forEach(i => {\r\n      if (i.dailypurchased == '-' || i.dailypurchased == '0' || i.dailypurchased == '') {\r\n        delete i.dailypurchased;\r\n      }\r\n      if (typeof i.dailyLimit == 'string') {\r\n        i.dailyLimit = parseInt(i.dailyLimit);\r\n      }\r\n      if (i.oldDailylimit == '-' || i.oldDailylimit == '0' || i.oldDailylimit == '') {\r\n        delete i.oldDailylimit;\r\n      }\r\n    });\r\n    res.status(200).send(data);",
  "sys__UUID": "8b64d54b-074f-437a-ab3f-8698a8af5487"
}
