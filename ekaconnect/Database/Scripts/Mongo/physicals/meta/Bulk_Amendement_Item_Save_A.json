{
    "_id" : "Bulk_Amendement_Item_Save_A",
    "name" : "Bulk_Amendement_Item_Save",
    "refType" : "app",
    "refTypeId" : "5d907cd2-7785-4d34-bcda-aa84b2158415",
    "snippet" : "    var sendData = []\r\n    var moment = require('moment');\r\n    var defaultDataURL1 = req.body.propertyList.platform_url + '\/api\/contract\/item\/bulk';\r\n    var defaultdata1 = {\r\n      method: 'PUT',\r\n      url: defaultDataURL1,\r\n      body:{},\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        \"Content-Type\" : \"application\/json\"\r\n      },\r\n      json: true\r\n    };\r\n    function get_defaultData1() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(defaultdata1, function(err, response, body) {\r\n            if(response.statusCode >= 200 && response.statusCode <=299) {\r\n                resolve(body); \/\/Success \r\n              } else {\r\n                reject(body); \/\/Failure\r\n              }\r\n        });\r\n      });\r\n    }\r\n   var data = req.body.bulkcontractitemsupdate.listingcontractitem\r\n    for(let i=0;i<data.length;i++){\r\n  if(Number(data[i]['finalInvoicedQty']) == 0 && Number(data[i]['executedQty']) == 0){\r\n      sendData.push({'pricing':{}})\r\n      sendData[i]['amendmentDate'] =moment(req.body.bulkcontractitemsupdate.editcontractitem.amendmentDate).format('YYYY-MM-DD')+ 'T18:30:00.000+0000';\r\n      sendData[i]['amendmentReason'] =req.body.bulkcontractitemsupdate.editcontractitem.amendmentReason\r\n      sendData[i]['internalContractItemRefNo']  = data[i]['internalContractItemRefNo']\r\n    \/\/   sendData[i]['periodType']  = data[i]['periodType']\r\n    \/\/   sendData[i]['periodFromDate']  = data[i]['deliveryPeriodFromDate']\r\n    \/\/   sendData[i]['periodToDate']  = data[i]['deliveryPeriodToDate']\r\n      sendData[i]['internalContractRefNo']  = data[i]['internalContractRefNo']\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.approvalManagementDO)\r\n    sendData[i]['approvalManagementDO']  = req.body.bulkcontractitemsupdate.editcontractitem.approvalManagementDO\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.originId)\r\n    sendData[i]['origin']  = req.body.bulkcontractitemsupdate.editcontractitem.originId\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.qualityId){\r\n    sendData[i]['qualityId']  = req.body.bulkcontractitemsupdate.editcontractitem.qualityId\r\n  }\r\n  if(req.body.bulkcontractitemsupdate.editcontractitem.quality){\r\n  sendData[i]['quality']  = req.body.bulkcontractitemsupdate.editcontractitem.quality\r\n  }\r\n  if(req.body.bulkcontractitemsupdate.editcontractitem.cropYearId){\r\n  sendData[i]['cropYear']  = req.body.bulkcontractitemsupdate.editcontractitem.cropYearId\r\n  }\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.priceContractDefId)\r\n    sendData[i]['pricingInstrument']  = req.body.bulkcontractitemsupdate.editcontractitem.priceContractDefId\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.basisPriceUnitId)\r\n    sendData[i]['pricing']['basisPriceUnitId']  = req.body.bulkcontractitemsupdate.editcontractitem.basisPriceUnitId\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.priceFutureContractId)\r\n    sendData[i]['pricing']['priceFutureContractId']  = req.body.bulkcontractitemsupdate.editcontractitem.priceFutureContractId\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.periodType)\r\n    sendData[i]['periodType']  = req.body.bulkcontractitemsupdate.editcontractitem.periodType\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.periodFromDate)\r\n    sendData[i]['periodFromDate']  =moment(req.body.bulkcontractitemsupdate.editcontractitem.periodFromDate).format('YYYY-MM-DD')+ 'T18:30:00.000+0000';\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.periodToDate)\r\n    sendData[i]['periodToDate']  = moment(req.body.bulkcontractitemsupdate.editcontractitem.periodToDate).format('YYYY-MM-DD')+ 'T18:30:00.000+0000';\r\n\tif(req.body.bulkcontractitemsupdate.editcontractitem.multiDeliveryPeriodTypeId)\r\n    sendData[i]['multiDeliveryPeriodType']  = req.body.bulkcontractitemsupdate.editcontractitem.multiDeliveryPeriodTypeId\r\n\tif(req.body.bulkcontractitemsupdate.editcontractitem.multiDeliveryFromDate)\r\n    sendData[i]['multiDeliveryFromDate']  =moment(req.body.bulkcontractitemsupdate.editcontractitem.multiDeliveryFromDate).format('YYYY-MM-DD')+ 'T18:30:00.000+0000';\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.multiDeliveryToDate)\r\n    sendData[i]['multiDeliveryToDate']  = moment(req.body.bulkcontractitemsupdate.editcontractitem.multiDeliveryToDate).format('YYYY-MM-DD')+ 'T18:30:00.000+0000';\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.contractRefNo)\r\n    sendData[i]['contractRefNo']  = req.body.bulkcontractitemsupdate.editcontractitem.contractRefNo\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.basisPrice)\r\n    sendData[i]['pricing']['basisPrice']  = req.body.bulkcontractitemsupdate.editcontractitem.basisPrice\r\n  if(req.body.bulkcontractitemsupdate.editcontractitem.basisPrice && req.body.bulkcontractitemsupdate.editcontractitem.basisPriceUnitId && req.body.bulkcontractitemsupdate.editcontractitem.basisPrice && req.body.bulkcontractitemsupdate.editcontractitem.basisPrice)\r\n    sendData[i]['pricing']['priceString']  = req.body.bulkcontractitemsupdate.editcontractitem.basisPrice\r\n    if(req.body.bulkcontractitemsupdate.editcontractitem.periodFromDate  && req.body.bulkcontractitemsupdate.editcontractitem.periodToDate){\r\n      sendData[i]['deliveryPeriod']  = moment(req.body.bulkcontractitemsupdate.editcontractitem.periodFromDate).format('DD-MMM-YYYY') + 'to' + moment(req.body.bulkcontractitemsupdate.editcontractitem.periodToDate).format('DD-MMM-YYYY')\r\n      }\r\n      if(req.body.bulkcontractitemsupdate.editcontractitem.productSpecs){\r\n      let previousProductSpec = req.body.bulkcontractitemsupdate.editcontractitem.productSpecs.split(',')\r\n      sendData[i]['productSpecs']  = previousProductSpec[0] + ',' + previousProductSpec[1] + ','+previousProductSpec[2] + ','+req.body.bulkcontractitemsupdate.editcontractitem.quality\r\n      }  \r\n  }\r\n  if( Number(data[i]['finalInvoicedQty']) == 0 && Number(data[i]['executedQty']) != 0){\r\n    sendData.push({'pricing':{}})\r\n    sendData[i]['amendmentDate'] =moment(req.body.bulkcontractitemsupdate.editcontractitem.amendmentDate).format('YYYY-MM-DD')+ 'T18:30:00.000+0000';\r\n    sendData[i]['amendmentReason'] =req.body.bulkcontractitemsupdate.editcontractitem.amendmentReason\r\n    sendData[i]['internalContractItemRefNo']  = data[i]['internalContractItemRefNo']\r\n    sendData[i]['internalContractRefNo']  = data[i]['internalContractRefNo']\r\n  if(req.body.bulkcontractitemsupdate.editcontractitem.approvalManagementDO)\r\n  sendData[i]['approvalManagementDO']  = req.body.bulkcontractitemsupdate.editcontractitem.approvalManagementDO\r\n  if(req.body.bulkcontractitemsupdate.editcontractitem.basisPriceUnitId)\r\n  sendData[i]['pricing']['basisPriceUnitId']  = req.body.bulkcontractitemsupdate.editcontractitem.basisPriceUnitId\r\n  if(req.body.bulkcontractitemsupdate.editcontractitem.contractRefNo)\r\n  sendData[i]['contractRefNo']  = req.body.bulkcontractitemsupdate.editcontractitem.contractRefNo\r\n  if(req.body.bulkcontractitemsupdate.editcontractitem.basisPrice)\r\n  sendData[i]['pricing']['basisPrice']  = req.body.bulkcontractitemsupdate.editcontractitem.basisPrice\r\n  if(req.body.bulkcontractitemsupdate.editcontractitem.basisPrice && req.body.bulkcontractitemsupdate.editcontractitem.basisPriceUnitId && req.body.bulkcontractitemsupdate.editcontractitem.basisPrice && req.body.bulkcontractitemsupdate.editcontractitem.basisPrice)\r\n  sendData[i]['pricing']['priceString']  = req.body.bulkcontractitemsupdate.editcontractitem.basisPrice\r\n  }\r\n  }\r\n  \r\n  \r\n    defaultdata1.body = sendData\r\n    console.log(sendData);   \r\n    get_defaultData1().then(function (ctrm) {\r\n\tconsole.log(ctrm)\r\n\tif(Array.isArray(ctrm)){\r\n       success(ctrm,200);\r\n\t   }\r\n\telse error('Bulk Upload API is failing, Please check',500);    \r\n    }).catch(function (err) {\r\n      console.log(err);\r\n       error(err,500);\r\n    });\r\n  \r\n  ",
    "sys__UUID" : "5e6f3090-0238-49f9-8044-fb270c5d41b4",
    "sys__createdBy" : "avinash.singh@ekaplus.com",
    "type" : "processor",
    "version" : "V2"
}