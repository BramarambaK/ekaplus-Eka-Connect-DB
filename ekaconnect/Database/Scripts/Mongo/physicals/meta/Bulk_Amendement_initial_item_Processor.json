{
    "_id" : "Bulk_Amendement_composite_item_Processor",
    "name" : "Bulk_Amendement_composite_item",
    "refType" : "app",
    "refTypeId" : "5d907cd2-7785-4d34-bcda-aa84b2158415",
    "snippet" : "\r\n    var sessionData = []\r\n\tvar moment = require('moment');\r\n    // sessionData.push(req.body.queryParams)\r\n    for(let key in req.body.queryParams){\r\n      for(let i =0;i<req.body.queryParams[key].length;i++){\r\n        if(!sessionData[i])  sessionData.push({})\r\n        sessionData[i][key] =  req.body.queryParams[key][i]\r\n      }\r\n    }\r\n\tsessionData = sessionData.map((item)=>{\r\n\t  if(item.deliveryPeriodFromDate)item['deliveryPeriodFromDate']=moment(item.deliveryPeriodFromDate).format('DD-MMM-YYYY')\r\n\t  if(item.deliveryPeriodToDate)item['deliveryPeriodToDate']=moment(item.deliveryPeriodToDate).format('DD-MMM-YYYY')\r\n\t  return item;\r\n\t})\r\n\t// sessionData = JSON.parse(req.body.queryParams.connectListingData)\r\n    let flag = true\r\n\tlet allowedpriceType = true\r\n\tfor(let i=0;i<sessionData.length;i++){\r\n\tif(sessionData[i].priceTypeId!==\"On Call Basis Fixed\"){\r\n\t  allowedpriceType = false\r\n\t  break;\r\n\t}\r\n\t}\r\n    if(allowedpriceType){\r\n   for(let i=1;i<sessionData.length;i++){\r\n      if(sessionData[i].productId !== sessionData[0].productId || sessionData[i].priceTypeId !== sessionData[0].priceTypeId || sessionData[i].cpName !== sessionData[0].cpName||sessionData[i].incotermId !== sessionData[0].incotermId){\r\n         flag = false\r\n         break;\r\n      }\r\n   }\r\n   }\r\n   \r\n   if(!flag)\r\n\tres.status(500).send('Please select contracts having same CP, INCO Term, Product and Price Type');\r\n   else if(!allowedpriceType){\r\n    res.status(500).send('Selected PriceType not allowed');\r\n   }\r\n  else  \r\n   sessionData[0]['amendmentDate'] = new Date()\r\n   res.status(200).send({\r\n        listingcontractitem: sessionData,\r\n        editcontractitem:{\r\n          'productId':sessionData[0].productId,\r\n          'payinCurrencyId':sessionData[0].payinCurrencyId,\r\n          'priceTypeId':sessionData[0].priceTypeId,\r\n          'amendmentDate':sessionData[0].amendmentDate,\r\n\t\t  'amendmentReason':null,\r\n\t\t  'originId':null,\r\n\t\t  'cropYearId':null,\r\n\t\t  'qualityId':null,\r\n\t\t  'priceContractDefId':null,\r\n\t\t  'priceFutureContractId':null,\r\n\t\t  'basisPrice':null,\r\n\t\t  'basisPriceUnitId':null,\r\n\t\t  'periodType':null,\r\n\t\t  'periodToDate':null,\r\n\t\t  'periodFromDate':null,\r\n\t\t  'cropYear':null,\r\n\t\t  'quality':null,\r\n\t\t  'origin':null\r\n   }\r\n    });",
    "sys__UUID" : "4c466549-fedc-4ea6-8a10-2ec217f09b24",
    "sys__createdBy" : "avinash.singh@ekaplus.com",
    "type" : "processor"
}