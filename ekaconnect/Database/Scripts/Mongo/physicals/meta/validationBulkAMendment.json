{
    "_id" : "validationBulkAMendment",
    "name" : "validationBulkAMendment",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "5d907cd2-7785-4d34-bcda-aa84b2158415",
    "snippet" : "     var moment = require('moment');\r\n    let validate = req.body.bulkcontractitemsupdate ? req.body.bulkcontractitemsupdate.editcontractitem : req.body.bulkcontractsupdate.editcontract\r\n    if(!validate['amendmentDate']||!validate['amendmentReason'] ){\r\n      res.status(500).send('Please fill Mandatory Fields');\r\n    }\r\n  \r\n    let listingData = req.body.bulkcontractitemsupdate ? req.body.bulkcontractitemsupdate.listingcontractitem : req.body.bulkcontractsupdate.listingcontract\r\n     let latestissuedate = new Date(Math.max.apply(null, listingData.map(function(e) {\r\n      return new Date(e.issueDate);\r\n    })));\r\n    if(new Date(latestissuedate) > new Date(validate['amendmentDate']) ){\r\n      res.status(500).send('Amendment Date cannot be lesser than latest Issue Date');\r\n    }\r\n\t\r\n    if(new Date() < new Date(validate['amendmentDate'])){\r\n      res.status(500).send('Amendment Date cannot be in Future');\r\n    }\r\n\t  if(req.body.bulkcontractitemsupdate && validate['periodToDate'] && validate['periodFromDate'] ){\r\n\t if(new Date(validate['periodToDate']) < new Date(validate['periodFromDate']) ){\r\n      res.status(500).send('Period from date cannot be less than Period end date');\r\n    }\r\n\t  validate['amendmentDate']=moment(validate['amendmentDate']).format('YYYY-MM-DD')\r\n\t  if(new Date(validate['amendmentDate']) > new Date(validate['periodFromDate']) ){\r\n      res.status(500).send('Period From Date cannot be lesser than Amendment Date');\r\n    }\r\n\t}\r\n\t if(req.body.bulkcontractitemsupdate && validate['multiDeliveryToDate'] && validate['multiDeliveryFromDate'] ){\r\n\t if(new Date(validate['multiDeliveryToDate']) < new Date(validate['multiDeliveryFromDate']) ){\r\n      res.status(500).send('Period from date cannot be less than Period end date');\r\n    }\r\n\t  validate['amendmentDate']=moment(validate['amendmentDate']).format('YYYY-MM-DD')\r\n\t  if(new Date(validate['periodFromDate']) > new Date(validate['multiDeliveryFromDate']) ){\r\n      res.status(500).send('Period From Date cannot be lesser than Period From Date');\r\n    }\r\n\t}\r\n    res.status(200).send({}); \r\n    ",
    "sys__UUID" : "3088dee3-93d3-4c2d-9460-3a48b7694425",
    "sys__createdOn" : ISODate("2019-05-22T09:51:04.600Z"),
    "sys__createdBy" : "avinash.singh@ekaplus.com"
}