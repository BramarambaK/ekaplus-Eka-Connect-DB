{
    "_id" : "listing_component_processor",
    "name" : "component_initial_processor",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "5d907cd2-7785-4d34-bcda-aa84b2158415",
    "snippet" : "   var data = [];\r\n    var defaultDataURL =\r\n    req.body.propertyList.eka_connect_host + '/data/5d907cd2-7785-4d34-bcda-aa84b2158415/a17ad3d2-8c98-461d-98c7-d91e953aa819?componentDraftId=' +req.body.queryParams.componentDraftId+ '&itemNo=' + req.body.queryParams.itemNo;\r\n    \r\n    \r\n    \r\n    var defaultdata = {\r\n      method: 'GET',\r\n      url: defaultDataURL,\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    function get_defaultData() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(defaultdata, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n     var defaultDataURL1 =\r\n    req.body.propertyList.platform_url + '/mdmapi/productConstituent/' +req.body.queryParams.productId\r\n    var defaultdata1 = {\r\n      method: 'GET',\r\n      url: defaultDataURL1,\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    function get_defaultData1() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(defaultdata1, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n     get_defaultData1().then(function(component) {\r\n  console.log(component)\r\n     if(component.length > 0){\r\n     for(var i = 0 ; i<component.length;i++){\r\n     data.push({ \"productComponentName\": component[i].constituentProductName,\"quality\":component[i].qualityName });\r\n     }\r\n    get_defaultData().then(function(result) {\r\n    \r\n       for (var i = 0; i < data.length; i++) {\r\n         if(req.body.queryParams.ContractRefNo)\r\n          data[i]['internalContractRefNo'] = req.body.queryParams.ContractRefNo;\r\n        if(req.body.queryParams.ContractItemRefNo){\r\n        data[i]['internalContractItemRefNo'] = req.body.queryParams.ContractItemRefNo;\r\n        }\r\n        if(req.body.queryParams.itemNo){\r\n        data[i]['itemNo'] = req.body.queryParams.itemNo;\r\n        }\r\n        if(req.body.queryParams.componentDraftId){\r\n        data[i]['componentDraftId'] = req.body.queryParams.componentDraftId;\r\n        }\r\n\t\tdata[i]['internalGmrRefNo']='NA'\r\n\t\tdata[i]['gmrRefNo']='NA'\r\n\t\t\r\n        for(var j = 0 ; j<result.length;j++){\r\n        if(result[j].productComponentName === data[i].productComponentName && result[j].gmrRefNo ==='NA' ){\r\n        data[i].componentPercentage = result[j].componentPercentage\r\n        break\r\n        }\r\n        }\r\n        }\r\n      res.status(200).send(data);\r\n        }).catch(err => {\r\n          console.log(err);\r\n        });\r\n      }\r\n      else {\r\n      res.status(500).send(\"Please do the setup for the product\");\r\n      }\r\n      })\r\n",
    "sys__UUID" : "d0f23e59-5e43-4332-9a04-f1146a58eefb",
    "sys__createdOn" : ISODate("2019-12-26T05:17:29.849Z"),
    "sys__createdBy" : "Bravo"
}