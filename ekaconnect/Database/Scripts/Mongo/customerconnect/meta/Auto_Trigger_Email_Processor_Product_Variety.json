{
    "_id" : "Auto_Trigger_Email_Processor_Product_Variety",
    "name" : "Auto_Trigger_Email_Processor_Product_Variety",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "12325a98-a959-4939-9005-4158d136afcd",
    "snippet" : "var notifyApi = {};\r\n\r\n    var fromAddressApi = {\r\n      method: 'GET',\r\n      url: req.body.propertyList.eka_connect_host + '/property/' + req.body.appId + '/mail_from',\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    }\r\n    function get_fromAddressApiData() {\r\n      return new Promise(function (resolve, reject) {\r\n        request(fromAddressApi, function (err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    var toAddressApi = {\r\n      method: 'GET',\r\n      url: req.body.propertyList.eka_connect_host + '/property/' + req.body.appId + '/mail_toaddr_notifydatachange_failure',\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    }\r\n    function get_toAddressApiData() {\r\n      return new Promise(function (resolve, reject) {\r\n        request(toAddressApi, function (err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    function get_notifyApiData() {\r\n      return new Promise(function (resolve, reject) {\r\n        request(notifyApi, function (err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    get_fromAddressApiData().then((fromAddressApiData) => {\r\n      get_toAddressApiData().then((toAddressApiData) => {\r\n        var notifyApiBody = {\r\n          \"fromAddress\": fromAddressApiData.propertyValue,\r\n          \"toAddress\": toAddressApiData.propertyValue,\r\n          \"ccAddress\": null,\r\n          \"bccAddress\": null,\r\n          \"subject\": req.body.objectName + ' ' + req.body.payload.httpMethod + ' FAILURE',\r\n          \"message\": req.body.objectName + \"<br>\" + req.body.payload.httpMethod + \"<br>Created On :\" + req.body.createdDate + \"</b><br><br>Request Body : \" + JSON.stringify(req.body.payload) + \"<br>Error Details :\" + req.body.error.code + \" \" + req.body.error.message,\r\n          \"fileNames\": null,\r\n          \"contentType\": \"text/html\",\r\n          \"fileModel\": null,\r\n          \"docId\": null\r\n        }\r\n        notifyApi = {\r\n          method: 'POST',\r\n          url: req.body.propertyList.eka_connect_host + '/file/' + req.body.payload.app + '/' + req.body.appId + '/sendEmail/v2',\r\n          body: notifyApiBody,\r\n          headers: {\r\n            Authorization: req.headers.authorization,\r\n            'X-TenantID': req.headers['x-tenantid']\r\n          },\r\n          json: true\r\n        };\r\n        get_notifyApiData().then((notifyApiData) => {\r\n          res.status(200).send(notifyApiData);\r\n        }).catch(err => {\r\n          var notifyApiData = {};\r\n          res.status(200).send(notifyApiData);\r\n        })\r\n      }).catch(err => {\r\n        var toAddressApiData = {};\r\n        res.status(200).send(toAddressApiData);\r\n      })\r\n    }).catch(err => {\r\n      var fromAddressApiData = {};\r\n      res.status(200).send(fromAddressApiData);\r\n    });",
    "sys__UUID" : "171f7a1e-a381-11ec-b909-0242ac120002"
}