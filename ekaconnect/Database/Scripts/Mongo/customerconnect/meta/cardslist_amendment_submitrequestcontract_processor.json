{
  "_id": "cardslist_amendment_submitrequestcontract_processor",
  "name": "cardslist_amendment_submitrequestcontract_processor",
  "type": "processor",
  "refType": "app",
  "refTypeId": "12325a98-a959-4939-9005-4158d136afcd",
  "snippet": "    // function get_email() {\r\n    //   return new Promise(function(resolve, reject) {\r\n    //     request(email, function(err, response, body) {\r\n    //       if (response && response.statusCode >= 200 && response.statusCode <= 299) {\r\n    //         resolve(body);\r\n    //       } else {\r\n    //         reject(body);\r\n    //       }\r\n    //     });\r\n    //   });\r\n    // }\r\n\r\n    function get_customer() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(customer, function(err, response, body) {\r\n          if (response && response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          } else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    // var email = {\r\n    //   method: 'GET',\r\n    //   url: req.body.propertyList.platform_url + '/cac-security/api/userinfo',\r\n    //   headers: {\r\n    //     Authorization: req.headers.authorization\r\n    //   },\r\n    //   json: true\r\n    // };\r\n\r\n    var customer = {\r\n      method: 'GET',\r\n      url: req.body.propertyList.eka_connect_host + '/api/getTenantCustomerData',\r\n      headers: {\r\n        Authorization: req.headers.authorization\r\n      },\r\n      json: true\r\n    };\r\n\r\n    // get_email()\r\n    //   .then(function(user) {\r\n        // customer.url = customer.url + user.email;\r\n        get_customer()\r\n          .then(function(userInfo) {\r\n            var customerType = userInfo.customerType;\r\n            var data = req.body.selectedData;\r\n            var send = function send(status, message) {\r\n              return res.status(status).send(message);\r\n            };\r\n            var cardsList = [];\r\n            if (data.data) {\r\n              cardsList.push({ cardType: 'commodity', commodity: data.data.product });\r\n              cardsList.push({ cardType: 'grade', grade: data.data.amendedQuality });\r\n              cardsList.push({ cardType: 'season', season: data.data.cropYear });\r\n              cardsList.push({ cardType: 'quantity', quantity: Number(data.data.contractItemQuantityInBase).toFixed(2) });\r\n              cardsList.push({ cardType: 'price', price: '$' + Number(data.data.amendedPrice).toFixed(2) });\r\n              cardsList.push({ cardType: 'paymentterm', paymentTerm: data.data.paymentTerms });\r\n              cardsList.push({ cardType: 'incoterm', incoTerm: data.data.INCOTerm });\r\n              cardsList.push({ cardType: 'deliverylocation', deliveryLocation: data.data.amendedCity });\r\n              cardsList.push({\r\n                cardType: 'deliverystart',\r\n                deliveryStart: moment(data.data.amendedShipmentFrom).format('DD MMM YYYY')\r\n              });\r\n              cardsList.push({\r\n                cardType: 'deliveryend',\r\n                deliveryEnd: moment(data.data.amendedShipmentTo).format('DD MMM YYYY')\r\n              });\r\n              // send(200, { submitrequestcontractcardview: cardsList, data });\r\n            }\r\n            data = { ...data.data };\r\n            data.submitrequestcontractcardview = cardsList;\r\n            data.userType = customerType;\r\n            send(200, { data });\r\n          })\r\n          .catch(function(err) {\r\n            var data = {};\r\n            res.status(200).send(data);\r\n          });\r\n    //   })\r\n    //   .catch(function(err) {\r\n    //     var data = {};\r\n    //     res.status(200).send(data);\r\n    //   });",
  "sys__UUID": "49aeecf0-05f7-44d6-ac71-b6bb326f0f83"
}
