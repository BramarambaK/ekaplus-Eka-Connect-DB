{
  "_id": "amendment_requestcontract_decision_step3_processor",
  "name": "amendment_requestcontract_decision_step3_processor",
  "type": "processor",
  "refType": "app",
  "refTypeId": "12325a98-a959-4939-9005-4158d136afcd",
  "snippet": "\r\n    var data = req.body;\r\n    var output = {};\r\n    let obj = data.amendment_requestcontractfreightcomposite.amendment_requestcontractfreightdetails;\r\n    let freightData = {};\r\n\r\n    freightData = {\r\n      amendedFreightOrganise: obj.amendedFreightOrganise,\r\n      amendedFullname: obj.amendedFullname || '',\r\n      amendedEmail: obj.amendedEmail || '',\r\n      amendedPhonenumber: obj.amendedPhonenumber || NaN,\r\n      amendedPickuplocation: obj.amendedPickuplocation || ''\r\n    };\r\n\r\n    if (data.amendment_requestcontractfreightcomposite.data) {\r\n      output = {\r\n        ...data.amendment_requestcontractfreightcomposite.data,\r\n        ...freightData\r\n      };\r\n    } else {\r\n      output = {\r\n        ...data.amendment_requestcontractfreightcomposite,\r\n        ...freightData\r\n      };\r\n    }\r\n\r\n    delete output.amendment_requestcontractdetailsform;\r\n\r\n    var freightErrorData = req.body.amendment_requestcontractfreightcomposite;\r\n    var isFreightError = true;\r\n\r\n    function validateForm() {\r\n      var field = freightErrorData.amendment_requestcontractfreightdetails;\r\n      var mandatoryFields = [field.amendedFullname, field.amendedEmail, field.amendedPhonenumber];\r\n      var vaildateEmail = (field.amendedEmail).match(\/^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$\/);\r\n      if (vaildateEmail) {\r\n        for (var i = 0; i <= mandatoryFields.length - 1; i++) {\r\n          if (\r\n            (mandatoryFields[i] == '' || mandatoryFields[i] == undefined || mandatoryFields[i] == null) &&\r\n            isFreightError\r\n          ) {\r\n            res.status(400).send('Please provide mandatory fields');\r\n            isFreightError = false;\r\n          }\r\n        }\r\n        \/\/ data = output;\r\n        res.status(200).send({\r\n          ...output,\r\n          INCOTerm: output.amendedFreightOrganise.toLowerCase().includes('cargill') ? 'Ex-Farm' : 'DB'\r\n        });\r\n      } else {\r\n        res.status(400).send('Email format should be valid (SIMILER like request creation)');\r\n        isFreightError = false;\r\n      }\r\n    }\r\n\r\n    if (\r\n      freightErrorData.amendment_requestcontractfreightdetails.amendedFreightOrganise == null ||\r\n      freightErrorData.amendment_requestcontractfreightdetails.amendedFreightOrganise == undefined ||\r\n      freightErrorData.amendment_requestcontractfreightdetails.amendedFreightOrganise == ''\r\n    ) {\r\n      res.status(400).send('Please select Who would you like to organise freight and logistics?');\r\n    } else if (output.amendedFreightOrganise.toLowerCase().includes('delivered buyer')) {\r\n      \/\/ data = output;\r\n      res.status(200).send({ ...output });\r\n    } else {\r\n      validateForm();\r\n    }",
  "sys__UUID": "bb5f936b-ad7f-4921-b0c8-d86cc2f1ee22"
}
