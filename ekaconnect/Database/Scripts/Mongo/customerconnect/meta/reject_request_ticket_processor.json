{
    "_id" : "reject_request_ticket_processor",
    "name" : "reject_request_ticket_processor",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "12325a98-a959-4939-9005-4158d136afcd",
    "snippet" : "\r\n    let data = req.body;\r\nconst tenant = req.headers[\"X-TenantID\"];\r\nconst auth = req.headers.authorization;\r\nconst appId = req.body.appId;\r\nconst send = (status, message) => res.status(status).send(message);\r\nconst headers = {\r\n  Authorization: auth,\r\n  \"X-TenantID\": tenant,\r\n  \"Content-Type\": \"application\/json\",\r\n};\r\nconst getData = (req) =>\r\n  new Promise((resolve, reject) => {\r\n    request(\r\n      {\r\n        ...req,\r\n        headers: headers,\r\n        json: true,\r\n      },\r\n      (err, response, body) => {\r\n        if (\r\n          response &&\r\n          response.statusCode >= 200 &&\r\n          response.statusCode <= 299\r\n        ) {\r\n          resolve(body);\r\n        } else {\r\n          reject(err || body.error || body.errorMessage);\r\n        }\r\n      }\r\n    );\r\n  });\r\nconst workflow = (body) =>\r\n  getData({\r\n    method: \"POST\",\r\n    url: `${req.body.propertyList.eka_connect_host}\/workflow`,\r\n    body: body,\r\n  });\r\nconst updateTicket = (t) =>\r\n  workflow({\r\n    output: {\r\n      elastic_updateTicketOfferData_withoutOfferExecution_internal: [t],\r\n    },\r\n    task: \"elastic_updateTicketOfferData_withoutOfferExecution_internal\",\r\n    workflowTaskName:\r\n      \"elastic_updateTicketOfferData_withoutOfferExecution_internal\",\r\n    appId: \"12325a98-a959-4939-9005-4158d136afcd\",\r\n  });\r\n\r\nconst updatedTicket = {\r\n  requestId: data.requestId,\r\n  ticketRefNo: data.ticketRefNo,\r\n  cropYear: data.cropYear,\r\n  requestStatus: \"Rejected\",\r\n  isRequestActive: false,\r\n};\r\nupdateTicket(updatedTicket)\r\n  .then(() => {\r\n    console.log(\"request ID\", data.requestId);\r\n        send(200, {\r\n          requestId: data.requestId,\r\n          msg: data.requestId + \" has been successfully rejected.\",\r\n          priceInvalid: false,\r\n          tabIndex: 2,\r\n          ngrFilter: data.BPRefNo,\r\n        });\r\n  })\r\n  .catch((err) => {\r\n    console.error(err);\r\n    send(500, \"Request cannot be rejected, please contact system admin\");\r\n  });\r\n  ",
    "sys__UUID" : "325c192c-f39e-4c71-ac0b-df46763f7242"
}