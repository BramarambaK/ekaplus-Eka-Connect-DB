{
  "_id": "open_tab_request_details_processor",
  "name": "open_tab_request_details_processor",
  "type": "processor",
  "refType": "app",
  "refTypeId": "12325a98-a959-4939-9005-4158d136afcd",
  "snippet": "var data = req.body.bulkPayLoadData ? req.body.bulkPayLoadData[0] : req.body;\r\n    const sendError = (message, context, localizedMessage) =>\r\n      res.status(400).send({\r\n        errorCode: '004',\r\n        errorMessage: message,\r\n        errorContext: null,\r\n        errorLocalizedMessage: localizedMessage,\r\n        errors: [\r\n          {\r\n            errorCode: '004',\r\n            errorMessage: message,\r\n            errorContext: context,\r\n            errorLocalizedMessage: localizedMessage,\r\n            errors: null\r\n          }\r\n        ]\r\n      });\r\n\r\n    const objid = '46e84f42-6288-4027-b6d0-fd1c11019259';\r\n    const appid = '12325a98-a959-4939-9005-4158d136afcd';\r\n    var connect = {\r\n      method: 'GET',\r\n      body: {\r\n        filterData: {\r\n          filter: [\r\n            {\r\n              fieldName: 'contractItemRefNo',\r\n              value: data.contractItemRefNo,\r\n              operator: 'eq'\r\n            },\r\n            {\r\n              fieldName: 'contractRefNo',\r\n              value: data.contractRefNo,\r\n              operator: 'eq'\r\n              },\r\n              {\r\n                fieldName: 'isRequestedByEkaCCSystem',\r\n                value: true,\r\n                operator: 'eq'\r\n            }\r\n          ]\r\n        }\r\n      },\r\n      url: req.body.propertyList.eka_connect_host + '/data/' + appid + '/' + objid,\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid'],\r\n        // 'X-TenantID': 'account28',\r\n        requestid: req.headers['requestid'] + '-processor'\r\n      },\r\n      json: true\r\n    };\r\n\r\n    function getRequestStatus() {\r\n      console.log('connect obj', JSON.stringify(connect));\r\n      return new Promise(function(resolve, reject) {\r\n        request(connect, function(err, response, body) {\r\n          console.log('res', JSON.stringify(body));\r\n          if (err || body.error) {\r\n            console.log('error occured ::' + body.error);\r\n            reject(body);\r\n          } else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    getRequestStatus()\r\n      .then(async function(reqData) {\r\n        if (reqData.length > 0) {\r\n          let request = reqData[0];\r\n        //   request.dischargeLocationCity = request.dischargeLocationCity || request.deliveryLocationGroupName;\r\n        //   request.amendedSpread =  request.amendedSpread || request.spread || undefined;\r\n        //   request.amendedPickuplocation =  request.amendedPickuplocation || request.pickuplocation || undefined;\r\n          res.status(200).send([{ ...request }]);\r\n        } else {\r\n          sendError(\r\n            'Contract is already withdrawn please refresh the page.',\r\n            '',\r\n            'Your request was unable to be processed. Please contact the Grower Services team on 1800 447 246 if this issue persists.'\r\n          );\r\n        }\r\n      })\r\n      .catch(err => {\r\n        console.error(err);\r\n        res\r\n          .status(400)\r\n          .send(\r\n            'Your request was unable to be processed. Please contact the Grower Services team on 1800 447 246 if this issue persists.'\r\n          );\r\n      });",
  "sys__UUID": "fcef2ff5-4349-4db1-89c2-e7742bac9ee3"
}
