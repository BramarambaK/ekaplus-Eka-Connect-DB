{
  "_id": "contract_notifydelete_processor",
  "name": "contract_notifydelete_processor",
  "type": "processor",
  "refType": "app",
  "refTypeId": "12325a98-a959-4939-9005-4158d136afcd",
  "snippet": "\r\n    var connectData = {\r\n      method: \"GET\",\r\n      url:\r\n        req.body.propertyList.eka_connect_host +\r\n        \"/data/12325a98-a959-4939-9005-4158d136afcd/46e84f42-6288-4027-b6d0-fd1c11019259\",\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        \"X-TenantID\": req.headers[\"x-tenantid\"]\r\n      },\r\n      body: {\r\n\r\n      },\r\n      json: true\r\n    };\r\n    function get_connectData() {\r\n      return new Promise(function (resolve, reject) {\r\n        request(connectData, function (err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    let finalData = [];\r\n    let data = req.body.bulkPayLoadData[0];\r\n    if (data) {\r\n      var contractPayload = req.body.bulkPayLoadData[0];\r\n      var contractItemRefNos = [];\r\n      var contractRefNo = contractPayload.contractHeader.contractRefNo;\r\n      let noOfItems = 0;\r\n      noOfItems =\r\n        data &&\r\n        data.contractItems &&\r\n        data.contractItems.contractItem &&\r\n        data.contractItems.contractItem.length;\r\n\r\n      for (var i = 0; i < noOfItems; i++) {\r\n        contractItemRefNos.push(data.contractItems.contractItem[i][\"contractItemRefNo\"]);\r\n      }\r\n      console.log(JSON.stringify(contractItemRefNos));\r\n      let filter = {\r\n        \"filterData\": {\r\n          \"filter\": [\r\n            {\r\n              \"fieldName\": \"contractRefNo\",\r\n              \"value\": [contractRefNo],\r\n              \"operator\": \"in\"\r\n            }, {\r\n              \"fieldName\": \"contractItemRefNo\",\r\n              \"value\": contractItemRefNos,\r\n              \"operator\": \"in\"\r\n            }\r\n          ]\r\n        }\r\n      }\r\n      connectData.body = filter;\r\n      console.log(\"filter :\" + filter);\r\n      get_connectData()\r\n        .then(async (result) => {\r\n          if (result.length > 0) {\r\n            //\tconsole.log(\"connect data :\"+JSON.stringify(result));\r\n            for (let i = 0; i < result.length; i++) {\r\n              finalData.push({\r\n                \"contractRefNo\": result[i][\"contractRefNo\"],\r\n                \"contractItemRefNo\": result[i][\"contractItemRefNo\"],\r\n                \"sys__data_state\": \"Delete\",\r\n                \"id\": result[i][\"_id\"]\r\n              })\r\n            }\r\n            res.status(200).send(finalData);\r\n          }\r\n          else {\r\n            res.status(500).send(\"No Records Found\");\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          res.status(500).send(err);\r\n        });\r\n    }\r\n ",
  "sys__UUID": "02071e62-af61-4971-b1ec-0b3bccf18fa5"
}
