{
  "_id": "submitallocatedtickets_processor",
  "name": "submitallocatedtickets_processor",
  "type": "processor",
  "refType": "app",
  "refTypeId": "12325a98-a959-4939-9005-4158d136afcd",
  "snippet": "const data = req.body.selectedData.data;\r\n    console.log('Rendered Cards:', JSON.stringify(data[0]));\r\n    const send = (status, message) => res.status(status).send(message);\r\n\r\n    if (data && data.length > 0) {\r\n      const cardsList = [];\r\n      const reducedData = data.reduce(\r\n        (acc, curr) => {\r\n          if (!acc.grades.includes(curr.quality) && curr.tonnesSold > 0) {\r\n            acc.grades.push(curr.quality);\r\n          }\r\n\r\n          acc.totalQuantity += parseFloat(curr.tonnesSold);\r\n          return acc;\r\n        },\r\n        {\r\n          grades: [],\r\n          totalQuantity: 0\r\n        }\r\n      );\r\n\r\n      cardsList.push({\r\n        cardType: 'count',\r\n        count: data.filter(i => i.tonnesSold > 0).length,\r\n        bpName: `${data[0].bpName} - ${data[0].bpRefNo}`,\r\n        acquirer: data[0].acquirer\r\n      });\r\n\r\n      cardsList.push({\r\n        cardType: 'site',\r\n        site: data[0].location\r\n      });\r\n\r\n      cardsList.push({\r\n        cardType: 'commodity',\r\n        commodity: data[0].product\r\n      });\r\n\r\n      cardsList.push({\r\n        cardType: 'grade',\r\n        grades: (reducedData.grades.length > 3 ? reducedData.grades.slice(0, 3) : reducedData.grades).join(', '),\r\n        suffix: reducedData.grades.length > 3 ? `+${reducedData.grades.length - 3} more` : null,\r\n        suffixTooltip: reducedData.grades.length > 3 ? reducedData.grades.slice(3).join(', ') : null,\r\n        additionalTooltip: data[0].sellingOption.toLowerCase() == 'cash' && (data[0].isSustainable == true || data[0].isSustainable == 'Yes') ? 'sustainable-icon' : '',\r\n        additionalTooltipContent: 'Sustainable'\r\n      });\r\n\r\n      cardsList.push({\r\n        cardType: 'totalQuantity',\r\n        totalQuantity: reducedData.totalQuantity.toFixed(2) + ' MT'\r\n      });\r\n\r\n      cardsList.push({\r\n        cardType: 'basePrice',\r\n        basePrice:\r\n          data[0].sellingOption == 'Contract' && (data[0].contractPrice && !isNaN(data[0].contractPrice))\r\n            ? '$' + (+data[0].contractPrice).toFixed(2)\r\n            : '$' + (+data[0].price).toFixed(2)\r\n      });\r\n\r\n      cardsList.push({\r\n        cardType: 'sellingOption',\r\n        sellingOption: data[0].sellingOption\r\n      });\r\n\r\n      if (data[0].sellingOption == 'Contract')\r\n        cardsList.push({\r\n          cardType: 'contractNo',\r\n          contractNo: data[0].contractNumber ? data[0].contractNumber : '-'\r\n        });\r\n\r\n      send(200, {\r\n        submitallocatedcardview: cardsList,\r\n        data\r\n      });\r\n    } else {\r\n      send(400, 'No data to be added');\r\n    }",
  "sys__UUID": "0a727bc0-0acd-422a-98ad-975858dbd132"
}
