{
  "_id": "badandgoodrequestsave_WARRANT",
  "name": "badandgoodrequestsave",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\n    var save_data_connect = {\r\n      method: 'POST',\r\n      body: {},\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    function save_data(outputData) {\r\n      save_data_connect.url = req.body.propertyList.eka_connect_host + '/workflow';\r\n      save_data_connect.body = {\r\n        appId: 'ada131db-5171-4b9c-b6d6-caae0c6cd2f5',\r\n        workflowTaskName: 'save_stocks',\r\n        task: 'save_stocks',\r\n        output: { save_stocks: outputData }\r\n      };\r\n      return new Promise(function (resolve, reject) {\r\n        request(save_data_connect, function (err, response, body) {\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          }\r\n          else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    let data = [];\r\n    let da = req.body.bulkPayLoadData;\r\n    for (let i = 0; i < da.length; i++) {\r\n      if (da[i].status == true) {\r\n        da[i]['grading_status'] = 'Pending'\r\n        da[i]['activityDate'] = da[i]['activityDate'].slice(1, 25);\r\n        data.push(da[i]);\r\n      }\r\n    }\r\n    var url = req.body.propertyList.platform_url + '/api/logistic/stockDetailsUpdate';\r\n    var apiDetails = {\r\n      method: 'PUT',\r\n      url: url,\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      json: true\r\n    };\r\n    function post_data(body) {\r\n      apiDetails.body = [];\r\n      apiDetails.body = body;\r\n      return new Promise(function (resolve, reject) {\r\n        request(apiDetails, function (err, response, body) {\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          }\r\n          else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    let bulkPayLoadData = [];\r\n    bulkPayLoadData = data;\r\n    var body = [];\r\n    for (var i = 0; i < bulkPayLoadData.length; i++) {\r\n      body.push({\r\n        gradingStatus: bulkPayLoadData[i]['grading_status'],\r\n        externalStkRefNo: bulkPayLoadData[i]['ext_stock_ref_no'],\r\n        isDeleted: 'N',\r\n        goodsRecordDetailPkDO: {\r\n          internalGrdRefNo: bulkPayLoadData[i]['internal_grd_dgrd_ref_no']\r\n        }\r\n      });\r\n    }\r\n    post_data(body)\r\n      .then(function (result) {\r\n        save_data(data).then(function (result2) {\r\n          res.status(200).send(data);\r\n        })\r\n      })\r\n      .catch(err => {\r\n        res.status(500).send('Post to TRM Api not working');\r\n      });\r\n ",
  "sys__UUID": "54ad3490-f6e9-40e9-9f11-310449d69e90",
  "sys__createdBy": "Bravo"
}
