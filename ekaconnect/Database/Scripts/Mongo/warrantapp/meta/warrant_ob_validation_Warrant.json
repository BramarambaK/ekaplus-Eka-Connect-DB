{
  "_id": "warrant_ob_validation_Warrant",
  "name": "warrant_ob_validation",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\n    var mdmData = {\r\n      method: 'POST',\r\n      url: req.body.propertyList.eka_mdm_host + '/mdm/ada131db-5171-4b9c-b6d6-caae0c6cd2f5/data',\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid'],\r\n        'Content-Type': 'application/json'\r\n      },\r\n      json: true\r\n    };\r\n    function get_mdmData(body) {\r\n      mdmData.body = [];\r\n      mdmData.body = body;\r\n      return new Promise(function (resolve, reject) {\r\n        request(mdmData, function (err, response, body) {\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          }\r\n          else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    const moment = require('moment');\r\n    if (!req.body['activityDate'] || !req.body['instrument_name'] || !req.body['warrant_remarks']) {\r\n      res.status(500).send('Please fill all Mandatory fields');\r\n    }\r\n    if (moment(req.body['activityDate']) > moment(new Date())) {\r\n      res.status(500).send(\"Activity Date Cannot be greater than Today's Date\");\r\n    }\r\n    var body = [];\r\n    if (req.body && req.body['instrument_name']) {\r\n      body = [\r\n        {\r\n          serviceKey: 'qualityMapInstrument',\r\n          dependsOn: [req.body.instrument_name]\r\n        }\r\n      ];\r\n    }\r\n    get_mdmData(body).then(function (result) {\r\n      var mdmQuality = [];\r\n      for (var i = 0; i < result.qualityMapInstrument.length; i++) {\r\n        mdmQuality.push(result.qualityMapInstrument[i]['value']);\r\n      }\r\n      req.body.quality = mdmQuality.toString();\r\n      var response = {\r\n        instrument_name_value: req.body.instrument_name_value,\r\n        instrument_name: req.body.instrument_name,\r\n        activityDate: req.body.activityDate,\r\n        quality: req.body.quality,\r\n        request_type: req.body.request_type,\r\n        warrant_remarks: req.body.warrant_remarks\r\n      };\r\n      res.status(200).send(response);\r\n    });\r\n\r\n ",
  "sys__UUID": "4d70b285-ee16-444c-803f-1ef93afb4507",
  "sys__createdBy": "ekauser@ekaplus.com"
}
