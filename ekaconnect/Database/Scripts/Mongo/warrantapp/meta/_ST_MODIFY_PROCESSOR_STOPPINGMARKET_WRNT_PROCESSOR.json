{
  "_id": "_ST_MODIFY_PROCESSOR_STOPPINGMARKET_WRNT_PROCESSOR",
  "name": "_ST_MODIFY_PROCESSOR_STOPPINGMARKET_WRNT_PROCESSOR",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\nvar connectUrl = req.body.propertyList.eka_connect_host + '/workflow/data';\r\nvar connectBody = {\r\n    appId: req.body.appId,\r\n    workFlowTask: 'dummycontractlist'\r\n};\r\nvar connect = {\r\n    method: 'POST',\r\n    body: connectBody,\r\n    url: connectUrl,\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n    },\r\n    json: true\r\n};\r\nfunction get_connect() {\r\n    return new Promise(function (resolve, reject) {\r\n        request(connect, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction get_stoppingList() {\r\n    connect.body = {\r\n        appId: req.body.appId,\r\n        workFlowTask: 'dummystoppinglist'\r\n    };\r\n    return new Promise(function (resolve, reject) {\r\n        request(connect, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nPromise.all([get_connect(), get_stoppingList()]).then(function (result) {\r\n    let contractlist = result[0].data;\r\n    let stoppinglist = result[1].data;\r\n    let selectedData = req.body;\r\n    var outputArr = [];\r\n    var outputData = [];\r\n    if (selectedData.purchase_contract_ref_no) {\r\n        selectedData['contract_ref_no'] = selectedData.purchase_contract_ref_no;\r\n    }\r\n    for (let j = 0; j < contractlist.length; j++) {\r\n        if (selectedData['contract_ref_no'] == contractlist[j]['contract_ref_no']) {\r\n            outputArr.push(contractlist[j]);\r\n        }\r\n    }\r\n    for (let i = 0; i < stoppinglist.length; i++) {\r\n        for (let j = 0; j < outputArr.length; j++) {\r\n            if (\r\n                outputArr[j]['ext_stock_ref_no'] == stoppinglist[i]['ext_stock_ref_no'] ||\r\n                (outputArr[j]['ext_stock_ref_no_array'] &&\r\n                    outputArr[j]['ext_stock_ref_no_array'].includes(stoppinglist[i]['ext_stock_ref_no']))\r\n            ) {\r\n                outputData.push({ ...stoppinglist[i], ...outputArr[j] });\r\n            }\r\n        }\r\n    }\r\n    outputData = outputData.reduce((unique, o) => {\r\n        if (!unique.some(obj => obj.ext_stock_ref_no === o.ext_stock_ref_no)) {\r\n            unique.push(o);\r\n        }\r\n        return unique;\r\n    }, []);\r\n    for (let i = 0; i < outputData.length; i++) {\r\n        outputData[i]['warrant_remarks'] = selectedData.warrant_remarks;\r\n        delete outputData[i]['_id'];\r\n        delete outputData[i]['object'];\r\n        delete outputData[i]['refTypeId'];\r\n        if (outputData[i]['sys__createdBy']) delete outputData[i]['sys__createdBy'];\r\n        if (outputData[i]['sys__createdOn']) delete outputData[i]['sys__createdOn'];\r\n        if (outputData[i]['sys__data__state']) delete outputData[i]['sys__data__state'];\r\n        if (outputData[i]['sys__updatedBy']) delete outputData[i]['sys__updatedBy'];\r\n        if (outputData[i]['sys__updatedOn']) delete outputData[i]['sys__updatedOn'];\r\n        if (outputData[i]['sys__UUID']) delete outputData[i]['sys__UUID'];\r\n        if (outputData[i]['sys__version']) delete outputData[i]['sys__version'];\r\n        if (outputData[i]['userId']) delete outputData[i]['userId'];\r\n        outputData[i]['futurePrice'] = req.body.futurePrice;\r\n        outputData[i]['warrant_remarks'] = req.body.warrant_remarks;\r\n    }\r\n    res.status(200).send(outputData);\r\n});\r\n",
  "sys__UUID": "afed14be-94c7-4220-91f4-0044a5e1f8be",
  "sys__createdBy": "ekauser@ekaplus.com"
}
