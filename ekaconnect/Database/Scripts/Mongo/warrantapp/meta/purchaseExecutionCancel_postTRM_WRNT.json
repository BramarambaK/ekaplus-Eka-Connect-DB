{
  "_id": "purchaseExecutionCancel_postTRM_WRNT",
  "name": "purchaseExecutionCancel_postTRM",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\nvar connectDeleteUrl =\r\n    req.body.propertyList.eka_connect_host +\r\n    '/data/ada131db-5171-4b9c-b6d6-caae0c6cd2f5/00b0627c-e0dd-4530-a765-116ab9748487/bulkDelete';\r\nvar connectDelete = {\r\n    method: 'DELETE',\r\n    url: connectDeleteUrl,\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n    },\r\n    json: true\r\n};\r\nfunction get_connect_delete(body) {\r\n    connectDelete.body = {};\r\n    connectDelete.body = body;\r\n    return new Promise(function (resolve, reject) {\r\n        request(connectDelete, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nlet selectedData = req.body.bulkPayLoadData;\r\n\r\nif (selectedData.length <= 0) {\r\n    res.status(500).send('Error in selected Data');\r\n}\r\nvar outputData = {\r\n    effDate: selectedData[0].activityDate,\r\n    isExternalGMR: 'Yes',\r\n    gmrRefNo: selectedData[0].gmr_ref_no\r\n};\r\nvar platformurl = req.body.propertyList.platform_url + '/api/logisticinternal/purchaseloadingexceution/Cancel';\r\nvar platformapi = {\r\n    method: 'POST',\r\n    body: outputData,\r\n    url: platformurl,\r\n    headers: {\r\n        Authorization: req.headers.authorization\r\n    },\r\n    json: true\r\n};\r\nconsole.log(platformapi);\r\nfunction get_platform() {\r\n    return new Promise(function (resolve, reject) {\r\n        request(platformapi, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nget_platform()\r\n    .then(function (result) {\r\n        console.log(result);\r\n        if (result.status == 'success') {\r\n            var int_stock_ref_no = [];\r\n            for (var i = 0; i < selectedData.length; i++) {\r\n                int_stock_ref_no.push(selectedData[i]['int_stock_ref_no']);\r\n            }\r\n            var deletebody = {};\r\n            deletebody = {\r\n                filterData: {\r\n                    filter: [\r\n                        {\r\n                            fieldName: 'stock_ref_no',\r\n                            value: int_stock_ref_no,\r\n                            operator: 'in'\r\n                        }\r\n                    ]\r\n                }\r\n            };\r\n            get_connect_delete(deletebody).then(function (result) {\r\n                var output = {};\r\n                for (var i = 0; i < selectedData.length; i++) {\r\n                    output = {\r\n                        contract_ref_no: selectedData[i].contract_ref_no,\r\n                        GMR_Ref_No: '',\r\n                        int_stock_ref_no: '',\r\n                        internalstock: ''\r\n                    };\r\n                }\r\n                res.status(200).send(output);\r\n            });\r\n        } else {\r\n            if (result.description) {\r\n                res.status(500).send('Error in Purchase execution cancellation:(' + result.description + ')');\r\n            } else {\r\n                res.status(500).send('Purchase execution cancellation api is failed, please try once again');\r\n            }\r\n        }\r\n    })\r\n    .catch(err => {\r\n        res.status(500).send('Purchase execution cancellation api is failed, please try once again');\r\n    });\r\n",
  "sys__UUID": "2fd36bf0-12e5-4709-b2c2-e4d041c3064a",
  "sys__createdBy": "Bravo"
}
