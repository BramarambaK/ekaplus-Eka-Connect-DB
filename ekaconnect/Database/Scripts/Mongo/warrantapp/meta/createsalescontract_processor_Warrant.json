{
  "_id": "createsalescontract_processor_Warrant",
  "name": "createsalescontract_processor_Warrant",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\nvar connectUrl = req.body.propertyList.eka_connect_host + '/workflow/data';\r\nvar connectBody = {\r\n    appId: req.body.appId,\r\n    workFlowTask: 'dummystocklist'\r\n};\r\nvar connect = {\r\n    method: 'POST',\r\n    body: connectBody,\r\n    url: connectUrl,\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n    },\r\n    json: true\r\n};\r\nfunction get_connect() {\r\n    return new Promise(function (resolve, reject) {\r\n        request(connect, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nvar url = req.body.propertyList.platform_url + '/mdmapi/masterdatas/instrumentPriceDetail/';\r\nvar api = {\r\n    method: 'POST',\r\n    url: url,\r\n    headers: {\r\n        Authorization: req.headers.authorization\r\n    },\r\n    json: true\r\n};\r\nfunction get_data(instrument_name_value) {\r\n    api.url =\r\n        req.body.propertyList.platform_url + '/mdmapi/masterdatas/instrumentPriceDetail/' + instrument_name_value;\r\n    return new Promise(function (resolve, reject) {\r\n        request(api, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nvar selectedData = req.body.selectedData;\r\nfunction manipulateData() {\r\n    let mdmProcessorServiceKey = JSON.parse(req.body.mdmProcessorServiceKey);\r\n    if (mdmProcessorServiceKey[0]['serviceKey'] == 'edmarkrefno') {\r\n        var mdmedmarkrefno = [];\r\n        mdmedmarkrefno.push({ key: selectedData.edmarkrefno, value: selectedData.edmarkrefno });\r\n        res.status(200).send({\r\n            edmarkrefno: mdmedmarkrefno\r\n        });\r\n    } else {\r\n        if (selectedData) {\r\n            get_connect().then(function (result) {\r\n                let edmarkrefno = selectedData.edmarkrefno;\r\n                let connect = result.data;\r\n                var connectArray = [];\r\n                for (var i = 0; i < connect.length; i++) {\r\n                    if (connect[i]['edmarkrefno'] == edmarkrefno) {\r\n                        connectArray.push(connect[i]);\r\n                    }\r\n                }\r\n                get_data(connectArray[0]['instrument_name_value']).then(function (result1) {\r\n                    var data = result1;\r\n                    var exchange_lot = 0;\r\n                    var Quantity_UOM;\r\n                    var actual_quantity;\r\n                    var product;\r\n                    var origin;\r\n                    var cropyear;\r\n                    var quality;\r\n                    var Packing_Size;\r\n                    var storage_location;\r\n                    var instrument_name_value;\r\n                    var Profit_Center;\r\n                    var Strategy;\r\n                    var corporate;\r\n                    for (var i = 0; i < connectArray.length; i++) {\r\n                        if (connectArray[i]['exchange_lot']) {\r\n                            // connectArray[i]['exchange_lot'] = parseInt(connectArray[i]['exchange_lot']);\r\n                            exchange_lot = exchange_lot + connectArray[i]['exchange_lot'];\r\n                        }\r\n                        if (connectArray[i]['Quantity_UOM']) {\r\n                            Quantity_UOM = connectArray[i]['Quantity_UOM'];\r\n                        }\r\n                        if (connectArray[i]['product']) {\r\n                            product = connectArray[i]['product'];\r\n                        }\r\n                        if (connectArray[i]['origin']) {\r\n                            origin = connectArray[i]['origin'];\r\n                        }\r\n                        if (connectArray[i]['cropyear']) {\r\n                            cropyear = connectArray[i]['cropyear'];\r\n                        }\r\n                        if (connectArray[i]['quality']) {\r\n                            quality = connectArray[i]['quality'];\r\n                        }\r\n                        if (connectArray[i]['Packing_Size']) {\r\n                            Packing_Size = connectArray[i]['Packing_Size'];\r\n                        }\r\n                        if (connectArray[i]['storage_location']) {\r\n                            storage_location = connectArray[i]['storage_location'];\r\n                        }\r\n                        if (connectArray[i]['instrument_name_value']) {\r\n                            instrument_name_value = connectArray[i]['instrument_name_value'];\r\n                        }\r\n                        if (connectArray[i]['Profit_Center']) {\r\n                            Profit_Center = connectArray[i]['Profit_Center'];\r\n                        }\r\n                        if (connectArray[i]['Strategy']) {\r\n                            Strategy = connectArray[i]['Strategy'];\r\n                        }\r\n                        if (connectArray[i]['corporate']) {\r\n                            corporate = connectArray[i]['corporate'];\r\n                        }\r\n                    }\r\n\r\n                    selectedData['futurePriceUnit'] = '';\r\n                    selectedData['futurePriceUnit'] = [{ key: data['priceUnitName'], value: data['priceUnitName'] }];\r\n                    selectedData['no_of_lots'] = '';\r\n                    selectedData['no_of_lots'] = exchange_lot;\r\n                    selectedData['quantityUnit'] = '';\r\n                    selectedData['quantity'] = '';\r\n                    selectedData['product'] = '';\r\n                    selectedData['origin'] = '';\r\n                    selectedData['cropyear'] = '';\r\n                    selectedData['quality'] = '';\r\n                    selectedData['Packing_Size'] = '';\r\n                    selectedData['storage_location'] = '';\r\n                    selectedData['corporate'] = '';\r\n                    selectedData['Profit_Center'] = '';\r\n                    selectedData['Strategy'] = '';\r\n                    if (selectedData['corporate']) {\r\n                        selectedData['corporate'] = selectedData['corporate'];\r\n                    } else {\r\n                        selectedData['corporate'] = corporate;\r\n                    }\r\n                    if (selectedData['Profit_Center']) {\r\n                        selectedData['Profit_Center'] = selectedData['Profit_Center'];\r\n                    } else {\r\n                        selectedData['Profit_Center'] = Profit_Center;\r\n                    }\r\n                    if (selectedData['Strategy']) {\r\n                        selectedData['Strategy'] = selectedData['Strategy'];\r\n                    } else {\r\n                        selectedData['Strategy'] = Strategy;\r\n                    }\r\n                    if (selectedData['Quantity_UOM']) {\r\n                        selectedData['quantityUnit'] = selectedData['Quantity_UOM'];\r\n                    } else {\r\n                        selectedData['quantityUnit'] = Quantity_UOM;\r\n                    }\r\n                    if (selectedData['actual_quantity']) {\r\n                        selectedData['quantity'] = selectedData.exchangedeliverylist['quantity'];\r\n                        selectedData['actual_quantity'] = selectedData.exchangedeliverylist['quantity'];\r\n                    }\r\n                    if (selectedData['product']) {\r\n                        selectedData['product'] = selectedData['product'];\r\n                    } else {\r\n                        selectedData['product'] = product;\r\n                    }\r\n                    if (selectedData['origin']) {\r\n                        selectedData['origin'] = selectedData['origin'];\r\n                    } else {\r\n                        selectedData['origin'] = origin;\r\n                    }\r\n                    if (selectedData['cropyear']) {\r\n                        selectedData['cropyear'] = selectedData['cropyear'];\r\n                    } else {\r\n                        selectedData['cropyear'] = cropyear;\r\n                    }\r\n                    if (selectedData['quality']) {\r\n                        selectedData['quality'] = selectedData['quality'];\r\n                    } else {\r\n                        selectedData['quality'] = quality;\r\n                    }\r\n                    if (selectedData['Packing_Size']) {\r\n                        selectedData['Packing_Size'] = selectedData['Packing_Size'];\r\n                    } else {\r\n                        selectedData['Packing_Size'] = Packing_Size;\r\n                    }\r\n                    if (selectedData['storage_location']) {\r\n                        selectedData['storage_location'] = selectedData['storage_location'];\r\n                    } else {\r\n                        selectedData['storage_location'] = storage_location;\r\n                    }\r\n                    if (selectedData['instrument_name_value']) {\r\n                        selectedData['instrument_name_value'] = selectedData['instrument_name_value'];\r\n                    } else {\r\n                        selectedData['instrument_name_value'] = instrument_name_value;\r\n                    }\r\n                    res.status(200).send(selectedData);\r\n                });\r\n            });\r\n        }\r\n    }\r\n}\r\nmanipulateData();\r\n",
  "sys__UUID": "a4d9ad3c-17af-44c2-b341-ce309dee9f16",
  "sys__createdBy": "ekauser@ekaplus.com"
}
