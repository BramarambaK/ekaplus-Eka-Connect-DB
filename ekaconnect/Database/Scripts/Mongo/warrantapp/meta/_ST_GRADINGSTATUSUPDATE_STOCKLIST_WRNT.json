{
  "_id": "_ST_GRADINGSTATUSUPDATE_STOCKLIST_WRNT",
  "name": "_ST_GRADINGSTATUSUPDATE_STOCKLIST_WRNT",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\n    var moment = require('moment');\r\n    var save_warrant = {\r\n      method: 'POST',\r\n      url: req.body.propertyList.eka_connect_host + '/workflow',\r\n      body: {},\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    function data_save_warrant(workflowName, outputData) {\r\n      save_warrant.body = {\r\n        appId: req.body.appId,\r\n        workflowTaskName: workflowName,\r\n        task: workflowName,\r\n        output: {\r\n          [workflowName]: outputData\r\n        }\r\n      };\r\n      return new Promise(function (resolve, reject) {\r\n        console.log('save_warrant' + save_warrant);\r\n        request(save_warrant, function (err, response, body) {\r\n          console.log('Response save_warrant' + response + body);\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          }\r\n          else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    var url =\r\n      req.body.propertyList.platform_url +\r\n      '/mdmapi/masterdatas/instrumentPriceDetail/' +\r\n      req.body.bulkPayLoadData[0]['instrument_name_value'];\r\n    var api = {\r\n      method: 'POST',\r\n      url: url,\r\n      headers: {\r\n        Authorization: req.headers.authorization\r\n      },\r\n      json: true\r\n    };\r\n    function get_data() {\r\n      return new Promise(function (resolve, reject) {\r\n        console.log('api' + api);\r\n        request(api, function (err, response, body) {\r\n          console.log('Response api' + response + body);\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          }\r\n          else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    var apiDetails = {\r\n      method: 'PUT',\r\n      url: req.body.propertyList.platform_url + '/api/logistic/stockDetailsUpdate',\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      json: true\r\n    };\r\n    function post_data(body) {\r\n      apiDetails.body = [];\r\n      apiDetails.body = body;\r\n      console.log(apiDetails.body);\r\n      return new Promise(function (resolve, reject) {\r\n        request(apiDetails, function (err, response, body) {\r\n          console.log('Response apiDetails' + body);\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          }\r\n          else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    get_data().then(function (result) {\r\n      console.log('result' + result);\r\n      var output = result;\r\n      var bulkdata = [];\r\n      bulkdata = req.body.bulkPayLoadData;\r\n      for (var i = 0; i < bulkdata.length; i++) {\r\n        bulkdata[i]['grading_status'] = 'Pending';\r\n        if (output['lotSize']) {\r\n          if (bulkdata[i] && bulkdata[i]['actual_quantity']) {\r\n            bulkdata[i]['exchange_lot'] = '';\r\n            bulkdata[i]['exchange_lot'] = parseInt(bulkdata[i]['actual_quantity']) / parseInt(output['lotSize']);\r\n          }\r\n        }\r\n      }\r\n      data_save_warrant('save_warrant_stocks', bulkdata)\r\n        .then(function (saveData1) {\r\n          console.log('save_warrant_stocks' + saveData1);\r\n          var bulkPayLoadData = [];\r\n          bulkPayLoadData = req.body.bulkPayLoadData;\r\n          var body = [];\r\n          for (var i = 0; i < bulkPayLoadData.length; i++) {\r\n            if (bulkPayLoadData[i]['grading_status'] == 'NA') bulkPayLoadData[i]['grading_status'] = 'Pending';\r\n            var final_weight_date = moment\r\n              .utc(bulkPayLoadData[i]['final_weight_date'])\r\n              .utcOffset('+0530')\r\n              .format('YYYY-MM-DD');\r\n            var Grading_Date = moment\r\n              .utc(bulkPayLoadData[i]['Grading_Date'])\r\n              .utcOffset('+0530')\r\n              .format('YYYY-MM-DD');\r\n            var exchange_type = '';\r\n            var productClass = '';\r\n            if (bulkPayLoadData[i]['exchange_type']) {\r\n              exchange_type = bulkPayLoadData[i]['exchange_type'];\r\n            }\r\n            if (bulkPayLoadData[i]['class']) {\r\n              productClass = bulkPayLoadData[i]['class'];\r\n            }\r\n            body.push({\r\n              certificationStatus: bulkPayLoadData[i]['certification_status'],\r\n              gradingStatus: bulkPayLoadData[i]['grading_status'],\r\n              externalStkRefNo: bulkPayLoadData[i]['ext_stock_ref_no'],\r\n              gradingDate: Grading_Date,\r\n              finalWeightDate: final_weight_date,\r\n              exchangeType: exchange_type,\r\n              productClass: productClass,\r\n              isDeleted: 'N',\r\n              goodsRecordDetailPkDO: {\r\n                internalGrdRefNo: bulkPayLoadData[i]['internal_grd_dgrd_ref_no']\r\n              }\r\n            });\r\n          }\r\n          post_data(body)\r\n            .then(function (result) {\r\n              console.log('post_data' + result);\r\n              res.status(200).send(saveData1);\r\n            })\r\n        }).catch(err => {\r\n          res.status(500).send(err.errorMessage);\r\n        });;\r\n    });\r\n ",
  "sys__UUID": "2f5e932b-c2ed-4032-9bd6-695f4a0e4eee",
  "sys__createdBy": "Bravo"
}
