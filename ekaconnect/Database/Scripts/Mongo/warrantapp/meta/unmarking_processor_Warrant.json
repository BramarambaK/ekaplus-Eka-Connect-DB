{
  "_id": "unmarking_processor_Warrant",
  "name": "saveunmarking",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\nconst moment = require('moment');\r\nvar save_data_connect = {\r\n    method: 'PUT',\r\n    url:\r\n        req.body.propertyList.eka_connect_host +\r\n        '/data/updateBulk/ada131db-5171-4b9c-b6d6-caae0c6cd2f5/00b0627c-e0dd-4530-a765-116ab9748487',\r\n    body: {},\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n    },\r\n    json: true\r\n};\r\nfunction save_data(outputData) {\r\n    save_data_connect.body = {};\r\n    save_data_connect.body.data = outputData;\r\n    return new Promise(function (resolve, reject) {\r\n        request(save_data_connect, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nif (!req.body['data_transfer']) {\r\n    res.status(500).send('Please select valid records');\r\n}\r\nlet data = req.body['data_transfer'];\r\nif (data.length > req.body.propertyList.property_default_selection) {\r\n    res.status(500).send('Please select maximum 50 records');\r\n} else {\r\n    if (!req.body['warrant_remarks'] || req.body['warrant_remarks'] == '') {\r\n        res.status(500).send('Please fill the mandatory fields');\r\n    }\r\n    let f = true;\r\n    for (let i = 0; i < data.length; i++) {\r\n        if (moment(req.body['activityDate']) >= moment(data[i]['activityDate'])) {\r\n            data[i]['id'] = data[i]['_id'];\r\n            data[i]['_id'] = null;\r\n            data[i]['edmarkrefno'] = '';\r\n            data[i]['activityDate'] = req.body['activityDate'];\r\n            data[i]['warrant_remarks'] = req.body['warrant_remarks'];\r\n        } else {\r\n            f = false;\r\n            break;\r\n        }\r\n    }\r\n    if (f) {\r\n        save_data(data)\r\n            .then(function (result) {\r\n                console.log('Data saved in Connect');\r\n                res.status(200).send(data);\r\n            })\r\n            .catch(err => {\r\n                res.status(500).send('Data not unmarked');\r\n            });\r\n    } else\r\n        res\r\n            .status(500)\r\n            .send('Selected Record should have the activity Date less than or equal to the given Activity Date');\r\n}\r\n",
  "sys__UUID": "01e93a48-4475-4efb-8c8d-6d88fa5db826",
  "sys__createdBy": "ekauser@ekaplus.com"
}
