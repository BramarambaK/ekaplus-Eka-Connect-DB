{
  "_id": "modifycontract_trmapi_processor_WRNT",
  "name": "modifycontract_trmapi_processor_WRNT",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\nvar selectedData = req.body;\r\nvar platformurl = req.body.propertyList.platform_url + '/api/contract/warrantContract/modify';\r\nvar platformapi = {\r\n    method: 'POST',\r\n    url: platformurl,\r\n    headers: {\r\n        Authorization: req.headers.authorization\r\n    },\r\n    json: true\r\n};\r\nfunction get_platform() {\r\n    let outputData = {\r\n        contractRefNo: selectedData.sales_contract_ref_no + ',1',\r\n        contractPrice: selectedData.futurePrice.toString(),\r\n        modificationDate: selectedData.activityDate,\r\n        reasonForModify: selectedData.warrant_remarks\r\n    };\r\n    platformapi.body = outputData;\r\n    console.log(platformapi);\r\n    return new Promise(function (resolve, reject) {\r\n        request(platformapi, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nget_platform()\r\n    .then(function (result) {\r\n        var output = {};\r\n        console.log(result);\r\n        console.log(result);\r\n        if (result.status == 'success' || result.status == 'Pending') {\r\n            var data = JSON.parse(result.data);\r\n            output = {\r\n                contract_ref_no: result.externalRefNo,\r\n                contract_status: data.approvalStatus,\r\n                contract_creation_date: data.contractModificationDate,\r\n                CP_Name: data.cpName,\r\n                Profit_Center: data.profitCenter,\r\n                Strategy: data.strategy,\r\n                edmarkrefno: selectedData.edmarkrefno\r\n            };\r\n            res.status(200).send(output);\r\n        } else {\r\n            if (result.description) {\r\n                res.status(500).send('Error in Sales Contract Modification:(' + result.description + ')');\r\n            } else {\r\n                res.status(500).send('Sales Contract Modification Api is failing, please check');\r\n            }\r\n            return;\r\n        }\r\n    })\r\n    .catch(err => {\r\n        res.status(500).send('Sales Contract Modification Api is failing, please check');\r\n    });\r\n",
  "sys__UUID": "0bdb4cb8-de78-4950-9ab3-f270999af582",
  "sys__createdBy": "ekauser@ekaplus.com"
}
