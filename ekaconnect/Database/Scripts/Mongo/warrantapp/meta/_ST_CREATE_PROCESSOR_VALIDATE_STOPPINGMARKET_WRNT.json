{
  "_id": "_ST_CREATE_PROCESSOR_VALIDATE_STOPPINGMARKET_WRNT",
  "name": "_ST_CREATE_PROCESSOR_VALIDATE_STOPPINGMARKET_WRNT",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\nvar save_data_connect = {\r\n    method: 'POST',\r\n    body: {},\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n    },\r\n    json: true\r\n};\r\nfunction save_data(outputData) {\r\n    save_data_connect.url = req.body.propertyList.eka_connect_host + '/workflow';\r\n    save_data_connect.body = {\r\n        appId: 'ada131db-5171-4b9c-b6d6-caae0c6cd2f5',\r\n        workflowTaskName: 'save_stoppingmarket',\r\n        task: 'save_stoppingmarket',\r\n        output: { save_stoppingmarket: outputData }\r\n    };\r\n    return new Promise(function (resolve, reject) {\r\n        request(save_data_connect, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nvar connectDelete = {\r\n    method: 'DELETE',\r\n    url:\r\n        req.body.propertyList.eka_connect_host +\r\n        '/data/ada131db-5171-4b9c-b6d6-caae0c6cd2f5/6abda3f2-5e71-46c2-9912-a87bc0451410/bulkDelete',\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n    },\r\n    json: true\r\n};\r\nfunction get_connect_delete(body) {\r\n    connectDelete.body = {};\r\n    connectDelete.body = body;\r\n    return new Promise(function (resolve, reject) {\r\n        request(connectDelete, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nlet body = req.body;\r\nif (req.body.selectedData) {\r\n    let selectedData = JSON.parse(req.body.selectedData);\r\n    var ext_stock_ref_no = [];\r\n    if (body.activityDate && body.futurePrice && body.futurePrice > 0) {\r\n        for (var i = 0; i < selectedData.length; i++) {\r\n            selectedData[i]['activityDate'] = '';\r\n            selectedData[i]['activityDate'] = body.activityDate;\r\n            selectedData[i]['futurePrice'] = '';\r\n            selectedData[i]['futurePrice'] = body.futurePrice;\r\n            selectedData[i]['futurePriceUnit'] = '';\r\n            selectedData[i]['futurePriceUnit'] = body.futurePriceUnit;\r\n            ext_stock_ref_no.push(selectedData[i]['ext_stock_ref_no']);\r\n        }\r\n        var filter_delete = {\r\n            filterData: {\r\n                filter: [\r\n                    {\r\n                        fieldName: 'ext_stock_ref_no',\r\n                        value: ext_stock_ref_no,\r\n                        operator: 'in'\r\n                    }\r\n                ]\r\n            }\r\n        };\r\n        get_connect_delete(filter_delete).then(function (result1) {\r\n            save_data(selectedData).then(function (result) {\r\n                console.log('Saved data in stopping market');\r\n                res.status(200).send(selectedData);\r\n            });\r\n        });\r\n    } else {\r\n        res.status(500).send('Please fill the mandatory fields');\r\n    }\r\n} else {\r\n    if (req.body.activityDate && req.body.futurePrice && req.body.futurePrice > 0) {\r\n        res.status(200).send(req.body);\r\n    } else {\r\n        res.status(500).send('Please fill the mandatory fields');\r\n    }\r\n}\r\n",
  "sys__UUID": "ff7fe38f-2c74-4914-8a36-4f5e20bb2f66",
  "sys__createdBy": "Bravo"
}
