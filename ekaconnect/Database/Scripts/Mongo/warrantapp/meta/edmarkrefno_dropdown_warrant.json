{
  "_id": "edmarkrefno_dropdown_warrant",
  "name": "edmarkrefno_dropdown_warrant",
  "type": "processor",
  "refType": "app",
  "refTypeId": "ada131db-5171-4b9c-b6d6-caae0c6cd2f5",
  "snippet": "\r\n    req.body.mdmProcessorServiceKey = JSON.parse(req.body.mdmProcessorServiceKey);\r\n    if (req.body.mdmProcessorServiceKey[0]['dependsOn'][0] == 'Existing') {\r\n      var selectedData = req.body.selectedData.selectedData.data;\r\n      var connectUrl = req.body.propertyList.eka_connect_host + '/workflow/data';\r\n      var connectBody = {\r\n        appId: req.body.appId,\r\n        workFlowTask: 'dummystocklist'\r\n      };\r\n      var connect = {\r\n        method: 'POST',\r\n        body: connectBody,\r\n        url: connectUrl,\r\n        headers: {\r\n          Authorization: req.headers.authorization,\r\n          'X-TenantID': req.headers['x-tenantid']\r\n        },\r\n        json: true\r\n      };\r\n      function get_connect() {\r\n        return new Promise(function (resolve, reject) {\r\n          request(connect, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n              resolve(body);\r\n            }\r\n            else {\r\n              reject(body);\r\n            }\r\n          });\r\n        });\r\n      }\r\n      var contractUrl = req.body.propertyList.eka_connect_host + '/workflow/data';\r\n      var contractBody = {\r\n        appId: req.body.appId,\r\n        workFlowTask: 'dummycontractlist'\r\n      };\r\n      var contract = {\r\n        method: 'POST',\r\n        body: contractBody,\r\n        url: contractUrl,\r\n        headers: {\r\n          Authorization: req.headers.authorization,\r\n          'X-TenantID': req.headers['x-tenantid']\r\n        },\r\n        json: true\r\n      };\r\n      function get_contract() {\r\n        return new Promise(function (resolve, reject) {\r\n          request(contract, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n              resolve(body);\r\n            }\r\n            else {\r\n              reject(body);\r\n            }\r\n          });\r\n        });\r\n      }\r\n      Promise.all([get_contract(), get_connect()]).then(function (result) {\r\n        var stocks = result[1].data;\r\n        var contracts = result[0].data;\r\n        var mdmedmarkrefnodropdown = [];\r\n\r\n        for (var i = 0; i < stocks.length; i++) {\r\n          for (var j = 0; j < contracts.length; j++) {\r\n            if (\r\n              stocks[i] &&\r\n              stocks[i]['edmarkrefno'] &&\r\n              contracts[j]['edmarkrefno'] &&\r\n              stocks[i]['edmarkrefno'] == contracts[j]['edmarkrefno']\r\n            ) {\r\n              delete stocks[i];\r\n            }\r\n          }\r\n        }\r\n        for (var i = 0; i < stocks.length; i++) {\r\n          for (var j = 0; j < selectedData.length; j++) {\r\n            if (\r\n              stocks[i] &&\r\n              stocks[i]['edmarkrefno'] &&\r\n              (selectedData[j]['corporate'] &&\r\n                stocks[i]['corporate'] &&\r\n                selectedData[j]['corporate'] == stocks[i]['corporate'])\r\n            ) {\r\n              mdmedmarkrefnodropdown.push({ key: stocks[i]['edmarkrefno'], value: stocks[i]['edmarkrefno'] });\r\n            }\r\n          }\r\n        }\r\n        mdmedmarkrefnodropdown = mdmedmarkrefnodropdown.reduce((unique, o) => {\r\n          if (!unique.some(obj => obj.key === o.key)) {\r\n            unique.push(o);\r\n          }\r\n          return unique;\r\n        }, []);\r\n        res.status(200).send({\r\n          edmarkrefnodropdown: mdmedmarkrefnodropdown\r\n        });\r\n      });\r\n    }\r\n    else {\r\n      var mdmedmarkrefnodropdown = [];\r\n\r\n      res.status(200).send({\r\n        edmarkrefnodropdown: mdmedmarkrefnodropdown\r\n      });\r\n    }\r\n ",
  "sys__UUID": "38e82c93-93f8-425c-bef1-348e11f9910d",
  "sys__createdBy": "ekauser@ekaplus.com"
}
