{
  "_id": "processor_samplelist",
  "name": "samplelistprocessor",
  "type": "processor",
  "refType": "app",
  "refTypeId": "bcb79287-04fb-4af2-ae97-61af272b2c45",
  "version": "V2",
  "snippet": "\r\n    var connectHeadersUrl = req.body.propertyList.eka_connect_host + '/workflow/data';\r\n    var connectLinkUrl = req.body.propertyList.eka_connect_host + '/workflow/data';\r\n    var connectInstuctionUrl = req.body.propertyList.eka_connect_host + '/workflow/data';\r\n    var connectHeaderBody = {\r\n      appId: req.body.appId,\r\n      workFlowTask: 'linkcontractCOPY'\r\n    };\r\n    var connectLinkBody = {\r\n      appId: req.body.appId,\r\n      workFlowTask: 'linkcontractlistCOPY'\r\n    };\r\n    var connectInstructionBody = {\r\n      appId: req.body.appId,\r\n      workFlowTask: 'samplinginstructionlistCOPY'\r\n    };\r\n    var connectHeader = {\r\n      method: 'POST',\r\n      body: connectHeaderBody,\r\n      url: connectHeadersUrl,\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    var connectLink = {\r\n      method: 'POST',\r\n      body: connectLinkBody,\r\n      url: connectLinkUrl,\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    var connectInstruction = {\r\n      method: 'POST',\r\n      body: connectInstructionBody,\r\n      url: connectInstuctionUrl,\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    function get_connectHeader() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(connectHeader, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    function get_connectLink() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(connectLink, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    function get_connectInstruction() {\r\n      return new Promise(function(resolve, reject) {\r\n        request(connectInstruction, function(err, response, body) {\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    Promise.all([get_connectHeader(), get_connectLink(), get_connectInstruction()])\r\n      .then(function(result) {\r\n        var x = req.body;\r\n\r\n        var header = result[0].data;\r\n        var link = result[1].data;\r\n        var instruction = result[2].data;\r\n        var allocated_to = [];\r\n        for (var j = 0; j < header.length; j++) {\r\n          header[j]['allocated_to'] = [];\r\n          header[j]['linked_to'] = [];\r\n          for (var k = 0; k < link.length; k++) {\r\n            if (\r\n              header[j]['sample_instruction_id'] == link[k]['sample_instruction_id'] &&\r\n              header[j]['sample_no'] == link[k]['sample_no']\r\n            ) {\r\n              header[j]['allocated_to'].push(link[k]['ref_no']);\r\n              if (link[k]['link'] === true) {\r\n                header[j]['linked_to'].push(link[k]['ref_no']);\r\n              }\r\n            }\r\n          }\r\n          header[j]['allocated_to'] = header[j]['allocated_to'].toString();\r\n          header[j]['linked_to'] = header[j]['linked_to'].toString();\r\n        }\r\n\r\n        for (var j = 0; j < header.length; j++) {\r\n          header[j]['sample_approval_status'] = '';\r\n          if (header[j]['sample_status']) header[j]['sample_approval_status'] = header[j]['sample_status'];\r\n          console.log(header[j]['sample_approval_status']);\r\n          for (var i = 0; i < instruction.length; i++) {\r\n            header[j]['sample_drawn_from'] = '';\r\n            header[j]['product'] = '';\r\n            header[j]['quality'] = '';\r\n            header[j]['origin'] = '';\r\n            header[j]['sample_sent_to'] = '';\r\n\r\n            if (instruction[i]['sample_instruction_id'] == header[j]['sample_instruction_id']) {\r\n              if (instruction[i]['instruction_against_ref_no'])\r\n                header[j]['sample_drawn_from'] = instruction[i]['instruction_against_ref_no'];\r\n              if (instruction[i]['quality']) header[j]['quality'] = instruction[i]['quality'];\r\n              if (instruction[i]['origin']) header[j]['origin'] = instruction[i]['origin'];\r\n              if (instruction[i]['send_sample_to']) header[j]['sample_sent_to'] = instruction[i]['send_sample_to'];\r\n              if (instruction[i]['product']) header[j]['product'] = instruction[i]['send_sample_to'];\r\n            }\r\n          }\r\n        }\r\n\r\n     success(header,200);\r\n      })\r\n      .catch(err => {\r\n   error(err,500);\r\n      });\r\n  ",
  "sys__UUID": "fdc0d9e9-d420-42f9-9a45-dbd37b103898",
  "sys__createdOn": ISODate("2019-05-22T09:51:04.600Z"),
  "sys__createdBy": "srini@ekaplus.com"
}
