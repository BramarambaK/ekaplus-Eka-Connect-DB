{
  "_id": "processor_contractlist",
  "name": "contractlist",
  "type": "processor",
  "refType": "app",
  "refTypeId": "bcb79287-04fb-4af2-ae97-61af272b2c45",
  "snippet": " var platformUrl =\r\n    req.body.propertyList.eka_connect_host +\r\n    '/collectionmapper/' +\r\n    req.body.appId +\r\n    '/37ee3da6-dfa5-487e-920d-ed7656ee2795/fetchCollectionRecords',\r\nvar connectUrl = req.body.propertyList.eka_connect_host + '/workflow/data';\r\nvar connectBody = {\r\n    appId: req.body.appId,\r\n    workFlowTask: 'linkcontractlistCOPY'\r\n};\r\nvar connect = {\r\n    method: 'POST',\r\n    body: connectBody,\r\n    url: connectUrl,\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n    },\r\n    json: true\r\n};\r\nfunction get_connect() {\r\n    return new Promise(function (resolve, reject) {\r\n        request(connect, function (err, response, body) {\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nvar collection = {\r\n    method: 'POST',\r\n    body: { collectionName= req.body.propertyList.list_of_stocks },\r\n    url: platformUrl,\r\n    headers: {\r\n        Authorization: req.headers.authorization,\r\n        'Content-Type': 'application/json',\r\n        ttl: 300,\r\n        'X-TenantID': req.headers['x-tenantid'],\r\n        'X-Remote-User': 'ekaApp'\r\n    },\r\n    json: true\r\n};\r\nfunction get_collection() {\r\n    return new Promise(function (resolve, reject) {\r\n        console.log('Request - ' + collection.url);\r\n        request(collection, function (err, response, body) {\r\n            console.log('Response - ' + body);\r\n            if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n                resolve(body);\r\n            }\r\n            else {\r\n                reject(body);\r\n            }\r\n        });\r\n    });\r\n}\r\nPromise.all([get_collection(), get_connect()])\r\n    .then(function (result) {\r\n        var collection = result[0];\r\n        var connect = result[1].data;\r\n        for (var i = 0; i < collection.length; i++) {\r\n            collection[i]['link'] = false;\r\n        }\r\n        if (connect.length == 0) {\r\n        } else {\r\n            for (var i = 0; i < collection.length; i++) {\r\n                for (var j = 0; j < connect.length; j++) {\r\n                    if (collection[i]['ref_no'] == connect[j]['ref_no']) {\r\n                        for (var key in connect) collection[key] = { ...collection[key], ...connect[key] };\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        res.status(200).send(collection);\r\n    })\r\n    .catch(err => {\r\n        res.status(500).send(err);\r\n    });",
  "sys__UUID": "70ae7d64-48b6-4073-a627-7a0ff040d146",
  "sys__createdBy": "srini@ekaplus.com"
}
