{
  "_id" : "processor_validate_quantity_processor_SMP",
  "name" : "processor_validate_quantity_processor",
  "type" : "processor",
  "refType" : "app",
  "refTypeId" : "bcb79287-04fb-4af2-ae97-61af272b2c45",
  "snippet" : "function get_defaultData1(body) {\r\n  return new Promise(function (resolve, reject) {\r\n    request(body, function (err, response, body) {\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nasync function getunitconversion(serviceKey, f, t) {\r\n  var defaultdata = {\r\n    method: \"POST\",\r\n    body: [\r\n      {\r\n        dependsOn: [req.body.productId],\r\n        serviceKey: serviceKey,\r\n      },\r\n    ],\r\n    url:\r\n      req.body.propertyList.eka_mdm_host +\r\n      \"\/mdm\/bcb79287-04fb-4af2-ae97-61af272b2c45\/data\",\r\n    headers: {\r\n      Authorization: req.headers.authorization,\r\n      \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n    },\r\n    json: true,\r\n  };\r\n  if (f != false) {\r\n    defaultdata.body[0].dependsOn.push(f);\r\n  }\r\n  if (t != false) {\r\n    defaultdata.body[0].dependsOn.push(t);\r\n  }\r\n  return await get_defaultData1(defaultdata);\r\n}\r\nfunction getId(arr, value) {\r\n  let id = \"\";\r\n  if (arr && Array.isArray(arr)) {\r\n    let index = arr.findIndex((item) => item.value === value);\r\n    if (index != -1) {\r\n      id = arr[index].key;\r\n    }\r\n  }\r\n  return id;\r\n}\r\nasync function main() {\r\n  let allocated = 0;\r\n  if (\r\n    req.body.listsamplingparticularlist &&\r\n    Array.isArray(req.body.listsamplingparticularlist) &&\r\n    req.body.listsamplingparticularlist.length > 0\r\n  ) {\r\n    let listingData = req.body.listsamplingparticularlist;\r\n    let unitId = await getunitconversion(\r\n      \"physicalproductquantitylist\",\r\n      false,\r\n      false\r\n    );\r\n\r\n    for (let i = 0; i < listingData.length; i++) {\r\n      let conversionFactor = await getunitconversion(\r\n        \"quantityConversionFactor\",\r\n        getId(\r\n          unitId.physicalproductquantitylist,\r\n          listingData[i][\"Open Quantity Unit\"]\r\n        ),\r\n        req.body.quantity_uom\r\n      );\r\n      if (conversionFactor.hasOwnProperty(\"quantityConversionFactor\")) {\r\n        allocated =\r\n          allocated +\r\n          Number(listingData[i][\"Open Quantity\"].split(\" \")[0]) *\r\n            Number(conversionFactor.quantityConversionFactor[0].value);\r\n      } else {\r\n        allocated =\r\n          allocated + Number(listingData[i][\"Open Quantity\"].split(\" \")[0]);\r\n      }\r\n    }\r\n    req.body.allocatedqty = allocated;\r\n  }\r\n  req.body.send_sample_to =\r\n    req.body.send_sample_to == null && req.body.send_sample_to_custom_cp != \"\"\r\n      ? req.body.send_sample_to_custom_cp\r\n      : req.body.send_sample_to;\r\n  delete req.body.listsamplingparticularlist;\r\n  delete req.body.processorDetails;\r\n  delete req.body.processorId;\r\n  delete req.body.propertyList;\r\n  delete req.body.queryParams;\r\n  return { ...req.body };\r\n}\r\nif (req.body.send_sample_to) {\r\n  main()\r\n    .then((mdmdata) => {\r\n      res.status(200).send(mdmdata);\r\n    })\r\n    .catch((err) => res.status(500).send(err));\r\n} else {\r\n  if (req.body.send_sample_to_custom_cp) {\r\n    main()\r\n      .then((mdmdata) => {\r\n        res.status(200).send(mdmdata);\r\n      })\r\n      .catch(function (err) {\r\n        console.log(err);\r\n        res.status(500).send(err);\r\n      });\r\n  } else {\r\n    res.status(500).send(\"Please fill Send Sample To or Name\");\r\n    return;\r\n  }\r\n}",
  "sys__UUID" : "83e4b8c5-3a6d-47f6-9853-8b95f9b1d780",
  "sys__createdOn" : "2019-05-22T09:51:04.600Z",
  "sys__createdBy" : "avinash@ekaplus.com"
}