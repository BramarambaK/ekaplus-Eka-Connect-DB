{
    "_id" : "processor_modify_Second_Screen",
    "name" : "initial_modify_Second_Screen",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "bcb79287-04fb-4af2-ae97-61af272b2c45",
    "snippet" : "\r\n    var moment = require('moment');\r\n    let selected = req.body.hasOwnProperty('selectedData') ? req.body.selectedData : {};\r\n    var ekaEntity =\r\n      req.body.propertyList.eka_connect_host +\r\n      `/data/bcb79287-04fb-4af2-ae97-61af272b2c45/4638683b-aa06-474c-8cd6-66b8a463b769?sample_instruction_id=${\r\n        selected.samplinginstructionlist.sample_instruction_id\r\n      }`;\r\n\r\n    var FirstPageData = {\r\n      method: 'GET',\r\n      url: ekaEntity,\r\n      headers: {\r\n        Authorization: req.headers.authorization,\r\n        'Content-Type': 'application/json',\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      json: true\r\n    };\r\n    var get_platformEntityLiquidityPlanData = function get_platformEntityLiquidityPlanData(selected) {\r\n      return new Promise(function(resolve, reject) {\r\n        request(FirstPageData, function(err, response, body) {\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          } else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    };\r\n    get_platformEntityLiquidityPlanData(selected)\r\n      .then(function(data) {\r\n      var FinalDataAfterUserSelection=selected.sampleagainstedit.samplingparticularlisteditstatuspending; \r\n      var instructionAgainst=selected.sampleagainstedit.samplinginstructionagainstedit.instructionagainst;\r\n      if(data[0].Linked_Ref_No){\r\n        data = data.filter(function (ar) {\r\n          return FinalDataAfterUserSelection.find(function (rm) {\r\n              if(instructionAgainst==='Sales Contract-Unallocated'){\r\n                rm.Purchase_Ref_No=rm.Ref_No\r\n              }\r\n            return rm.Purchase_Ref_No === ar.Linked_Ref_No;\r\n          });\r\n        });\r\n      } \r\n      if (data) res.status(200).send(data);\r\n      })\r\n      .catch(err => {\r\n        res.status(500).send(err);\r\n      });\r\n  ",
    "sys__UUID" : "2a37de72-ce1b-422b-a419-c240368ef207",
    "sys__createdBy" : "Vicky@ekaplus.com"
}