{
    "_id" : "processor_sampleTRMupdate",
    "name" : "sampleTRMupdate",
    "type" : "processor",
    "refType" : "app",
    "version":"V2",
    "refTypeId" : "bcb79287-04fb-4af2-ae97-61af272b2c45",
    "snippet" : "\r\n    if (req.body.bulkPayLoadData) {\r\n      var bulkdata = req.body.bulkPayLoadData;\r\n      if (bulkdata[0].instructionagainstdrawnfrom == 'Stock-Unallocated') {\r\n        bulkdata = bulkdata.map(item => {\r\n          if (item.isDeleted) {\r\n            return {\r\n              isSampled: 'N',\r\n\r\n              goodsRecordDetailPkDO: {\r\n                internalGrdRefNo: item['INTERNAL_GRD_DGRD_REF_NO']\r\n              }\r\n            };\r\n          } else {\r\n            return {\r\n              isSampled: 'Y',\r\n\r\n              goodsRecordDetailPkDO: {\r\n                internalGrdRefNo: item['INTERNAL_GRD_DGRD_REF_NO']\r\n              }\r\n            };\r\n          }\r\n        });\r\n        var sampletotrm = {\r\n          method: 'PUT',\r\n          url: req.body.propertyList.platform_url + '\/trm\/api\/v1\/scm-stock-detail-update',\r\n          headers: {\r\n            Authorization: req.headers.authorization,\r\n\r\n            json: true\r\n          },\r\n          body: bulkdata,\r\n          json: true\r\n        };\r\n        function samplepushtotrm() {\r\n          return new Promise(function(resolve, reject) {\r\n            \/\/ console.log('Request - ' + connectData.url);\r\n            \/\/console.log('Payload -' + JSON.stringify(connectData));\r\n            request(sampletotrm, function(err, response, body) {\r\n              \/\/  console.log('Response - ' + body);\r\n              if (err || body.error) reject(body);\r\n              else {\r\n                resolve(body);\r\n              }\r\n            });\r\n          });\r\n        }\r\n        samplepushtotrm().then(data => {\r\n        success({},200);  \r\n        });\r\n      } else {\r\n       success({},200); \r\n      }\r\n    } else {\r\n      if (req.body.instructionagainst == 'Stock-Unallocated') {\r\n        var grdno = req.body.grdno.map(item => {\r\n          return {\r\n            isSampled: 'N',\r\n\r\n            goodsRecordDetailPkDO: {\r\n              internalGrdRefNo: item\r\n            }\r\n          };\r\n        });\r\n        var sampletotrm = {\r\n          method: 'PUT',\r\n          url: req.body.propertyList.platform_url + '\/trm\/api\/v1\/scm-stock-detail-update',\r\n          headers: {\r\n            Authorization: req.headers.authorization,\r\n\r\n            json: true\r\n          },\r\n          body: grdno,\r\n          json: true\r\n        };\r\n        function samplepushtotrm() {\r\n          return new Promise(function(resolve, reject) {\r\n            \/\/ console.log('Request - ' + connectData.url);\r\n            \/\/console.log('Payload -' + JSON.stringify(connectData));\r\n            request(sampletotrm, function(err, response, body) {\r\n              \/\/  console.log('Response - ' + body);\r\n              if (err || body.error) reject(body);\r\n              else {\r\n                resolve(body);\r\n              }\r\n            });\r\n          });\r\n        }\r\n        samplepushtotrm().then(data => {\r\n          success({},200); \r\n        });\r\n      } else {\r\n        success({},200);\r\n      }\r\n    }\r\n ",
    "sys__UUID" : "b2aba0b6-9b3d-4ce8-bf1b-ea4ae23c0635",
    "sys__createdOn" : ISODate("2019-05-22T09:51:04.600Z"),
    "sys__createdBy" : "srini@ekaplus.com"
}