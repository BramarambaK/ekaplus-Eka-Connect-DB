{
  "_id": "processor_editDataQuality_SMP",
  "name": "EditQualityDataCall",
  "type": "processor",
  "refType": "app",
  "refTypeId": "bcb79287-04fb-4af2-ae97-61af272b2c45",
  "snippet": "\r\n    let x = req.body;\r\n    if (\r\n      req &&\r\n      req.body &&\r\n      req.body.selectedData &&\r\n      req.body.selectedData.qualitylist &&\r\n      req.body.selectedData.qualitylist.product_specs\r\n    ) {\r\n      var productName = req.body.selectedData.qualitylist.product_specs;\r\n      var productURl = req.body.propertyList.platform_url + '/mdmapi/data';\r\n      var productAttributesURL = req.body.propertyList.platform_url + '/mdmapi/product/attributes';\r\n      var productBody = [\r\n        {\r\n          dropDownType: 'combo',\r\n          limit: '9999',\r\n          serviceKey: 'productComboDropDrown'\r\n        }\r\n      ];\r\n      var product = {\r\n        method: 'POST',\r\n        url: productURl,\r\n        body: productBody,\r\n        headers: {\r\n          Authorization: req.headers.authorization,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        json: true\r\n      };\r\n      var productAttributes = {\r\n        method: 'POST',\r\n        url: productAttributesURL,\r\n        headers: {\r\n          Authorization: req.headers.authorization,\r\n          'Content-Type': 'application/json',\r\n          'X-TenantID': req.headers['x-tenantid']\r\n        },\r\n        json: true\r\n      };\r\n      function get_productDetails() {\r\n        return new Promise(function(resolve, reject) {\r\n          request(product, function(err, response, body) {\r\n            if (err || body.error) reject(body);\r\n            else {\r\n              resolve(body);\r\n            }\r\n          });\r\n        });\r\n      }\r\n      function get_productAttributes(productid) {\r\n        productAttributes.body = {};\r\n        productAttributes.body = {\r\n          productId: productid,\r\n          isUsedForClassification1: 'Y',\r\n          isUsedForPd1: 'Y'\r\n        };\r\n        return new Promise(function(resolve, reject) {\r\n          request(productAttributes, function(err, response, body) {\r\n            if (err || body.error) reject(body);\r\n            else {\r\n              resolve(body);\r\n            }\r\n          });\r\n        });\r\n      }\r\n      var productId;\r\n      get_productDetails()\r\n        .then(function(result) {\r\n          var productData = result.productComboDropDrown;\r\n\r\n          for (var i = 0; i < productData.length; i++) {\r\n            if (productData[i]['value'] == productName) {\r\n              productId = productData[i]['key'];\r\n              break;\r\n            }\r\n          }\r\n          get_productAttributes(productId)\r\n            .then(function(result1) {\r\n              var data = [];\r\n              var obj = {};\r\n              var attributes = result1;\r\n              var x = req.body;\r\n              var customData = req.body.selectedData.qualitylist.custom;\r\n              obj = req.body.selectedData.qualitylist;\r\n              if (attributes.length == 0) {\r\n                res.status(500).send('Quality attributes mandatory, please do the required configuration to proceed');\r\n              } else {\r\n                for (var i = 0; i < attributes.length; i++) {\r\n                  if (attributes[i]['attributeValueTypeId'] == 'PREDEFINEDLIST') {\r\n                    obj[attributes[i]['attributeName'] + 'DisplayName'] = '';\r\n                  }\r\n                  obj[attributes[i]['attributeName']] = '';\r\n                }\r\n              }\r\n              for (var i = 0; i < customData.length; i++) {\r\n                var key = Object.keys(customData[i])[0];\r\n                obj[key] = customData[i][key];\r\n              }\r\n              data.push(obj);\r\n              res.status(200).send(data);\r\n            })\r\n            .catch(err => {\r\n              console.log(err);\r\n            });\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n        });\r\n    }\r\n  ",
  "sys__UUID": "f3905f4d-8157-4a1d-999d-2d871ea8801b",
  "sys__createdOn": ISODate("2019-05-22T09:51:04.600Z"),
  "sys__createdBy": "srini@ekaplus.com"
}
