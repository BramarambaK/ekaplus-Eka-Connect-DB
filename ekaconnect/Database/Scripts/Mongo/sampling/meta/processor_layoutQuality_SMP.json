{
  "_id": "processor_layoutQuality_SMP",
  "name": "QualityLayout",
  "type": "processor",
  "refType": "app",
  "refTypeId": "bcb79287-04fb-4af2-ae97-61af272b2c45",
  "snippet": "\r\n    if (\r\n      req &&\r\n      req.body &&\r\n      req.body.payLoadData &&\r\n      req.body.payLoadData.createqualitycompositeview &&\r\n      req.body.payLoadData.createqualitycompositeview[0]['product_specs']\r\n    ) {\r\n      var productName = req.body.payLoadData.createqualitycompositeview[0]['product_specs'];\r\n      var arr = [];\r\n      if (productName.indexOf(',') != -1) {\r\n        arr = productName.split(',');\r\n        productName = arr[0];\r\n      }\r\n      var productURl = req.body.propertyList.platform_url + '/mdmapi/data';\r\n      var productAttributesURL = req.body.propertyList.platform_url + '/mdmapi/product/attributes';\r\n      var productBody = [\r\n        {\r\n          dropDownType: 'combo',\r\n          limit: '9999',\r\n          serviceKey: 'productComboDropDrown'\r\n        }\r\n      ];\r\n      var product = {\r\n        method: 'POST',\r\n        url: productURl,\r\n        body: productBody,\r\n        headers: {\r\n          Authorization: req.headers.authorization,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        json: true\r\n      };\r\n      var productAttributes = {\r\n        method: 'POST',\r\n        url: productAttributesURL,\r\n        headers: {\r\n          Authorization: req.headers.authorization,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        json: true\r\n      };\r\n      function get_productDetails() {\r\n        return new Promise(function(resolve, reject) {\r\n          request(product, function(err, response, body) {\r\n            if (err || body.error) reject(body);\r\n            else {\r\n              resolve(body);\r\n            }\r\n          });\r\n        });\r\n      }\r\n      function get_productAttributes(productid) {\r\n        productAttributes.body = {};\r\n        productAttributes.body = {\r\n          productId: productid,\r\n          isUsedForClassification1: 'Y',\r\n          isUsedForPd1: 'Y'\r\n        };\r\n        return new Promise(function(resolve, reject) {\r\n          request(productAttributes, function(err, response, body) {\r\n            if (err || body.error) reject(body);\r\n            else {\r\n              resolve(body);\r\n            }\r\n          });\r\n        });\r\n      }\r\n      var productId;\r\n      get_productDetails()\r\n        .then(function(result) {\r\n          var productData = result.productComboDropDrown;\r\n\r\n          for (var i = 0; i < productData.length; i++) {\r\n            if (productData[i]['value'] == productName) {\r\n              productId = productData[i]['key'];\r\n              break;\r\n            }\r\n          }\r\n          get_productAttributes(productId)\r\n            .then(function(result1) {\r\n              var attributes = result1;\r\n              var x = req.body;\r\n              if (attributes.length == 0) {\r\n                res.status(500).send('Quality attributes mandatory, please do the required configuration to proceed');\r\n              } else {\r\n                for (var i = 0; i < attributes.length; i++) {\r\n                  var type;\r\n                  var dataType;\r\n                  var serviceKey;\r\n                  var dropdownValue;\r\n                  if (attributes[i]['attributeValueTypeId'] == 'PREDEFINEDLIST') {\r\n                    type = 'dropdown';\r\n                    dataType = 'String';\r\n                    serviceKey = attributes[i]['propertyId'];\r\n                    dropdownValue = attributes[i]['attributeName'] + 'DisplayName';\r\n                  }\r\n                  if (attributes[i]['attributeValueTypeId'] == 'TEXT') {\r\n                    type = 'textbox';\r\n                    dataType = 'String';\r\n                  }\r\n                  if (attributes[i]['attributeValueTypeId'] == 'NUMBER') {\r\n                    type = 'textbox';\r\n                    dataType = 'Number';\r\n                  }\r\n                  req.body.objectMeta.fields[attributes[i]['attributeName']] = {};\r\n                  if (type == 'dropdown') {\r\n                    req.body.objectMeta.fields[attributes[i]['attributeName']] = {\r\n                      [attributes[i]['attributeName']]: attributes[i]['attributeName'],\r\n                      labelKey: attributes[i]['attributeName'],\r\n                      type: type,\r\n                      isRequired: false,\r\n                      dataType: dataType,\r\n                      serviceKey: serviceKey,\r\n                      dropdownValue: dropdownValue\r\n                    };\r\n                    req.body.objectMeta.fields[dropdownValue] = {};\r\n                    req.body.objectMeta.fields[dropdownValue] = {\r\n                      [dropdownValue]: dropdownValue,\r\n                      labelKey: dropdownValue,\r\n                      type: 'hidden',\r\n                      dataType: 'String'\r\n                    };\r\n                    req.body.flow.createqualitydynamic.fields.push({\r\n                      filter: true,\r\n                      edit: true,\r\n                      sort: true,\r\n                      key: dropdownValue,\r\n                      hidden: true\r\n                    });\r\n                  } else {\r\n                    req.body.objectMeta.fields[attributes[i]['attributeName']] = {\r\n                      [attributes[i]['attributeName']]: attributes[i]['attributeName'],\r\n                      labelKey: attributes[i]['attributeName'],\r\n                      type: type,\r\n                      isRequired: false,\r\n                      dataType: dataType\r\n                    };\r\n                  }\r\n                  req.body.flow.createqualitydynamic.fields.push({\r\n                    filter: true,\r\n                    edit: true,\r\n                    sort: true,\r\n                    key: attributes[i]['attributeName']\r\n                  });\r\n                }\r\n              }\r\n              var output = {\r\n                appId: req.body.appId,\r\n                flow: req.body.flow,\r\n                object: req.body.object,\r\n                objectMeta: req.body.objectMeta,\r\n                properties: req.body.properties\r\n              };\r\n              res.status(200).send(output);\r\n            })\r\n            .catch(err => {\r\n              console.log(err);\r\n            });\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n        });\r\n    } else {\r\n      res.status(200).send({appId: req.body.appId,\r\n                flow: req.body.flow,\r\n                object: req.body.object,\r\n                objectMeta: req.body.objectMeta,\r\n                properties: req.body.properties});\r\n    }\r\n  ",
  "sys__UUID": "ed43f6ab-bf9f-4f50-b416-63bdca1af30f",
  "sys__createdOn": ISODate("2019-05-22T09:51:04.600Z"),
  "sys__createdBy": "srini@ekaplus.com"
}
