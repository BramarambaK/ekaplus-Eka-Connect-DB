{
  "_id": "PROCESSOR_RULELIST",
  "name": "PROCESSOR_RULELIST",
  "type": "processor",
  "refType": "app",
  "refTypeId": "d33143ac-4164-4a3f-8d30-61d845c9eeed",
  "snippet": "var connectUrl = req.body.propertyList.eka_connect_host + \"\/workflow\/data\";\r\nvar connectBody = {\r\n  appId: req.body.appId,\r\n  workFlowTask: \"ruleslistCOPY\",\r\n};\r\n\r\n\/\/Get corporateId and corporateName from mdm\r\nvar ctrm_corporate_details = {\r\n  method: \"GET\",\r\n  url:\r\n    req.body.propertyList.eka_trm_physicals_api_host +\r\n    \"\/user\/data\",\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n    \"Content-Type\":\"application\/json\",\r\n    \"Accept\":\"application\/json\",\r\n    \"Connection\": \"keep-alive\"\r\n  },\r\n  json: true,\r\n  body: {},\r\n};\r\n\r\nfunction get_ctrm_corporate_details() {\r\n  return new Promise(function (resolve, reject) {\r\n    \/\/ console.log(\"Request URL- \" + ctrm_corporate_details.url);\r\n    request(ctrm_corporate_details, function (err, response, body) {\r\n      \/\/ console.log(\"Response - \" + JSON.stringify(body));\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        console.log(\"Success\");\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nvar connect = {\r\n  method: \"POST\",\r\n  body: connectBody,\r\n  url: connectUrl,\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n  },\r\n  json: true,\r\n};\r\nfunction get_connect() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(connect, function (err, response, body) {\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\nget_connect().then(function (result) {\r\n  get_ctrm_corporate_details().then((corporateDetails)=>{\r\n    var data = result.data;\r\n    var response = [];\r\n    for (var i = 0; i < data.length; i++) {\r\n      if( !(data[i].corporateId && data[i].corporateName)\r\n        || (corporateDetails.corporateId == data[i].corporateId && corporateDetails.corporateDO.corporateName == data[i].corporateName)\r\n      )\r\n      {\r\n        data[i][\"attributeslisting\"] = [];\r\n        if (data[i][\"attributes\"]) {\r\n          var attributes = data[i][\"attributes\"];\r\n          for (var j = 0; j < attributes.length; j++) {\r\n            if (data[i][[attributes[j]]])\r\n              data[i][\"attributeslisting\"].push(\r\n                attributes[j] + \"(\" + data[i][[attributes[j]]] + \")\"\r\n              );\r\n          }\r\n        }\r\n        var attributeslisting = \"\";\r\n        var costcomponentTemplateslisting = \"\";\r\n        var costcomponentTemplates = \"\";\r\n        var ruleName = \"\";\r\n        if (data && data[i] && data[i][\"attributeslisting\"]) {\r\n          attributeslisting = data[i][\"attributeslisting\"];\r\n          attributeslisting = data[i][\"attributeslisting\"].toString();\r\n        }\r\n        if (data && data[i] && data[i][\"costcomponentTemplates\"]) {\r\n          costcomponentTemplates = data[i][\"costcomponentTemplates\"];\r\n          costcomponentTemplateslisting = costcomponentTemplates.toString();\r\n        }\r\n        if (data && data[i][\"sys__state\"]) {\r\n          data[i][\"sys__state\"][\"attributeslisting\"] = {\r\n            show: true,\r\n            disable: false,\r\n          };\r\n          data[i][\"sys__state\"][\"costcomponentTemplateslisting\"] = {\r\n            show: true,\r\n            disable: false,\r\n          };\r\n        }\r\n    \r\n        if (data && data[i] && data[i][\"rule_name\"]) {\r\n          ruleName = data[i][\"rule_name\"];\r\n        }\r\n        response.push({\r\n          ...data[i],\r\n          rule_name: ruleName,\r\n          attributeslisting: attributeslisting,\r\n          costcomponentTemplates: costcomponentTemplates,\r\n          costcomponentTemplateslisting: costcomponentTemplateslisting,\r\n        });\r\n      }\r\n    }\r\n    res.status(200).send(response);\r\n  })\r\n  .catch(err => {\r\n    console.error(err);\r\n    res.status(500).send('Error in fetching corporate details.');\r\n  });\r\n});\r\n",
  "sys__UUID": "f4c61dbc-3f4b-452f-99f7-d3eefb886519",
  "sys__createdOn": ISODate("2019-06-26T08:50:01.556Z"),
  "sys__createdBy": "Bravo"
}
