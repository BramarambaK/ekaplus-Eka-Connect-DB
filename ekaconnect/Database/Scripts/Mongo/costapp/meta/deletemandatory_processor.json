{
  "_id": "deletemandatory_processor",
  "name": "deletemandatory",
  "type": "processor",
  "refType": "app",
  "refTypeId": "d33143ac-4164-4a3f-8d30-61d845c9eeed",
  "snippet": "var selectedData = req.body;\r\nvar contractType;\r\nif (\r\n  req.body.queryParams.contractType &&\r\n  req.body.queryParams.contractType == \"P\"\r\n)\r\n  contractType = \"Purchase\";\r\nelse if (\r\n  req.body.queryParams.contractType &&\r\n  req.body.queryParams.contractType == \"S\"\r\n)\r\n  contractType = \"Sale\";\r\nvar mandatoryDataBody = {\r\n  attributes: [\r\n    {\r\n      attributeName: \"Contract Type\",\r\n      attributeValue: contractType,\r\n    },\r\n    {\r\n      attributeName: \"Contract Incoterm\",\r\n      attributeValue: req.body.queryParams.contractIncoTerm,\r\n    },\r\n    {\r\n      attributeName: \"Valuation Incoterm\",\r\n      attributeValue: req.body.queryParams.valuationIncoTerm,\r\n    },\r\n    {\r\n      attributeName: \"Payment Term\",\r\n      attributeValue: req.body.queryParams.paymentTerm,\r\n    },\r\n  ],\r\n};\r\n\r\nvar mandatoryData = {\r\n  method: \"POST\",\r\n  url: req.body.propertyList.eka_utility_host + \"\/costapp\/getCostComponents\",\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n  },\r\n  body: mandatoryDataBody,\r\n  json: true,\r\n};\r\nfunction get_mandatoryData() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(mandatoryData, function (err, response, body) {\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction confirmDelete(templateName) {\r\n  var value = true;\r\n  return new Promise((resolve, reject) => {\r\n    get_mandatoryData().then((result) => {\r\n      for (var i = 0; i < result.length; i++) {\r\n        if (result[i].templateName == templateName) {\r\n          value = false;\r\n          break;\r\n        }\r\n      }\r\n      resolve(value);\r\n    });\r\n  });\r\n}\r\n\r\nif (selectedData.costType == \"template\" && selectedData.templateName) {\r\n  confirmDelete(selectedData.templateName).then((value) => {\r\n    if (value) {\r\n      res.status(200).send(selectedData);\r\n    } else {\r\n      res\r\n        .status(500)\r\n        .send(\r\n          \"Mandatory costs estimates are defaulted from rule setup and cannot be deleted. To remove this estimate, please remove this estimate template from rule setup.\"\r\n        );\r\n    }\r\n  });\r\n} else if (selectedData.costType == \"estimate\") {\r\n  res.status(200).send(selectedData);\r\n} else {\r\n  res.status(200).send(selectedData);\r\n}\r\n",
  "sys__UUID": "df3b76c5-bf99-4691-9088-09cdc14b04a0",
  "sys__createdBy": "srini@ekaplus.com"
}
