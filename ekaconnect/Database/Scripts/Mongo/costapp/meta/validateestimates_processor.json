{
  "_id": "validateestimates_processor",
  "name": "validateestimates",
  "type": "processor",
  "refType": "app",
  "refTypeId": "d33143ac-4164-4a3f-8d30-61d845c9eeed",
  "snippet": "var selectedData;\r\nif (req.body) {\r\n    if (req.body.bulkPayLoadData) {\r\n        selectedData = req.body.bulkPayLoadData;\r\n    } else {\r\n        selectedData = req.body;\r\n    }\r\n}\r\nvar flag = 0;\r\nif (selectedData) {\r\n    if (Array.isArray(selectedData)) {\r\n        for (var i = 0; i < selectedData.length; i++) {\r\n            delete selectedData[i].object;\r\n            delete selectedData[i].sys__UUID;\r\n            delete selectedData[i].sys__createdOn;\r\n            delete selectedData[i].sys__createdBy;\r\n            delete selectedData[i].sys__state;\r\n            delete selectedData[i]._id;\r\n            delete selectedData[i].userId;\r\n            delete selectedData[i].sys__updatedBy;\r\n            delete selectedData[i].sys__updatedOn;\r\n            delete selectedData[i].refTypeId;\r\n            delete selectedData[i].refType;\r\n            delete selectedData[i].sys__version;\r\n            delete selectedData[i].sys__data__state;\r\n            selectedData[i].costType = \"estimate\";\r\n            selectedData[i] = {\r\n                ...selectedData[i],\r\n                ...req.body.queryParams,\r\n            };\r\n            if (selectedData[i].fxToBaseType) {\r\n                if (\r\n                    selectedData[i].fxToBaseType == \"Absolute\" &&\r\n                    !selectedData[i].fxToBase\r\n                ) {\r\n                    flag = 1;\r\n                    break;\r\n                } else if (\r\n                    selectedData[i].fxToBaseType == \"Curve\" &&\r\n                    !selectedData[i].fxRate &&\r\n                    !selectedData[i].fxValueDate\r\n                ) {\r\n                    flag = 1;\r\n                    break;\r\n                }\r\n            }\r\n            if (\r\n                selectedData[i].rateTypePrice == \"rate\" ||\r\n                selectedData[i].rateTypePrice == \"absolute\"\r\n            ) {\r\n                if (selectedData[i].fxToAccuralType !== '') {\r\n                    if (selectedData[i].fxToAccuralType != \"Floating\") {\r\n                        if (!selectedData[i].costValue || !selectedData[i].costAmountInBaseCurrency) {\r\n                            flag = 1;\r\n                            break;\r\n                        }\r\n                    }\r\n                } else if (\r\n                    !selectedData[i].costValue ||\r\n                    !selectedData[i].costPriceUnitIdDisplayName ||\r\n                    !selectedData[i].costAmountInBaseCurrency ||\r\n                    !selectedData[i].costAmountInBaseCurrencyUnitId\r\n                ) {\r\n                    flag = 1;\r\n                    break;\r\n                }\r\n            } else if (selectedData[i].rateTypePrice == \"% of Price\") {\r\n                if (\r\n                    !selectedData[i].costValue ||\r\n                    !selectedData[i].costAmountInBaseCurrency ||\r\n                    !selectedData[i].costAmountInBaseCurrencyUnitId\r\n                ) {\r\n                    flag = 1;\r\n                    break;\r\n                }\r\n            } else if (selectedData[i].rateTypePrice == \"curve\") {\r\n                if (\r\n                    !selectedData[i].costCurve ||\r\n                    !selectedData[i].costMonth ||\r\n                    !selectedData[i].curveCurrency\r\n                ) {\r\n                    flag = 1;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nif (flag == 0) {\r\n    res.status(200).send(selectedData);\r\n} else {\r\n    res.status(500).send(\"Cost Estimates not configured correctly\");\r\n}",
  "sys__UUID": "9c40a5e9-4478-4aef-82ad-692614ec6915",
  "sys__createdBy": "srini@ekaplus.com"
}
