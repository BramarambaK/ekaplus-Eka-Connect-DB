{
    "_id" : "saveestimatestotrm_processor",
    "name" : "saveestimatestotrm",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "d33143ac-4164-4a3f-8d30-61d845c9eeed",
    "snippet" : "var saveEstimates = {\r\n  method: \"POST\",\r\n  url: req.body.propertyList.platform_url + \"\/api\/costEstimates\/saveEstimates\",\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n  },\r\n  json: true,\r\n  body: {},\r\n};\r\n\r\nfunction save_estimates() {\r\n  return new Promise(function (resolve, reject) {\r\n    console.log(\"Request - \" + saveEstimates.url);\r\n    console.log(\"Payload -\" + JSON.stringify(saveEstimates));\r\n    request(saveEstimates, function (err, response, body) {\r\n      console.log(\"Request Body - \" + JSON.stringify(body));\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nvar currentUser = {\r\n  method: \"GET\",\r\n  url: req.body.propertyList.platform_url + \"\/spring\/smartapp\/currentUser\",\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n  },\r\n  json: true,\r\n};\r\n\r\nfunction get_currentUser() {\r\n  return new Promise(function (resolve, reject) {\r\n    console.log(\"Request - \" + currentUser.url);\r\n    console.log(\"Payload -\" + JSON.stringify(currentUser));\r\n    request(currentUser, function (err, response, body) {\r\n      console.log(\"Request Body - \" + JSON.stringify(body));\r\n      if (err || body.error) reject(body);\r\n      else {\r\n        resolve(body);\r\n      }\r\n    });\r\n  });\r\n}\r\nget_currentUser().then(async (user) => {\r\n  if (user.success) saveEstimates.headers.userName = user.data.userId;\r\n  var data = req.body;\r\n  delete data.appId;\r\n  delete data.processorDetails;\r\n  delete data.processorId;\r\n  delete data.propertyList;\r\n  delete data.queryParams;\r\n  delete data.sD;\r\n  saveEstimates.body = [];\r\n  if (data.bulkPayLoadData) saveEstimates.body = data.bulkPayLoadData;\r\n  else saveEstimates.body.push(data);\r\n  await save_estimates().then((result) => {\r\n    console.log(result);\r\n    res.status(200).send(result);\r\n  });\r\n});\r\n",
    "sys__UUID" : "631667c5-df90-4c9e-a3e4-1ab0b21b712e"
}