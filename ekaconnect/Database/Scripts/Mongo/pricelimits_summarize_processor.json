{
  "_id": "pricelimits_summarize_processor",
  "name": "pricelimits_summarize_processor",
  "type": "processor",
  "refType": "app",
  "refTypeId": "12325a98-a959-4939-9005-4158d136afcd",
  "snippet": "const sendError = (message, context) =>\r\nres.status(400).send({\r\n  errorCode: '004',\r\n  errorMessage: message,\r\n  errorContext: null,\r\n  errorLocalizedMessage: message,\r\n  errors: [\r\n    {\r\n      errorCode: '004',\r\n      errorMessage: message,\r\n      errorContext: context,\r\n      errorLocalizedMessage: message,\r\n      errors: null,\r\n    },\r\n  ],\r\n});\r\n\r\nif (!req.body.bpRefNo) {\r\nreturn sendError('Please choose an account', '{enterlimits:bpRefNo}');\r\n}\r\n\r\nif (!req.body.season) {\r\nreturn sendError('Please choose a harvest season', '{enterlimits:season}');\r\n}\r\n\r\nconst bpDetails = req.body.bpRefNo.split(' @#@ ');\r\nconst data = (req.body.pricelimits || []).map((i, indx) => ({\r\n...i,\r\nbpRefNo: bpDetails[0],\r\nbpName: bpDetails[1],\r\nbpExternalName: bpDetails[2],\r\nbpExternalCode: bpDetails[3],\r\nseason: req.body.season,\r\nsustainable:\r\n  req.body.pricelimits[indx].sustainable == '' ||\r\n  req.body.pricelimits[indx].sustainable == null\r\n    ? false\r\n    : req.body.pricelimits[indx].sustainable,\r\nquality: req.body.pricelimits[indx].quality.split('_')[0],\r\nproduct: req.body.pricelimits[indx].quality.split('_')[1],\r\nsite: req.body.pricelimits[indx].site.split('_')[0],\r\nregion: req.body.pricelimits[indx].site.split('_')[1],\r\npricingOption: req.body.pricelimits[indx].pricingOption.split('_')[0],\r\nmarketType: req.body.pricelimits[indx].pricingOption.split('_')[1],\r\npaymentTerm:\r\n  req.body.pricelimits[indx].pricingOption.split('_')[2] &&\r\n  req.body.pricelimits[indx].pricingOption.split('_')[2] != 'undefined'\r\n    ? req.body.pricelimits[indx].pricingOption.split('_')[2]\r\n    : null,\r\n_groupNo: indx,\r\nlength: req.body.pricelimits.length,\r\nclientTimezoneOffset: req.body.clientTimezoneOffset,\r\npublishImmediately:\r\n  i.publishImmediately == null || i.publishImmediately == undefined\r\n    ? req.body.publishI == 'Publish immediately'\r\n      ? true\r\n      : false\r\n    : i.publishImmediately,\r\nstartDate:\r\n  i.startDate && (i.startDate != null || i.startDate != '')\r\n    ? i.startDate\r\n    : moment().format('YYYY-MM-DD'),\r\nstartTime:\r\n  i.startTime && (i.startTime != null || i.startTime != '')\r\n    ? Number(i.startTime.split(':')[0]) < 10\r\n      ? `0${Number(i.startTime.split(':')[0])}:${i.startTime.split(':')[1]}`\r\n      : i.startTime\r\n    : moment().format('HH:00'),\r\nendTime:\r\n  i.endTime && Number(i.endTime.split(':')[0]) < 10\r\n    ? `0${Number(i.endTime.split(':')[0])}:${i.endTime.split(':')[1]}`\r\n    : i.endTime,\r\n}));\r\nres.status(200).send(data);",
  "sys__UUID": "f63f4a31-69a9-4088-9124-1c969a518444"
}
