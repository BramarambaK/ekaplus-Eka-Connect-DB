{
  "_id": "MDM_collateralinstrumentaldetails",
  "name": "MDM_collateralinstrumentaldetails",
  "type": "processor",
  "refType": "app",
  "refTypeId": "00ca04e8-5ca5-4c2f-8636-23b1d79fab5b",
  "snippet": "var moment = require(\"moment\");\r\n\r\nreq.body.mdmProcessorServiceKey = JSON.parse(req.body.mdmProcessorServiceKey);\r\n\r\nfunction findindex(serviceKey) {\r\n  return req.body.mdmProcessorServiceKey.findIndex(\r\n    (x) => x.serviceKey == serviceKey\r\n  );\r\n}\r\n\r\nvar counterpartyRequest = {\r\n  method: \"POST\",\r\n  url: req.body.propertyList.platform_url + \"\/mdmapi\/masterdatas\/cpDetails\",\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    ttl: 300,\r\n  },\r\n  json: true,\r\n};\r\nvar get_counterparty = function get_counterparty() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(counterpartyRequest, function (err, response, body) {\r\n      if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n        resolve(body);\r\n      } else {\r\n        reject(body);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nvar entityReq = {\r\n  method: \"POST\",\r\n  url: req.body.propertyList.platform_url + \"\/mdmapi\/data\",\r\n  body: [{ serviceKey: \"corporateBasedOnUserContext\" }],\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n  },\r\n  json: true,\r\n};\r\nvar get_entity = function get_entity() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(entityReq, function (err, response, body) {\r\n      if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n        resolve(body);\r\n      } else {\r\n        reject(body);\r\n      }\r\n    });\r\n  });\r\n};\r\nasync function main() {\r\n  let mdmdata = {};\r\n  if (findindex(\"entityKey\") != -1) {\r\n    const entity = await get_entity()\r\n    mdmdata[\"entityKey\"] = entity['corporateBasedOnUserContext']\r\n  }\r\n  if (findindex(\"counterparty\") != -1) {\r\n    let counterPartyData = await get_counterparty();\r\n    mdmdata[\"counterparty\"] = counterPartyData.map((item) => {\r\n      return { key: item.profileId, value: item.companyname };\r\n    });\r\n  }\r\n  if (findindex(\"amountCurrencyKey\") != -1) {\r\n    mdmdata[\"amountCurrencyKey\"] = [\r\n      { key: \"INR\", value: \"INR\" },\r\n      { key: \"USD\", value: \"USD\" },\r\n      { key: \"EUR\", value: \"EUR\" },\r\n      { key: \"JPY\", value: \"JPY\" },\r\n    ];\r\n  }\r\n  return mdmdata;\r\n}\r\nmain().then((mdmdata) => {\r\n  res.status(200).send(mdmdata);\r\n});",
  "sys__UUID": "58349419-6ae4-4cfb-8259-4bcd552fe3ed",
  "sys__createdBy": "avinash_chitte"
}