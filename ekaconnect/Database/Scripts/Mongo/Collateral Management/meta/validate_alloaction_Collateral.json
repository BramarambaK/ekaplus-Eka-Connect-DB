{
  "_id": "validate_alloaction_Collateral",
  "name": "validate_alloaction_Collateral",
  "type": "processor",
  "refType": "app",
  "refTypeId": "00ca04e8-5ca5-4c2f-8636-23b1d79fab5b",
  "snippet": "var getData = function getData(requestBody) {\r\n  return new Promise(function (resolve, reject) {\r\n    request(requestBody, function (err, response, body) {\r\n      if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n        resolve(body);\r\n      } else {\r\n        reject(body);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n\r\nvar user = {\r\n  method: 'GET',\r\n  url: req.body.propertyList.eka_connect_host + '\/api\/userinfo',\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    'X-TenantID': req.headers['x-tenantid']\r\n  },\r\n  json: true\r\n};\r\nvar Payload = {\r\n  method: 'POST',\r\n  url: req.body.propertyList.eka_connect_host + '\/workflow',\r\n  headers: {\r\n    'Content-Type': 'application\/json',\r\n    Authorization: req.headers.authorization,\r\n    'X-TenantID': req.headers['x-tenantid']\r\n  },\r\n  json: true,\r\n  body: {\r\n    workflowTaskName: 'savealloctaionrealobj',\r\n    task: 'savealloctaionrealobj',\r\n    appName: 'collateral',\r\n    appId: '00ca04e8-5ca5-4c2f-8636-23b1d79fab5b',\r\n    output: {\r\n      savealloctaionrealobj: {}\r\n    },\r\n    id: '',\r\n    params: {},\r\n    sD: []\r\n  }\r\n};\r\nconst data = {\r\n  refNo: req.body.refNo,\r\n  typeofallocation: req.body.typeofallocation\r\n};\r\nif (data.typeofallocation == 'Physicals') {\r\n  let d = getId(\r\n    req.body.physicals.map(item => {\r\n      return { ...item, ...{ refNo: req.body.refNo } };\r\n    })\r\n  )\r\n    .then(physicals => {\r\n      data['physicals'] = physicals;\r\n      res.status(200).send(data);\r\n    })\r\n    .catch(err => {\r\n      res.status(500).send(err);\r\n    });\r\n} else {\r\n  let p = getId(\r\n    req.body.deivatives.map(item => {\r\n      return { ...item, ...{ refNo: req.body.refNo } };\r\n    })\r\n  )\r\n    .then(deivatives => {\r\n      data['derivatives'] = deivatives;\r\n      res.status(200).send(data);\r\n    })\r\n    .catch(err => {\r\n      res.status(500).send('Failed to Save');\r\n    });\r\n}\r\n\r\nfunction saveIdData(data) {\r\n  return new Promise(async function (resolve, reject) {\r\n    data.userName = await getData(user).then(function (userinfo) {\r\n      return userinfo.firstName + ' ' + userinfo.lastName;\r\n    })\r\n    Payload.body.output.savealloctaionrealobj = data;\r\n    request(Payload, function (err, response, body) {\r\n      if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n        resolve(body.data);\r\n      } else {\r\n        reject(body);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nasync function getId(arr) {\r\n  const id = [];\r\n  for (var i = 0; i < arr.length; i++) {\r\n    await saveIdData(arr[i]).then(function (data) {\r\n      id.push(data);\r\n    });\r\n  }\r\n  return id;\r\n}",
  "sys__UUID": "50a33134-1427-4d41-b904-605aaa502bf4"
}
