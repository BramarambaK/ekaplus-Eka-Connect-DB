{
    "_id" : "alloaction_utilization_info_Collateral",
    "name" : "alloaction_utilization_info_Collateral",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "00ca04e8-5ca5-4c2f-8636-23b1d79fab5b",
    "snippet" : "var colateralListData = function colateralListData(data, data1) {\r\n  var res = {};\r\n  var allocateAmount = data.length > 0 ? getSumOfAllocationAmount(data) : 0;\r\n  var utilizationAmount = data1.length > 0 ? getSumOfUtilizaedAmount(data1) : 0;\r\n  res.unallocatedAmount = (Number(removeCommaSaperator(req.body.selectedData.amount)) - Number(allocateAmount)).toString();\r\n  res.unutilizedAmount = (Number(removeCommaSaperator(req.body.selectedData.amount)) - Number(utilizationAmount)).toString();\r\n  res.counterparty = req.body.selectedData.counterpartyDisplay;\r\n  res.collateralType = req.body.selectedData.collateralType;\r\n  res.entity = req.body.selectedData.entityKeyDisplay;\r\n  res.effectiveDate = req.body.selectedData.effectiveDate;\r\n  res.expiryDate = req.body.selectedData.hasOwnProperty('expiryDate') ? req.body.selectedData.expiryDate : '';\r\n  res.amountCurrency = req.body.selectedData.amountCurrency;\r\n  res.amount = req.body.selectedData.amount;\r\n  return [res];\r\n};\r\n\r\nfunction getSumOfAllocationAmount(array) {\r\n  let amount = 0;\r\n  array[0].physicals.map((item) => {\r\n    amount += Number(item.allocatedAmount);\r\n  })\r\n  return Number(amount);\r\n}\r\n\r\nfunction getSumOfUtilizaedAmount(array) {\r\n  let amount = 0;\r\n  array.map((item) => {\r\n    amount += Number(item.utilizedAmount);\r\n  })\r\n  return Number(amount);\r\n}\r\n\r\nfunction removeCommaSaperator(number) {\r\n  while (number.indexOf(',') > 0) {\r\n    number = number.replace(',', '');\r\n  }\r\n  return Number(number);\r\n}\r\n\r\nvar moment = require('moment');\r\n\r\nvar collateraldata = {\r\n  method: 'GET',\r\n\r\n  url: `${req.body.propertyList.eka_connect_host}\/data\/${req.body.appId}\/5e6a81d6-1a86-4cc9-bdf7-a59190278be3?refNo=${req.body.selectedData.refNo}`,\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n    'X-TenantID': req.headers['x-tenantid']\r\n  }\r\n};\r\n\r\nvar utilizationCollateraldata = {\r\n  method: 'GET',\r\n  url: `${req.body.propertyList.eka_connect_host}\/data\/${req.body.appId}\/495caae7-caad-46b4-930a-c0abf635e8b6?refNo=${req.body.selectedData.refNo}`,\r\n  headers: {\r\n    Authorization: req.headers.authorization,\r\n\r\n    'X-TenantID': req.headers['x-tenantid']\r\n  }\r\n};\r\n\r\nvar get_collateralDetails = function get_collateralDetails() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(collateraldata, function (err, response, body) {\r\n      if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n        resolve(body);\r\n      } else {\r\n        reject(body);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nvar get_utilization_collateralDetails = function get_utilization_collateralDetails() {\r\n  return new Promise(function (resolve, reject) {\r\n    request(utilizationCollateraldata, function (err, response, body) {\r\n      if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n        resolve(body);\r\n      } else {\r\n        reject(body);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nPromise.all([get_collateralDetails(), get_utilization_collateralDetails()]).then(values => {\r\n  var finalData = [\r\n    {\r\n      collateralType: '',\r\n      counterparty: '',\r\n      entity: '',\r\n      effectiveDate: '',\r\n      expiryDate: '',\r\n      amountCurrency: '',\r\n      amount: '',\r\n      unallocatedAmount: '',\r\n      unutilizedAmount: ''\r\n    }\r\n  ];\r\n  if (values.length > 0) {\r\n    let data = JSON.parse(values[0]);\r\n    let data1 = JSON.parse(values[1]);\r\n    finalData = colateralListData(data, data1);\r\n  }\r\n  res.status(200).send(finalData);\r\n});",
    "sys__UUID" : "28ba5cd4-a5de-47f3-aae2-57abc242887b"
}