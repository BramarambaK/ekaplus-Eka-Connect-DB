{
    "_id" : "MDM_initial_form_utilization_Collateral",
    "name" : "MDM_initial_form_utilization_Collateral",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "00ca04e8-5ca5-4c2f-8636-23b1d79fab5b",
    "snippet" : "req.body.mdmProcessorServiceKey = JSON.parse(req.body.mdmProcessorServiceKey);\r\nfunction findindex(serviceKey) {\r\n\treturn req.body.mdmProcessorServiceKey.findIndex(\r\n\t\t(x) => x.serviceKey == serviceKey\r\n\t);\r\n}\r\nlet refNo = req.body.selectedData.collateralutilization && req.body.selectedData.collateralutilization.collateralutilizationform\r\n\t? req.body.selectedData.collateralutilization.collateralutilizationform.refNo || req.body.selectedData.refNo\r\n\t: req.body.selectedData.refNo;\r\n\r\n\r\nvar collateraldata = {\r\n\tmethod: \"GET\",\r\n\turl: req.body.propertyList.eka_connect_host + \"\/data\/\" + req.body.appId + \"\/5e6a81d6-1a86-4cc9-bdf7-a59190278be3?refNo=\" + refNo,\r\n\theaders: {\r\n\t\tAuthorization: req.headers.authorization,\r\n\t\t\"X-TenantID\": req.headers[\"x-tenantid\"],\r\n\t},\r\n\tjson: true,\r\n};\r\nvar get_collateralDetails = function get_collateralDetails() {\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\trequest(collateraldata, function (err, response, body) {\r\n\t\t\tif (response.statusCode >= 200 && response.statusCode <= 299) {\r\n\t\t\t\tresolve(body);\r\n\t\t\t} else {\r\n\t\t\t\treject(body);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n};\r\nasync function main() {\r\n\tlet mdmdata = {};\r\n\tif (findindex(\"allocatedToService\") != -1) {\r\n\t\ttry {\r\n\t\t\tlet allocatedToService = await get_collateralDetails();\r\n\t\t\tmdmdata[\"allocatedToService\"] = allocatedToService[0].physicals.map(\r\n\t\t\t\t(item) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tkey: item.allocationId,\r\n\t\t\t\t\t\tvalue: item.allocationId,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t}\r\n\r\n\tif (findindex(\"allocatedAmount\") != -1) {\r\n\t\ttry {\r\n\t\t\tlet allocatedToService = await get_collateralDetails();\r\n\t\t\tlet allocatedToServiceData = allocatedToService[0].physicals.find(\r\n\t\t\t\t(item) =>\r\n\t\t\t\t\treq.body.mdmProcessorServiceKey[0].dependsOn[0] == item.allocationId\r\n\t\t\t);\r\n\t\t\tmdmdata[\"allocatedAmount\"] = allocatedToServiceData.allocatedAmount + \"\";\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t}\r\n\treturn mdmdata;\r\n}\r\nmain().then((mdmdata) => {\r\n\tres.status(200).send(mdmdata);\r\n});",
    "sys__UUID" : "e8d49eff-b93a-48fe-b152-7bf8c8ab5378"
}
