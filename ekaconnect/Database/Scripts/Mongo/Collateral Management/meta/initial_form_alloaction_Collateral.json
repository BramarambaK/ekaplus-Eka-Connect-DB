{
  "_id": "initial_form_alloaction_Collateral",
  "name": "initial_form_alloaction_Collateral",
  "type": "processor",
  "refType": "app",
  "refTypeId": "00ca04e8-5ca5-4c2f-8636-23b1d79fab5b",
  "snippet": "var filterData = function filterData(data) {\r\n  var res = {};\r\n  res = { ...res, ...data };\r\n  if (res.typeofallocation == \"Physicals\") {\r\n    res[\"physicals\"] = res.physicals.map(function (item) {\r\n      item[\"updatedDate\"] = item.hasOwnProperty(\"sys__updatedOn\") ? item.sys__updatedOn : item.sys__createdOn;\r\n      item[\"updatedBy\"] = item.hasOwnProperty(\"sys__updatedBy\") ? item.sys__updatedBy : item.sys__createdBy;\r\n      item[\"updatedDate\"] = moment(item[\"updatedDate\"]).format(\"DD-MMM-YYYY\");\r\n      return item;\r\n    });\r\n  } else {\r\n    res[\"derivatives\"] = res.derivatives.map(function (item) {\r\n      item[\"updatedDate\"] = item.hasOwnProperty(\"sys__updatedOn\") ? item.sys__updatedOn : item.sys__createdOn;\r\n      item[\"updatedBy\"] = item.hasOwnProperty(\"sys__updatedBy\") ? item.sys__updatedBy : item.sys__createdBy;\r\n      item[\"updatedDate\"] = moment(item[\"updatedDate\"]).format(\"DD-MMM-YYYY\");\r\n      return item;\r\n    });\r\n  }\r\n  return res;\r\n};\r\n\r\nif (req.body.selectedData.refNo !== undefined) {\r\n  var moment = require(\"moment\");\r\n\r\n  var collateraldata = {\r\n    method: \"GET\",\r\n    url: `${req.body.propertyList.eka_connect_host}\/data\/${req.body.appId}\/5e6a81d6-1a86-4cc9-bdf7-a59190278be3?refNo=${req.body.selectedData.refNo}`,\r\n    headers: {\r\n      Authorization: req.headers.authorization,\r\n      \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n    },\r\n    json: true,\r\n  };\r\n\r\n  var get_collateralDetails = function get_collateralDetails() {\r\n    return new Promise(function (resolve, reject) {\r\n      request(collateraldata, function (err, response, body) {\r\n        if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n          resolve(body);\r\n        } else {\r\n          reject(body);\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  get_collateralDetails().then(function (data) {\r\n    var finalData = {\r\n      typeofallocation: \"Physicals\",\r\n      physicals: [\r\n        {\r\n          allocationId: \"\",\r\n          counterparty: \"\",\r\n          assetClass: \"\",\r\n          derivativeType: \"\",\r\n          derivativeId: \"\",\r\n          contractRefNo: \"\",\r\n          gmrId: \"\",\r\n          invoiceId: \"\",\r\n          allocatedAmount: \"\",\r\n          utilizedAmount: \"0\",\r\n          updatedBy: \"-\",\r\n          remarks: \"\",\r\n        },\r\n      ],\r\n    };\r\n    if (data.length > 0) {\r\n      finalData = filterData(data[0]);\r\n    }\r\n    res.status(200).send(finalData);\r\n  });\r\n} else {\r\n  res.status(200).send({\r\n    typeofallocation: \"Physicals\",\r\n    physicals: [\r\n      {\r\n        allocationId: \"\",\r\n        counterparty: \"\",\r\n        assetClass: \"\",\r\n        derivativeType: \"\",\r\n        derivativeId: \"\",\r\n        contractRefNo: \"\",\r\n        gmrId: \"\",\r\n        invoiceId: \"\",\r\n        allocatedAmount: \"\",\r\n        utilizedAmount: \"0\",\r\n        updatedBy: \"-\",\r\n        remarks: \"\",\r\n      },\r\n    ],\r\n  });\r\n}\r\n",
  "sys__UUID": "22d70c24-625b-4ff5-9946-43bbb0501824"
}
