{
    "_id" : "mdmProcessorforEditGMR_esourcing",
    "name" : "mdmProcessorforEditGMR_esourcing",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "7e484cae-36aa-46dc-b9ae-33c8d246f056",
    "snippet" : "req.body.mdmProcessorServiceKey = JSON.parse(req.body.mdmProcessorServiceKey);\r\n    function getDropdown(data) {\r\n      let deleveryItem = data.find(item => item.serviceKey === 'contractQuality')\r\n      deleveryItem = deleveryItem ? deleveryItem.dependsOn[1] :''\r\n      let dependsOnForBusin = data.find(item => item.serviceKey === 'businesspartnercontactpersoncustom')\r\n      dependsOnForBusin = dependsOnForBusin.dependsOn\r\n\r\n      var businesspartnercontactperson = [\r\n        {\r\n          serviceKey: 'businesspartnercontactperson',\r\n          dependsOn: dependsOnForBusin\r\n        },  {\r\n          serviceKey: 'contractQuality',\r\n          dependsOn:[pcdiId,deleveryItem]\r\n        },\r\n        {\r\n          serviceKey: 'incoTermDestination',\r\n          dependsOn: [pcdiId,deleveryItem]\r\n        }\r\n      ];\r\n      var obj = {\r\n        method: 'POST',\r\n        body: businesspartnercontactperson,\r\n        \/\/ url: req.body.propertyList.eka_ctrm_host + '\/mdmapi\/data',\r\n        url: `${req.body.propertyList.eka_mdm_host}\/mdm\/${req.body.appId}\/data`,\r\n        headers: {\r\n          Authorization: req.headers.authorization,\r\n          'Content-Type': 'application\/json',\r\n          'X-TenantID': req.headers['X-TenantID']\r\n        },\r\n        json: true\r\n      };\r\n      console.log('mdm url', obj.url);\r\n      return new Promise(function (resolve, reject) {\r\n        request(obj, function (err, response, body) {\r\n            if(response.statusCode >= 200 && response.statusCode <=299) {\r\n                resolve(body);\r\n            } else {\r\n                reject(body);\r\n            }\r\n        });\r\n      });\r\n    }\r\n    let pcdiId = req.body.selectedData.viewgmrbasic ? req.body.selectedData.viewgmrbasic.pcdiId : \"\"\r\n\r\n    let businesspartnercontactperson =\r\n      req &&\r\n      req.body &&\r\n      req.body.mdmProcessorServiceKey &&\r\n      req.body.mdmProcessorServiceKey.find(item => item.serviceKey === 'businesspartnercontactpersoncustom');\r\n\r\n    let contractQuality =  req &&\r\n    req.body &&\r\n    req.body.mdmProcessorServiceKey &&\r\n    req.body.mdmProcessorServiceKey.find(item => item.serviceKey === 'contractQuality');\r\n\r\n    let incoTermDestination =  req &&\r\n    req.body &&\r\n    req.body.mdmProcessorServiceKey &&\r\n    req.body.mdmProcessorServiceKey.find(item => item.serviceKey === 'incoTermDestination');\r\n\r\n    if (businesspartnercontactperson &&contractQuality &&  incoTermDestination) {\r\n      getDropdown([businesspartnercontactperson,contractQuality,incoTermDestination])\r\n        .then(output => {\r\n          if (output && output.businesspartnercontactperson && output.contractQuality && output.incoTermDestination) {\r\n            return res.status(200).send({\r\n              businesspartnercontactpersoncustom: [\r\n                { key: 'none', value: 'None' },\r\n                ...output.businesspartnercontactperson\r\n              ],\r\n              contractQuality: [\r\n                ...output.contractQuality\r\n              ],\r\n              incoTermDestination: [\r\n                ...output.incoTermDestination\r\n              ]\r\n            });\r\n          }\r\n        })\r\n        .catch(err => res.status(200).send(err));\r\n    } \r\n    else{\r\n      return res.status(200).send({})\r\n    }",
    "sys__UUID" : "b1648bf5-83a3-44f7-84bb-10e830ec5b79"
}
