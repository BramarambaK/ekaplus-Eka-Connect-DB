{
  "_id": "getngrs-cst",
  "name": "getngrs-cst",
  "type": "processor",
  "refType": "app",
  "refTypeId": "12325a98-a959-4939-9005-4158d136afcd",
  "snippet": "const send = (status, message) => res.status(status).send(message);\r\n    let formIndex = req.body.formArrayIndex;\r\n    let ngrdetailsobj = { ...req.body.ngrdetails[formIndex], ...req.body.enterngrcomposite.ngrdetails[formIndex] };\r\n    let ngrdetails = [];\r\n    ngrdetails = req.body.enterngrcomposite.ngrdetails;\r\n    // ngrdetails[formIndex] = ngrdetailsobj;\r\n    ngrdetails.splice(formIndex, 1, ngrdetailsobj);\r\n    // let parentcompositedata = req.body.tickettransfercomposite;\r\n\r\n    function getNgrNumber() {\r\n      const dataToSend = {\r\n        workflowTaskName: 'EXTERNAL_CACP_GET_NGR_DETAILS_API',\r\n\r\n        task: 'EXTERNAL_CACP_GET_NGR_DETAILS_API',\r\n\r\n        appId: '12325a98-a959-4939-9005-4158d136afcd',\r\n\r\n        output: {\r\n          EXTERNAL_CACP_GET_NGR_DETAILS_API: {\r\n            ngrnumber: ''\r\n          }\r\n        }\r\n      };\r\n      dataToSend.output.EXTERNAL_CACP_GET_NGR_DETAILS_API.ngrnumber = ngrdetails[formIndex].ngr;\r\n      getNgrTradingName(dataToSend);\r\n    }\r\n    getNgrNumber();\r\n    function getNgrTradingName(dataToSend) {\r\n      console.log(dataToSend);\r\n      let apiBody = {\r\n        method: 'POST',\r\n        url: '',\r\n        headers: {\r\n          Authorization: req.headers.authorization,\r\n          'X-TenantID': req.headers['x-tenantid']\r\n        },\r\n        json: true,\r\n        body: {}\r\n      };\r\n      apiBody.url = req.body.propertyList.eka_connect_host + '/workflow';\r\n      apiBody.body = dataToSend;\r\n      getData(apiBody)\r\n        .then(data => {\r\n          console.log('Request Successflly Sent', data);\r\n          if (data.data.message.error) {\r\n            send(400, {\r\n              errorCode: 400,\r\n              errorMessage: data.data.message.error,\r\n              errorContext: 'This is null',\r\n              errorLocalizedMessage: data.data.message.error\r\n            });\r\n          } else {\r\n            ngrdetails[formIndex].ngrtradingname = data.data.message.result.card_line_1;\r\n            send(200, {\r\n              enterngrs: {\r\n                formArrayIndex: formIndex,\r\n                ngrdetails: ngrdetails\r\n              }\r\n            });\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n          send(400, {\r\n            errorCode: err.Status,\r\n            errorMessage: 'The request cannot be created at this moment.',\r\n            errorContext: 'This is null',\r\n            errorLocalizedMessage: 'The request cannot be created at this moment.'\r\n          });\r\n        });\r\n    }\r\n\r\n    function getData(requestBody) {\r\n      return new Promise(function(resolve, reject) {\r\n        request(requestBody, function(err, response, body) {\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            resolve(body);\r\n          } else {\r\n            reject(body);\r\n          }\r\n        });\r\n      });\r\n    }",
  "sys__UUID": "b2304c8d-ed2a-4ff0-b695-56f78c6b8a2b",
  "sys__createdBy": "ekauser@ekaplus.com"
}
