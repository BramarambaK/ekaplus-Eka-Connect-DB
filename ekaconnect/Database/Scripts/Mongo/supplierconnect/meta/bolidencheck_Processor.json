{
    "_id" : "bolidencheck_Processor",
    "name" : "bolidencheck_Processor",
    "type" : "processor",
    "refType" : "app",
    "refTypeId" : "467a28cc-bc93-4e38-8ff5-0a56ae128f3b",
    "snippet" : "\/\/  Boliden Checkbox API\r\n    var moment = require('moment');\r\n    let selectedData = req.body.selected;\r\n    let viewData = req.body.allViewData;\r\n    let checkBoxPayload = {};\r\n    let supplierElementList_cb = viewData.assayStockList['Provisional Assay'][0].elementList.reduce((a, i) => {\r\n      let item = {\r\n        elementId: i.elementId,\r\n        typical: i.typical\r\n      };\r\n      if (i.assayRule == 'Assay Exchange' || i.assayRule == 'Payables') {\r\n        item['useBolidenAssay'] = 'Y';\r\n      }\r\n      a.push(item);\r\n      return a;\r\n    }, []);\r\n\r\n    checkBoxPayload['internalGMRRefNo'] = selectedData.supplierlisting.internalGmrRefNo;\r\n    checkBoxPayload['elementList'] = supplierElementList_cb;\r\n    checkBoxPayload['supplierElementList'] = supplierElementList_cb;\r\n    checkBoxPayload['portalUpdatedDate'] = moment(new Date()).format('YYYY-MM-DD');\r\n\r\n    var useBolidenAssayAPI = {\r\n      method: 'POST',\r\n      url: req.body.propertyList.eka_ctrm_host + '\/api\/logistic\/useBolidenAssay',\r\n      \/\/ url: 'https:\/\/bolidenstackupg.ekaplus.com\/api\/logistic\/useBolidenAssay', \/\/hardcoded api url\r\n      headers: {\r\n        'Content-Type': 'application\/json',\r\n        Accept: 'application\/json',\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      body: checkBoxPayload,\r\n      json: true\r\n    };\r\n\r\n    function get_useBolidenAssayAPI() {\r\n      return new Promise(function(resolve, reject) {\r\n        console.log('Request - ' + useBolidenAssayAPI.url);\r\n        request(useBolidenAssayAPI, function(err, response, body) {\r\n          console.log('Response - ' + body);\r\n          if (response.statusCode >= 200 && response.statusCode <= 299) {\r\n            console.log('Success');\r\n            resolve(body);\r\n          } else {\r\n            console.log(body.error);\r\n            reject(err || body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    console.log('Checkbox Payload', JSON.stringify(checkBoxPayload));\r\n    get_useBolidenAssayAPI().then(function(result) {\r\n        let  checkboxResult= {}\r\n        checkboxResult.useBolidenAssay = result;\r\n        console.log(JSON.stringify(result));\r\n        res.status(200).send(checkboxResult);\r\n      })\r\n      .catch(err => {\r\n        console.log(err); \r\n        res.status(500).send(err)\r\n      });",
    "sys__UUID" : "6fbf41f0-7cd9-4c04-8946-bd5896930953"
}