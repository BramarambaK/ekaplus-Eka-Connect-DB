{
  "_id": ObjectId("5d1c6ed010f7f68b938f489b"),
  "name": "supplierlisting",
  "type": "processor",
  "refType": "app",
  "refTypeId": "467a28cc-bc93-4e38-8ff5-0a56ae128f3b",
  "snippet": " var start = req.body.queryParams.start ? parseInt(req.body.queryParams.start) : 0;\r\nvar end = req.body.queryParams.limit ? parseInt(req.body.queryParams.limit) : 10000;\r\n\r\nvar collection = {\r\n      method: 'POST',\r\n      url: req.body.propertyList.eka_ctrm_host + '/api/logistic/viewGmrListing',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        username: ' e-bolprpa'\r\n      },\r\n      body: {\r\n        startLimit: start,\r\n        endLimit: start+end\r\n      },\r\n      json: true\r\n    };\r\n\t\r\n\tDate.prototype.monthName = function() {\r\n    return this.toUTCString().split(' ')[2]\r\n\t};\r\n\t\r\n    function get_collection() {\r\n      return new Promise(function(resolve, reject) {\r\n        console.log('Request - ' + collection.url);\r\n        console.log('Payload -' + collection);\r\n        request(collection, function(err, response, body) {\r\n          console.log('Response length -' + body.length);\r\n          var result = {};\r\n          result.data = body;\r\n          result.totalCount = body[0].totalNoOfRecords\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(result);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    get_collection()\r\n      .then(result => {\r\n        for (var i = 0; i < result.data.length; i++) {\r\n\t\t\tif(result.data[i].portalCreatedUser){\r\n\t\t\t\tresult.data[i].createdBy = result.data[i].portalCreatedUser;\r\n\t\t\t}\r\n\t\t\tlet portaldate = result.data[i].portalUpdatedDate ? new Date(result.data[i].portalUpdatedDate).getTime() : result.data[i].portalUpdatedDate;\r\n\t\t\tlet ctrmdate = result.data[i].updatedDate ? new Date(result.data[i].updatedDate).getTime(): result.data[i].updatedDate;\r\n\t\t\tif(ctrmdate != null){\r\n\t\t\t   if(result.data[i].portalCreatedUser != null)\r\n\t\t\t   result.data[i].updatedBy = result.data[i].portalCreatedUser;\r\n\t\t\t}\r\n\t\t\tif(portaldate > ctrmdate){\r\n\t\t\t  result.data[i].updatedBy = result.data[i].portalUpdatedUser;\r\n\t\t\t}\r\n\t\t\t\r\n if (result.data[i]['latestAssayType'] !== null){\r\n          if (result.data[i]['latestAssayType'].toLowerCase() === 'self assay') result.data[i].latestAssayType = 'Boliden assay';\r\n          else if (result.data[i]['latestAssayType'].toLowerCase() === 'counter party assay')\r\n            result.data[i].latestAssayType = 'Supplier assay';}\r\n          if (result.data[i].landingDate === null) {\r\n            result.data[i].assayDueDate = null;\r\n          } else {\r\n            let date = new Date(result.data[i]['landingDate']);\r\n            if (\r\n              result.data[i]['product'].toLowerCase() == 'cu material' ||\r\n              result.data[i]['product'].toLowerCase() == 'pm material'\r\n            ) {\r\n              date.setDate(date.getDate() + 20);\r\n            } else if (\r\n              result.data[i]['qualityName'].toLowerCase() == 'alloys coarse' ||\r\n              result.data[i]['qualityName'].toLowerCase() == 'alloys coarse iba' ||\r\n              result.data[i]['qualityName'].toLowerCase() == 'alloys fine' ||\r\n              result.data[i]['qualityName'].toLowerCase() == 'alloys fine iba' ||\r\n              result.data[i]['qualityName'].toLowerCase() == 'alloys ingots'\r\n            ) {\r\n              date.setDate(date.getDate() + 35);\r\n            } else {\r\n              date.setDate(date.getDate() + 42);\r\n            }\r\n            var dd = date.getDate();\r\n            var mm = date.monthName();\r\n            var y = date.getFullYear();\r\nif(dd < 10) dd = '0' + dd;\r\nif(mm < 10) mm = '0' + mm;\r\n            var formattedDate = dd + '-' + mm + '-' + y;\r\n            result.data[i]['assayDueDate'] = formattedDate;\r\n          }\r\n        }\r\n        console.log('Response length - ' + result.data.length);\r\n        res.status(200).send(result);\r\n      })\r\n      .catch(err => {\r\n        console.log('Error Executing Processor -' + err);\r\n        res.status(500).send(err);\r\n      });",
  "sys__UUID": "09952914-b8f7-4040-9184-2cb0686f6862"
}
