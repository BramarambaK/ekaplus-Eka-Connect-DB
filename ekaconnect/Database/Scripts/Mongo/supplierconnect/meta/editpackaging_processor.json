{
  "_id": ObjectId("5d10d1a3eef99a6108dc611d"),
  "name": "editpackaging",
  "type": "processor",
  "refType": "app",
  "refTypeId": "467a28cc-bc93-4e38-8ff5-0a56ae128f3b",
  "snippet": "  var intGmrRefNo = req.body.selectedData['internalGmrRefNo'];\r\n    var gmrRefNo = req.body.selectedData['gmrRefNo'];\r\n    var collection = {\r\n      method: 'POST',\r\n      url: req.body.propertyList.eka_supplierconnect_host + '\/collection\/assayAndStockList',\r\n      headers: {\r\n        'Content-Type': 'application\/json',\r\n        Accept: 'application\/json',\r\n        username: 'e-bolprpa',\r\n        Authorization: req.headers.authorization,\r\n        'X-TenantID': req.headers['x-tenantid']\r\n      },\r\n      body: {\r\n        intGmrRefNo: intGmrRefNo,\r\n        gmrRefNo: gmrRefNo\r\n      },\r\n      json: true\r\n    };\r\n    function get_collection() {\r\n      return new Promise(function (resolve, reject) {\r\n        console.log('Request - ' + collection.url);\r\n        console.log('Payload -' + JSON.stringify(collection));\r\n        request(collection, function (err, response, body) {\r\n          console.log('Request Body - ' + JSON.stringify(body));\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    function get_viewgmr() {\r\n      return new Promise(function (resolve, reject) {\r\n        console.log(\"Request - \" + viewgmr.url);\r\n        console.log(\"Payload -\" + JSON.stringify(viewgmr));\r\n        request(viewgmr, function (err, response, body) {\r\n          console.log(\"Request Body - \" + JSON.stringify(body));\r\n          if (err || body.error) reject(body);\r\n          else {\r\n            resolve(body);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    var viewgmr = {\r\n      method: \"POST\",\r\n      url: req.body.propertyList.eka_connect_host + \"\/workflow\",\r\n      headers: {\r\n        \"Content-Type\": \"application\/json\",\r\n        Accept: \"application\/json\",\r\n        Authorization: req.headers.authorization,\r\n        \"X-TenantID\": req.headers[\"x-tenantid\"],\r\n      },\r\n      body: {\r\n        appId: \"467a28cc-bc93-4e38-8ff5-0a56ae128f3b\",\r\n        workflowTaskName: \"viewgmrdata_SC\",\r\n        task: \"viewgmrdata_SC\",\r\n        payLoadData: \"\",\r\n        output: {\r\n          ['viewgmrdata_SC']: {\r\n            ['intGmrRefNo']: intGmrRefNo,\r\n          },\r\n        },\r\n      },\r\n      json: true,\r\n    };\r\n\r\n    Promise.all([\r\n      get_collection(),\r\n      get_viewgmr(),\r\n    ])\r\n      .then(function (result) {\r\n\r\n        if (result[0] && !Array.isArray(result[0]['Provisional Assay'])) {\r\n          if (result[0] && Array.isArray(result[0]['Shipment Assay'])) {\r\n            result[0]['Provisional Assay'] = result[0]['Shipment Assay'];\r\n          }\r\n        }\r\n        let allAssayData = result[0];\r\n\r\n        var data = result[0]['Provisional Assay'][0].stockList;\r\n        for (var i = 0; i < data.length; i++) {\r\n          let remarks = data[i].remarks;\r\n          let remarksArr;\r\n          if (remarks) {\r\n            remarksArr = remarks.split(',');\r\n            for (let j = 0; j < remarksArr.length; j++) {\r\n              let prop = remarksArr[j].split('-');\r\n              data[i][prop[0]] = prop[1];\r\n            }\r\n          }\r\n          data[i].drums = parseInt(data[i].Drums);\r\n          data[i].bags = parseInt(data[i].Bags);\r\n          data[i].boxes = parseInt(data[i].Boxes);\r\n          data[i].pallets = parseInt(data[i].Pallets);\r\n          data[i].totalPackage = parseInt(data[i]['noOfBags']);\r\n          data[i].viewGmrData = result[1];\r\n        }\r\n        data.forEach((item) => {\r\n          item['allAssayData'] = JSON.parse(JSON.stringify(allAssayData));\r\n        })\r\n        console.log('Response - ' + (data));\r\n\r\n        res.status(200).send(data);\r\n      })\r\n      .catch(err => {\r\n        console.log('Error Executing Processor -' + err);\r\n        res.status(500).send(err);\r\n      });",
  "sys__UUID": "5ecc771e-8c98-43be-9ac6-ba7b7c0fa0f7"
}
