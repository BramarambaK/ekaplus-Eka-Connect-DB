{
    "_id" : ObjectId("5cea61ca91dafc459c6f49f9"),
    "name" : "_ST_PROCESS_MARGIN_DATA",
    "type" : "processor",
    "refType" : "app",
    "version" : "V2",
    "refTypeId" : "40a27e7f-3f50-406f-a872-2ee7d9436df9",
    "snippet" : "\r\n    if (req.body.compositeViewactualmargin) {\r\n      var list = req.body.actuallisting;\r\n    } else {\r\n      var list = req.body.listing;\r\n    }\r\n    var body = req.body;\r\n    var compositeData;\r\n\r\n    if (body.compositeViewactualmargin) {\r\n      compositeData = body.compositeViewactualmargin;\r\n      for (var i = 0; i < compositeData.listingactualmargin.length; i++) {\r\n        if (\r\n          compositeData.listingactualmargin[i]['COST GROUP NAME'] != 'Expense Total' &&\r\n          compositeData.listingactualmargin[i]['COST GROUP NAME'] != 'Income Total' &&\r\n          compositeData.listingactualmargin[i].financingdays == ''\r\n        ) {\r\n          compositeData.listingactualmargin[i].financingdays = 0;\r\n        }\r\n      }\r\n      var data = {\r\n        actualmargindata: {\r\n          listingactualmargin: compositeData.listingactualmargin,\r\n          viewmargin: compositeData.viewmargin,\r\n          tradeMargin: compositeData.tradeMargin,\r\n          shares: compositeData.shares,\r\n          rates: compositeData.rates,\r\n          ratesinput: compositeData.ratesinput,\r\n          remark: compositeData.remark\r\n        },\r\n        quantityr: list.quantityr,\r\n        uniqueno: list.uniqueno.toString(),\r\n        quality: list['PRODUCT DESC'],\r\n        'ALLOC DATE': list['ALLOC DATE'],\r\n        budgetmargin: '-',\r\n        CORPORATE_NAME: list['CORPORATE_NAME'],\r\n        'ALLOCATION GROUP NO': list['ALLOCATION GROUP NO'],\r\n        cpname: list['CP NAME'],\r\n        'INT ALLOC GROUP ID': list['INT ALLOC GROUP ID'],\r\n        'INT ENTITY REFNO': list['INT ENTITY REFNO'],\r\n        'INTERNAL CONTRACT REF NO': list['INTERNAL CONTRACT REF NO'],\r\n        'NET QTY': list['NET QTY'],\r\n        'PERSON INCHARGE': list['PERSON INCHARGE'],\r\n        'LEGAL ENTITY': list['LEGAL ENTITY'],\r\n        actualmargin: compositeData.tradeMargin.trademarginroundoff,\r\n        'PROFIT CENTER NAME': list['PROFIT CENTER NAME'],\r\n        CORPORATEID: list.CORPORATEID,\r\n        EXECUTION_STATUS: list['EXECUTION_STATUS'],\r\n        'CONTRACT ITEM NO': list['CONTRACT ITEM NO'],\r\n        margin: 'actual',\r\n        fxrefno: compositeData.ratesinput.fxrefno,\r\n        'PRODUCT SPECS': list['PRODUCT SPECS'],\r\n        status: 'Active'\r\n      };\r\n\r\n  success(data,200);     \r\n    } else {\r\n      if (body.compositeView) {\r\n        compositeData = body.compositeView;\r\n      } else {\r\n        compositeData = body.compositeViewInterestEdit;\r\n      }\r\n      for (var i = 0; i < compositeData.listingmargin.length; i++) {\r\n        if (\r\n          compositeData.listingmargin[i]['COST GROUP NAME'] != 'Expense Total' &&\r\n          compositeData.listingmargin[i]['COST GROUP NAME'] != 'Income Total' &&\r\n          compositeData.listingmargin[i].financingdays == ''\r\n        ) {\r\n          compositeData.listingmargin[i].financingdays = 0;\r\n        }\r\n      }\r\n      var data = {\r\n        margindata: {\r\n          listingmargin: compositeData.listingmargin,\r\n          viewmargin: compositeData.viewmargin,\r\n          viewmarginInterestEdit: compositeData.viewmarginInterestEdit,\r\n          tradeMargin: compositeData.tradeMargin,\r\n          shares: compositeData.shares,\r\n          rates: compositeData.rates,\r\n          ratesvalues: compositeData.ratesvalues,\r\n          ratesinput: compositeData.ratesinput,\r\n          remark: compositeData.remark\r\n        },\r\n        quantityr: list.quantityr,\r\n        uniqueno: list.uniqueno.toString(),\r\n        quality: list['PRODUCT DESC'],\r\n        'ALLOC DATE': list['ALLOC DATE'],\r\n        budgetmargin: compositeData.tradeMargin.trademarginroundoff,\r\n        CORPORATE_NAME: list['CORPORATE_NAME'],\r\n        'ALLOCATION GROUP NO': list['ALLOCATION GROUP NO'],\r\n        cpname: list['CP NAME'],\r\n        'INT ALLOC GROUP ID': list['INT ALLOC GROUP ID'],\r\n        'INT ENTITY REFNO': list['INT ENTITY REFNO'],\r\n        'INTERNAL CONTRACT REF NO': list['INTERNAL CONTRACT REF NO'],\r\n        'NET QTY': list['NET QTY'],\r\n        'LEGAL ENTITY': list['LEGAL ENTITY'],\r\n        'PRODUCT SPECS': list['PRODUCT SPECS'],\r\n        actualmargin: list.actualmargin,\r\n        'PROFIT CENTER NAME': list['PROFIT CENTER NAME'],\r\n        'PERSON INCHARGE': list['PERSON INCHARGE'],\r\n        CORPORATEID: list.CORPORATEID,\r\n        EXECUTION_STATUS: list['EXECUTION_STATUS'],\r\n        'CONTRACT ITEM NO': list['CONTRACT ITEM NO'],\r\n        fxrefno: compositeData.ratesinput.fxrefno,\r\n        margin: list.margin,\r\n        status: 'Active'\r\n      };\r\n\r\n success(data,200);     \r\n    }\r\n    ",
    "sys__UUID" : "ca29df8d-c982-45fd-9660-804727675018",
    "sys__createdOn" : ISODate("2019-05-26T09:52:10.548Z"),
    "sys__createdBy" : "admin@ekaplus.com"
}